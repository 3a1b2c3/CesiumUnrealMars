/*! For license information please see aframe-loader-3dtiles-component.min.js.LICENSE.txt */
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("THREE"));else if("function"==typeof define&&define.amd)define(["THREE"],e);else{var r="object"==typeof exports?e(require("THREE")):e(t.THREE);for(var n in r)("object"==typeof exports?exports:t)[n]=r[n]}}(this,(function(t){return(()=>{var e={384:()=>{if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");AFRAME.registerComponent("textarea",{schema:{transparentBG:{type:"boolean",default:!1},cols:{type:"int",default:40},rows:{type:"int",default:20},color:{type:"color",default:"black"},backgroundColor:{type:"color",default:"white"},disabledBackgroundColor:{type:"color",default:"lightgrey"},disabled:{type:"boolean",default:!1},text:{type:"string",default:""}},init:function(){this.text=null,this.lines=[],this.lastBlink=0,this.blinkEnabled=!this.data.disabled,this.charWidth=this.charHeight=null,this.selectionStart=this.selectionEnd=0,this.endIndexInfo=this.startIndexInfo=null,this.origin={x:0,y:0},this.background=document.createElement("a-plane"),this.background.setAttribute("color",this.data.disabled?this.data.disabledBackgroundColor:this.data.backgroundColor),this.el.appendChild(this.background),this.data.transparentBG&&this.background.setAttribute("material",{opacity:0,transparent:!0}),this.textAnchor=document.createElement("a-entity"),this.el.appendChild(this.textAnchor),this.textAnchor.setAttribute("text",{mode:"pre",baseline:"top",anchor:"center",font:"dejavu",wrapCount:this.data.cols,height:this.data.rows,color:this.data.color}),this._initTextarea(),this.el.addEventListener("textfontset",this._updateCharMetrics.bind(this)),this.el.addEventListener("char-metrics-changed",this._updateIndexInfo.bind(this)),this.el.addEventListener("text-changed",this._updateLines.bind(this)),this.el.addEventListener("text-changed",this._updateDisplayText.bind(this)),this.el.addEventListener("selection-changed",this._updateIndexInfo.bind(this)),this.el.addEventListener("selection-changed",this._updateHorizontalOrigin.bind(this)),this.el.addEventListener("lines-changed",this._updateIndexInfo.bind(this)),this.el.addEventListener("index-info-changed",this._updateOrigin.bind(this)),this.el.addEventListener("index-info-changed",this._updateHorizontalOrigin.bind(this)),this.el.addEventListener("origin-changed",this._updateDisplayText.bind(this)),this.el.addEventListener("click",this.focus.bind(this))},update:function(t){this.data.text!==t.text&&this._updateTextarea(),this.data.backgroundColor===t.backgroundColor&&this.data.disabledBackgroundColor===t.disabledBackgroundColor||this.background.setAttribute("color",this.data.disabled?this.data.disabledBackgroundColor:this.data.backgroundColor),this.data.disabled!==t.disabled&&(this.blinkEnabled=!this.data.disabled,this.textarea.disabled=this.data.disabled,this.background.setAttribute("color",this.data.disabled?this.data.disabledBackgroundColor:this.data.backgroundColor))},focus:function(){this.textarea.focus()},_initTextarea:function(){this.textarea=document.createElement("textarea"),document.body.appendChild(this.textarea),this._updateTextarea()},_updateTextarea:function(){this.textarea.style.whiteSpace="pre",this.textarea.style.overflow="hidden",this.textarea.style.opacity="0",this.textarea.cols=this.data.cols,this.textarea.rows=this.data.rows,this.textarea.value=this.data.text,this.textarea.selectionStart=0,this.textarea.selectionEnd=0,this._updateIndexInfo()},_emit:function(t,e){this.el.emit(t,e)},_updateCharMetrics:function(t){const e=this.textAnchor.components.text.geometry.layout,r=t.detail.fontObj.widthFactor;this.charWidth=r*this.textAnchor.object3DMap.text.scale.x,this.charHeight=this.charWidth*e.lineHeight/r,this.textAnchor.setAttribute("position",{x:0,y:this.charHeight*this.data.rows/2,z:0}),this.data.transparentBG||(this.background.setAttribute("scale",{x:1.05,y:this.charHeight*this.data.rows*1.05,z:1}),this.background.setAttribute("position",{x:0,y:0,z:0})),this._emit("char-metrics-changed")},_checkAndUpdateSelection:function(){if(this.selectionStart===this.textarea.selectionStart&&this.selectionEnd===this.textarea.selectionEnd)return;const t=this.selectionStart,e=this.selectionEnd;this.selectionStart=this.textarea.selectionStart,this.selectionEnd=this.textarea.selectionEnd,this._emit("selection-changed",{start:{old:t,new:this.selectionStart,changed:this.selectionStart!==t},end:{old:e,new:this.selectionEnd,changed:this.selectionEnd!==e}})},tick:function(t){t-this.lastBlink>500&&this.blinkEnabled&&(this.lastBlink=t),this._checkAndUpdateSelection(),this._checkAndUpdateText()},_getIndexInfo:function(t,e){const r=Math.max(0,t),n=this.lines[r];return{line:n,x:(e-n.start)*this.charWidth,y:-this.charHeight*r+-this.charHeight/2}},_updateIndexInfo:function(){if(!this.lines.length)return;const t=this.startIndexInfo&&this.startIndexInfo.line.index,e=this.endIndexInfo&&this.endIndexInfo.line.index;let r;this.startIndexInfo=null,this.endIndexInfo=null;let n=!1,s=!1;for(r=0;r<=this.lines.length;r++){const i=this.lines[r-1],o=r===this.lines.length?i.start+i.length+1:this.lines[r].start;if(o>this.selectionStart&&!this.startIndexInfo&&(this.startIndexInfo=this._getIndexInfo(r-1,this.selectionStart),this.startIndexInfo.line.index!==t&&(n=!0)),o>this.selectionEnd){this.endIndexInfo=this._getIndexInfo(r-1,this.selectionEnd),this.endIndexInfo.line.index!==e&&(s=!0);break}}(n||s)&&this._emit("index-info-changed",{start:{changed:n},end:{changed:s}})},_updateOrigin:function(t){let e=!1;if(t.detail.end.changed){const t=this.origin.y+this.data.rows-1;this.endIndexInfo.line.index>t?(this.origin.y=this.endIndexInfo.line.index+1-this.data.rows,e=!0):this.endIndexInfo.line.index<this.origin.y&&(this.origin.y=this.endIndexInfo.line.index,e=!0)}t.detail.start.changed&&this.startIndexInfo.line.index<this.origin.y&&(this.origin.y=this.startIndexInfo.line.index,e=!0),e&&this._emit("origin-changed")},_updateHorizontalOrigin:function(t){if(!this.endIndexInfo)return;let e=!0;if(t.detail.end.changed){const t=this.selectionEnd-this.endIndexInfo.line.start;t>this.origin.x+this.data.cols?(this.origin.x=t-this.data.cols,e=!0):t<this.origin.x&&(this.origin.x=t,e=!0)}const r=this.selectionStart-this.startIndexInfo.line.start;t.detail.start.changed&&(r>this.origin.x+this.data.cols?(this.origin.x=r-this.data.cols,e=!0):r<this.origin.x&&(this.origin.x=r,e=!0)),e&&this._emit("origin-changed")},_updateLines:function(){this.lines=[];const t=this.text.split("\n");let e=0;for(let r=0;r<t.length;r++)this.lines[r]={index:r,length:t[r].length,start:e},e+=t[r].length+1;this._emit("lines-changed")},_getViewportText:function(){return this.text.split("\n").slice(this.origin.y,this.origin.y+this.data.rows).map(function(t){return t.substr(this.origin.x,this.data.cols)||" "}.bind(this)).join("\n")},_updateDisplayText:function(){this.textAnchor.setAttribute("text",{value:this._getViewportText()})},_checkAndUpdateText:function(){const t=this.textarea.value;t!==this.text&&(this.text=t,this._emit("text-changed"))}})},824:e=>{"use strict";e.exports=t}},r={};function n(t){var s=r[t];if(void 0!==s)return s.exports;var i=r[t]={exports:{}};return e[t](i,i.exports,n),i.exports}n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var s={};return(()=>{"use strict";n.r(s);var t=n(824);function e(t,e,r,n){return new(r||(r=Promise))((function(s,i){function o(t){try{c(n.next(t))}catch(t){i(t)}}function a(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))}function r(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const i=Boolean("object"!=typeof process||"[object process]"!==String(process)||process.browser),o="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);function a(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}o&&parseFloat(o[1]);const c={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},l=c.global||c.self||c.window||{},h="object"!=typeof process||"[object process]"!==String(process)||process.browser,u="function"==typeof importScripts,d="undefined"!=typeof window&&void 0!==window.orientation,f="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);function m(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}f&&parseFloat(f[1]);class A{constructor(t,e){m(this,"name",void 0),m(this,"workerThread",void 0),m(this,"isRunning",void 0),m(this,"result",void 0),m(this,"_resolve",void 0),m(this,"_reject",void 0),this.name=t,this.workerThread=e,this.isRunning=!0,this._resolve=()=>{},this._reject=()=>{},this.result=new Promise(((t,e)=>{this._resolve=t,this._reject=e}))}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){a(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){a(this.isRunning),this.isRunning=!1,this._reject(t)}}const p=new Map;function B(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function g(t,e=!0,r){const n=r||new Set;if(t)if(y(t))n.add(t);else if(y(t.buffer))n.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"==typeof t)for(const r in t)g(t[r],e,n);return void 0===r?Array.from(n):[]}function y(t){return!!t&&(t instanceof ArrayBuffer||"undefined"!=typeof MessagePort&&t instanceof MessagePort||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)}const C=()=>{};class b{static isSupported(){return"undefined"!=typeof Worker}constructor(t){m(this,"name",void 0),m(this,"source",void 0),m(this,"url",void 0),m(this,"terminated",!1),m(this,"worker",void 0),m(this,"onMessage",void 0),m(this,"onError",void 0),m(this,"_loadableURL","");const{name:e,source:r,url:n}=t;a(r||n),this.name=e,this.source=r,this.url=n,this.onMessage=C,this.onError=t=>console.log(t),this.worker=this._createBrowserWorker()}destroy(){this.onMessage=C,this.onError=C,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(t,e){e=e||g(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+="worker ".concat(this.name," from ").concat(this.url,". "),t.message&&(e+="".concat(t.message," in ")),t.lineno&&(e+=":".concat(t.lineno,":").concat(t.colno)),new Error(e)}_createBrowserWorker(){this._loadableURL=function(t){a(t.source&&!t.url||!t.source&&t.url);let e=p.get(t.source||t.url);return e||(t.url&&(e=(r=t.url).startsWith("http")?B("try {\n  importScripts('".concat(r,"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}")):r,p.set(t.url,e)),t.source&&(e=B(t.source),p.set(t.source,e))),a(e),e;var r}({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},t.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},t.onmessageerror=t=>console.error(t),t}}class w{constructor(t){m(this,"name","unnamed"),m(this,"source",void 0),m(this,"url",void 0),m(this,"maxConcurrency",1),m(this,"maxMobileConcurrency",1),m(this,"onDebug",(()=>{})),m(this,"reuseWorkers",!0),m(this,"props",{}),m(this,"jobQueue",[]),m(this,"idleQueue",[]),m(this,"count",0),m(this,"isDestroyed",!1),this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach((t=>t.destroy())),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)}async startJob(t,e=((t,e,r)=>t.done(r)),r=((t,e)=>t.error(e))){const n=new Promise((n=>(this.jobQueue.push({name:t,onMessage:e,onError:r,onStart:n}),this)));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",name:e.name,workerThread:t,backlog:this.jobQueue.length});const r=new A(e.name,t);t.onMessage=t=>e.onMessage(r,t.type,t.payload),t.onError=t=>e.onError(r,t),e.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new b({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return d?this.maxMobileConcurrency:this.maxConcurrency}}const E={maxConcurrency:3,maxMobileConcurrency:1,onDebug:()=>{},reuseWorkers:!0};class T{static isSupported(){return b.isSupported()}static getWorkerFarm(t={}){return T._workerFarm=T._workerFarm||new T({}),T._workerFarm.setProps(t),T._workerFarm}constructor(t){m(this,"props",void 0),m(this,"workerPools",new Map),this.props={...E},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy()}setProps(t){this.props={...this.props,...t};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:e,source:r,url:n}=t;let s=this.workerPools.get(e);return s||(s=new w({name:e,source:r,url:n}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(e,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}m(T,"_workerFarm",void 0);var v={},I=Object.freeze(Object.assign(Object.create(null),v,{default:v}));const _={};async function M(t,e=null,r={}){return e&&(t=function(t,e,r){if(t.startsWith("http"))return t;const n=r.modules||{};return n[t]?n[t]:h?r.CDN?(a(r.CDN.startsWith("http")),"".concat(r.CDN,"/").concat(e,"@").concat("3.1.4","/dist/libs/").concat(t)):u?"../src/libs/".concat(t):"modules/".concat(e,"/src/libs/").concat(t):"modules/".concat(e,"/dist/libs/").concat(t)}(t,e,r)),_[t]=_[t]||async function(t){if(t.endsWith("wasm")){const e=await fetch(t);return await e.arrayBuffer()}if(!h)try{return I&&v.requireFromFile&&await v.requireFromFile(t)}catch{return null}if(u)return importScripts(t);const e=await fetch(t);return function(t,e){if(!h)return v.requireFromString&&v.requireFromString(t,e);if(u)return eval.call(l,t),null;const r=document.createElement("script");r.id=e;try{r.appendChild(document.createTextNode(t))}catch(e){r.text=t}return document.body.appendChild(r),null}(await e.text(),t)}(t),await _[t]}async function F(t,e,r,n,s){const i=t.id,o=function(t,e={}){const r=e[t.id]||{},n="".concat(t.id,"-worker.js");let s=r.workerUrl;if(s||"compression"!==t.id||(s=e.workerUrl),"test"===e._workerType&&(s="modules/".concat(t.module,"/dist/").concat(n)),!s){let e=t.version;"latest"===e&&(e="latest");const r=e?"@".concat(e):"";s="https://unpkg.com/@loaders.gl/".concat(t.module).concat(r,"/dist/").concat(n)}return a(s),s}(t,r),c=T.getWorkerFarm(r).getWorkerPool({name:i,url:o});r=JSON.parse(JSON.stringify(r));const l=await c.startJob("process-on-worker",D.bind(null,s));l.postMessage("process",{input:e,options:r});const h=await l.result;return await h.result}async function D(t,e,r,n){switch(r){case"done":e.done(n);break;case"error":e.error(new Error(n.error));break;case"process":const{id:s,input:i,options:o}=n;try{const r=await t(i,o);e.postMessage("done",{id:s,result:r})}catch(t){const r=t instanceof Error?t.message:"unknown error";e.postMessage("error",{id:s,error:r})}break;default:console.warn("parse-with-worker unknown message ".concat(r))}}function G(t,e,r){if(t.byteLength<=e+r)return"";const n=new DataView(t);let s="";for(let t=0;t<r;t++)s+=String.fromCharCode(n.getUint8(e+t));return s}function x(t){return t&&"object"==typeof t&&t.isBuffer}function S(t){if(x(t))return x(e=t)?new Uint8Array(e.buffer,e.byteOffset,e.length).slice().buffer:e;var e;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return 0===t.byteOffset&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if("string"==typeof t){const e=t;return(new TextEncoder).encode(e).buffer}if(t&&"object"==typeof t&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function R(t,e,r){const n=void 0!==r?new Uint8Array(t).subarray(e,e+r):new Uint8Array(t).subarray(e);return new Uint8Array(n).buffer}function O(t,e){return r(t>=0),r(e>0),t+(e-1)&~(e-1)}function U(t,e,r){let n;if(t instanceof ArrayBuffer)n=new Uint8Array(t);else{const e=t.byteOffset,r=t.byteLength;n=new Uint8Array(t.buffer||t.arrayBuffer,e,r)}return e.set(n,r),r+O(n.byteLength,4)}function L(){let t;if("undefined"!=typeof window&&window.performance)t=window.performance.now();else if("undefined"!=typeof process&&process.hrtime){const e=process.hrtime();t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}class N{constructor(t,e){m(this,"name",void 0),m(this,"type",void 0),m(this,"sampleSize",1),m(this,"time",void 0),m(this,"count",void 0),m(this,"samples",void 0),m(this,"lastTiming",void 0),m(this,"lastSampleTime",void 0),m(this,"lastSampleCount",void 0),m(this,"_count",0),m(this,"_time",0),m(this,"_samples",0),m(this,"_startTime",0),m(this,"_timerPending",!1),this.name=t,this.type=e,this.reset()}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=L(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(L()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class H{constructor(t){m(this,"id",void 0),m(this,"stats",{}),this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t in this.stats)this.stats[t].reset();return this}forEach(t){for(const e in this.stats)t(this.stats[e])}getTable(){const t={};return this.forEach((e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}})),t}_initializeStats(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((t=>this._getOrCreate(t)))}_getOrCreate(t){if(!t||!t.name)return null;const{name:e,type:r}=t;return this.stats[e]||(this.stats[e]=t instanceof N?t:new N(e,r)),this.stats[e]}}const J={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class P{constructor(t={}){m(this,"props",void 0),m(this,"stats",void 0),m(this,"activeRequestCount",0),m(this,"requestQueue",[]),m(this,"requestMap",new Map),m(this,"deferredUpdate",null),this.props={...J,...t},this.stats=new H({id:this.props.id}),this.stats.get("Queued Requests"),this.stats.get("Active Requests"),this.stats.get("Cancelled Requests"),this.stats.get("Queued Requests Ever"),this.stats.get("Active Requests Ever")}scheduleRequest(t,e=(()=>0)){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const r={handle:t,priority:0,getPriority:e},n=new Promise((t=>(r.resolve=t,r)));return this.requestQueue.push(r),this.requestMap.set(t,n),this._issueNewRequests(),n}_issueRequest(t){const{handle:e,resolve:r}=t;let n=!1;const s=()=>{n||(n=!0,this.requestMap.delete(e),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout((()=>this._issueNewRequestsAsync()),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==t){this._updateAllRequests();for(let e=0;e<t;++e){const t=this.requestQueue.shift();t&&this._issueRequest(t)}}}_updateAllRequests(){const t=this.requestQueue;for(let e=0;e<t.length;++e){const r=t[e];this._updateRequest(r)||(t.splice(e,1),this.requestMap.delete(r.handle),e--)}t.sort(((t,e)=>t.priority-e.priority))}_updateRequest(t){return t.priority=t.getPriority(t.handle),!(t.priority<0&&(t.resolve(null),1))}}const j={};function k(t){const e=t&&t.lastIndexOf("/");return e>=0?t.substr(0,e):""}const V=t=>"function"==typeof t,K=t=>null!==t&&"object"==typeof t,Q=t=>K(t)&&t.constructor==={}.constructor,q=t=>"undefined"!=typeof Response&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,z=t=>"undefined"!=typeof Blob&&t instanceof Blob,W=t=>(t=>"undefined"!=typeof ReadableStream&&t instanceof ReadableStream||K(t)&&V(t.tee)&&V(t.cancel)&&V(t.getReader))(t)||(t=>K(t)&&V(t.read)&&V(t.pipe)&&(t=>"boolean"==typeof t)(t.readable))(t),Y=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,X=/^([-\w.]+\/[-\w.+]+)/;function Z(t){const e=X.exec(t);return e?e[1]:t}function $(t){const e=Y.exec(t);return e?e[1]:""}const tt=/\?.*/;function et(t){if(q(t)){const e=rt(t.url||"");return{url:e,type:Z(t.headers.get("content-type")||"")||$(e)}}return z(t)?{url:rt(t.name||""),type:t.type||""}:"string"==typeof t?{url:rt(t),type:$(t)}:{url:"",type:""}}function rt(t){return t.replace(tt,"")}async function nt(t){if(q(t))return t;const e={},r=function(t){return q(t)?t.headers["content-length"]||-1:z(t)?t.size:"string"==typeof t?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}(t);r>=0&&(e["content-length"]=String(r));const{url:n,type:s}=et(t);s&&(e["content-type"]=s);const i=await async function(t){if("string"==typeof t)return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const e=t.slice(0,5);return await new Promise((t=>{const r=new FileReader;r.onload=e=>{var r;return t(null==e||null===(r=e.target)||void 0===r?void 0:r.result)},r.readAsDataURL(e)}))}if(t instanceof ArrayBuffer){const e=function(t){let e="";const r=new Uint8Array(t);for(let t=0;t<r.byteLength;t++)e+=String.fromCharCode(r[t]);return btoa(e)}(t.slice(0,5));return"data:base64,".concat(e)}return null}(t);i&&(e["x-first-bytes"]=i),"string"==typeof t&&(t=(new TextEncoder).encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:n}),o}async function st(t,e){if("string"==typeof t){t=function(t){for(const e in j)if(t.startsWith(e)){const r=j[e];t=t.replace(e,r)}return t.startsWith("http://")||t.startsWith("https://")||(t="".concat("").concat(t)),t}(t);let r=e;return null!=e&&e.fetch&&"function"!=typeof(null==e?void 0:e.fetch)&&(r=e.fetch),await fetch(t,r)}return await nt(t)}function it(){return!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)||function(t){if("undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"==typeof process.versions&&Boolean(process.versions.electron))return!0;const e="object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent;return!!(e&&e.indexOf("Electron")>=0)}()}const ot={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document,process:"object"==typeof process&&process},at=ot.window||ot.self||ot.global,ct=ot.process||{},lt="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source";it();class ht{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";m(this,"storage",void 0),m(this,"id",void 0),m(this,"config",{}),this.storage=function(t){try{const e=window[t],r="__storage_test__";return e.setItem(r,r),e.removeItem(r),e}catch(t){return null}}(r),this.id=t,this.config={},Object.assign(this.config,e),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){return this.config={},this.updateConfiguration(t)}updateConfiguration(t){if(Object.assign(this.config,t),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}return this}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}function ut(t,e,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600;const s=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>n&&(r=Math.min(r,n/t.width));const i=t.width*r,o=t.height*r,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(i/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(s,");"),"background-size:".concat(i,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),a]}let dt;function ft(t){return"string"==typeof t?dt[t.toUpperCase()]||dt.WHITE:t}function mt(t,e){if(!t)throw new Error(e||"Assertion failed")}function At(){let t;var e,r;if(it&&"performance"in at)t=null==at||null===(e=at.performance)||void 0===e||null===(r=e.now)||void 0===r?void 0:r.call(e);else if("hrtime"in ct){var n;const e=null==ct||null===(n=ct.hrtime)||void 0===n?void 0:n.call(ct);t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}!function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"}(dt||(dt={}));const pt={debug:it&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Bt={enabled:!0,level:0};function gt(){}const yt={},Ct={once:!0};class bt{constructor(){let{id:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:""};m(this,"id",void 0),m(this,"VERSION",lt),m(this,"_startTs",At()),m(this,"_deltaTs",At()),m(this,"_storage",void 0),m(this,"userData",{}),m(this,"LOG_THROTTLE_TIMEOUT",0),this.id=t,this._storage=new ht("__probe-".concat(this.id,"__"),Bt),this.userData={},this.timeStamp("".concat(this.id," started")),function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"];const r=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(r);for(const r of n)"function"==typeof t[r]&&(e.find((t=>r===t))||(t[r]=t[r].bind(t)))}(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((At()-this._startTs).toPrecision(10))}getDelta(){return Number((At()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._storage.updateConfiguration({enabled:t}),this}setLevel(t){return this._storage.updateConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.updateConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){mt(t,e)}warn(t){return this._getLogFunction(0,t,pt.warn,arguments,Ct)}error(t){return this._getLogFunction(0,t,pt.error,arguments)}deprecated(t,e){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(e,"` instead"))}removed(t,e){return this.error("`".concat(t,"` has been removed. Use `").concat(e,"` instead"))}probe(t,e){return this._getLogFunction(t,e,pt.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,pt.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){for(var r=arguments.length,n=new Array(r>2?r-2:0),s=2;s<r;s++)n[s-2]=arguments[s];return this._getLogFunction(t,e,pt.debug||pt.info,arguments,Ct)}table(t,e,r){return e?this._getLogFunction(t,e,console.table||gt,r&&[r],{tag:Tt(e)}):gt}image(t){let{logLevel:e,priority:r,image:n,message:s="",scale:i=1}=t;return this._shouldLog(e||r)?it?function(t){let{image:e,message:r="",scale:n=1}=t;if("string"==typeof e){const t=new Image;return t.onload=()=>{const e=ut(t,r,n);console.log(...e)},t.src=e,gt}const s=e.nodeName||"";if("img"===s.toLowerCase())return console.log(...ut(e,r,n)),gt;if("canvas"===s.toLowerCase()){const t=new Image;return t.onload=()=>console.log(...ut(t,r,n)),t.src=e.toDataURL(),gt}return gt}({image:n,message:s,scale:i}):function(t){let{image:e,message:r="",scale:n=1}=t,s=null;try{s=module.require("asciify-image")}catch(t){}return s?()=>s(e,{fit:"box",width:"".concat(Math.round(80*n),"%")}).then((t=>console.log(t))):gt}({image:n,message:s,scale:i}):gt}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||gt)}group(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1};const n=Et({logLevel:t,message:e,opts:r}),{collapsed:s}=r;return n.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.group(t,e,Object.assign({},r,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||gt)}withGroup(t,e,r){this.group(t,e)();try{r()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=wt(t)}_getLogFunction(t,e,r,n,s){if(this._shouldLog(t)){s=Et({logLevel:t,message:e,args:n,opts:s}),mt(r=r||s.method),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=At();const i=s.tag||s.message;if(s.once){if(yt[i])return gt;yt[i]=At()}return e=function(t,e,r){if("string"==typeof e){const o=r.time?function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;const r=Math.max(e-t.length,0);return"".concat(" ".repeat(r)).concat(t)}(function(t){let e;return e=t<10?"".concat(t.toFixed(2),"ms"):t<100?"".concat(t.toFixed(1),"ms"):t<1e3?"".concat(t.toFixed(0),"ms"):"".concat((t/1e3).toFixed(2),"s"),e}(r.total)):"";n=e=r.time?"".concat(t,": ").concat(o,"  ").concat(e):"".concat(t,": ").concat(e),s=r.color,i=r.background,it||"string"!=typeof n||(s&&(s=ft(s),n="[".concat(s,"m").concat(n,"[39m")),i&&(s=ft(i),n="[".concat(i+10,"m").concat(n,"[49m"))),e=n}var n,s,i;return e}(this.id,s.message,s),r.bind(console,e,...s.args)}return gt}}function wt(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return mt(Number.isFinite(e)&&e>=0),e}function Et(t){const{logLevel:e,message:r}=t;t.logLevel=wt(e);const n=t.args?Array.from(t.args):[];for(;n.length&&n.shift()!==r;);switch(typeof e){case"string":case"function":void 0!==r&&n.unshift(r),t.message=e;break;case"object":Object.assign(t,e)}"function"==typeof t.message&&(t.message=t.message());const s=typeof t.message;return mt("string"===s||"object"===s),Object.assign(t,{args:n},t.opts)}function Tt(t){for(const e in t)for(const r in t[e])return r||"untitled";return"empty"}m(bt,"VERSION",lt);const vt=new bt({id:"loaders.gl"});class It{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}const _t={fetch:null,mimeType:void 0,nothrow:!1,log:new class{constructor(){m(this,"console",void 0),this.console=console}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}},CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Mt={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Ft(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const Dt=()=>{const t=Ft();return t.globalOptions=t.globalOptions||{..._t},t.globalOptions};function Gt(t,e){const r=Dt(),n=t||r;return"function"==typeof n.fetch?n.fetch:K(n.fetch)?t=>st(t,n):null!=e&&e.fetch?null==e?void 0:e.fetch:st}function xt(t,e,r,n,s){const i=e||"Top level",o=e?"".concat(e,"."):"";for(const a in t){const c=!e&&K(t[a]),l="baseUri"===a&&!e,h="workerUrl"===a&&e;if(!(a in r)&&!l&&!h)if(a in n)vt.warn("".concat(i," loader option '").concat(o).concat(a,"' no longer supported, use '").concat(n[a],"'"))();else if(!c){const t=St(a,s);vt.warn("".concat(i," loader option '").concat(o).concat(a,"' not recognized. ").concat(t))()}}}function St(t,e){const r=t.toLowerCase();let n="";for(const s of e)for(const e in s.options){if(t===e)return"Did you mean '".concat(s.id,".").concat(e,"'?");const i=e.toLowerCase();(r.startsWith(i)||i.startsWith(r))&&(n=n||"Did you mean '".concat(s.id,".").concat(e,"'?"))}return n}function Rt(t,e){for(const r in e)if(r in e){const n=e[r];Q(n)&&Q(t[r])?t[r]={...t[r],...e[r]}:t[r]=e[r]}}function Ot(t){var e;return!!t&&(Array.isArray(t)&&(t=t[0]),Array.isArray(null===(e=t)||void 0===e?void 0:e.extensions))}function Ut(t){var e,n;let s;return r(t,"null loader"),r(Ot(t),"invalid loader"),Array.isArray(t)&&(s=t[1],t=t[0],t={...t,options:{...t.options,...s}}),(null!==(e=t)&&void 0!==e&&e.parseTextSync||null!==(n=t)&&void 0!==n&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const Lt=/\.([^.]+)$/;function Nt(t,e=[],r,n){if(!Ht(t))return null;if(e&&!Array.isArray(e))return Ut(e);let s=[];e&&(s=s.concat(e)),null!=r&&r.ignoreRegisteredLoaders||s.push(...(()=>{const t=Ft();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry})()),function(t){for(const e of t)Ut(e)}(s);const i=function(t,e,r,n){const{url:s,type:i}=et(t),o=s||(null==n?void 0:n.url);let a=null;return null!=r&&r.mimeType&&(a=Pt(e,null==r?void 0:r.mimeType)),a=a||function(t,e){const r=e&&Lt.exec(e),n=r&&r[1];return n?function(t,e){e=e.toLowerCase();for(const r of t)for(const t of r.extensions)if(t.toLowerCase()===e)return r;return null}(t,n):null}(e,o),a=a||Pt(e,i),a=a||function(t,e){if(!e)return null;for(const r of t)if("string"==typeof e){if(jt(e,r))return r}else if(ArrayBuffer.isView(e)){if(kt(e.buffer,e.byteOffset,r))return r}else if(e instanceof ArrayBuffer&&kt(e,0,r))return r;return null}(e,t),a=a||Pt(e,null==r?void 0:r.fallbackMimeType),a}(t,s,r,n);if(!(i||null!=r&&r.nothrow))throw new Error(Jt(t));return i}function Ht(t){return!(t instanceof Response&&204===t.status)}function Jt(t){const{url:e,type:r}=et(t);let n="No valid loader found (";n+=e?"".concat(function(t){const e=t&&t.lastIndexOf("/");return e>=0?t.substr(e+1):""}(e),", "):"no url provided, ",n+="MIME type: ".concat(r?'"'.concat(r,'"'):"not provided",", ");const s=t?function(t,e=5){return"string"==typeof t?t.slice(0,e):ArrayBuffer.isView(t)?Vt(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?Vt(t,0,e):""}(t):"";return n+=s?' first bytes: "'.concat(s,'"'):"first bytes: not available",n+=")",n}function Pt(t,e){for(const r of t){if(r.mimeTypes&&r.mimeTypes.includes(e))return r;if(e==="application/x.".concat(r.id))return r}return null}function jt(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some((e=>t.startsWith(e)))}function kt(t,e,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some((n=>function(t,e,r,n){if(n instanceof ArrayBuffer)return function(t,e,r){if(r=r||t.byteLength,t.byteLength<r||e.byteLength<r)return!1;const n=new Uint8Array(t),s=new Uint8Array(e);for(let t=0;t<n.length;++t)if(n[t]!==s[t])return!1;return!0}(n,t,n.byteLength);switch(typeof n){case"function":return n(t,r);case"string":return n===Vt(t,e,n.length);default:return!1}}(t,e,r,n)))}function Vt(t,e,r){if(t.byteLength<e+r)return"";const n=new DataView(t);let s="";for(let t=0;t<r;t++)s+=String.fromCharCode(n.getUint8(e+t));return s}const Kt=262144;function Qt(t,e){return i?async function*(t,e){const r=t.getReader();let n;try{for(;;){const t=n||r.read();null!=e&&e._streamReadAhead&&(n=r.read());const{done:s,value:i}=await t;if(s)return;yield S(i)}}catch(t){r.releaseLock()}}(t,e):async function*(t,e){for await(const e of t)yield S(e)}(t)}const qt="Cannot convert supplied data type";async function zt(t,e,r){const n=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if("string"==typeof t||n)return function(t,e,r){if(e.text&&"string"==typeof t)return t;var n;if((n=t)&&"object"==typeof n&&n.isBuffer&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const n=t.byteLength||t.length;return 0===t.byteOffset&&n===r.byteLength||(r=r.slice(t.byteOffset,t.byteOffset+n)),r}throw new Error(qt)}(t,e);if(z(t)&&(t=await nt(t)),q(t)){const r=t;return await async function(t){if(!t.ok){const e=await async function(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const r=t.headers.get("Content-Type");let n=t.statusText;r.includes("application/json")&&(n+=" ".concat(await t.text())),e+=n,e=e.length>60?"".concat(e.slice(60),"..."):e}catch(t){}return e}(t);throw new Error(e)}}(r),e.binary?await r.arrayBuffer():await r.text()}if(W(t)&&(t=function(t,e){if("string"==typeof t)return function*(t,e){const r=(null==e?void 0:e.chunkSize)||262144;let n=0;const s=new TextEncoder;for(;n<t.length;){const e=Math.min(t.length-n,r),i=t.slice(n,n+e);n+=e,yield s.encode(i)}}(t,e);if(t instanceof ArrayBuffer)return function*(t,e={}){const{chunkSize:r=Kt}=e;let n=0;for(;n<t.byteLength;){const e=Math.min(t.byteLength-n,r),s=new ArrayBuffer(e),i=new Uint8Array(t,n,e);new Uint8Array(s).set(i),n+=e,yield s}}(t,e);if(z(t))return async function*(t,e){const r=(null==e?void 0:e.chunkSize)||1048576;let n=0;for(;n<t.size;){const e=n+r,s=await t.slice(n,e).arrayBuffer();n=e,yield s}}(t,e);if(W(t))return Qt(t,e);if(q(t))return Qt(t.body,e);throw new Error("makeIterator")}(t,r)),(s=t)&&"function"==typeof s[Symbol.iterator]||(t=>t&&"function"==typeof t[Symbol.asyncIterator])(t))return async function(t){const e=[];for await(const r of t)e.push(r);return function(...t){const e=t.map((t=>t instanceof ArrayBuffer?new Uint8Array(t):t)),r=e.reduce(((t,e)=>t+e.byteLength),0),n=new Uint8Array(r);let s=0;for(const t of e)n.set(t,s),s+=t.byteLength;return n.buffer}(...e)}(t);var s;throw new Error(qt)}async function Wt(t,e,r,n){a(!n||"object"==typeof n),!e||Array.isArray(e)||Ot(e)||(n=void 0,r=e,e=void 0),t=await t,r=r||{};const{url:s}=et(t),i=function(t,e){if(!e&&t&&!Array.isArray(t))return t;let r;if(t&&(r=Array.isArray(t)?t:[t]),e&&e.loaders){const t=Array.isArray(e.loaders)?e.loaders:[e.loaders];r=r?[...r,...t]:t}return r&&r.length?r:null}(e,n),o=await async function(t,e=[],r,n){if(!Ht(t))return null;let s=Nt(t,e,{...r,nothrow:!0},n);if(s)return s;if(z(t)&&(s=Nt(t=await t.slice(0,10).arrayBuffer(),e,r,n)),!(s||null!=r&&r.nothrow))throw new Error(Jt(t));return s}(t,i,r);return o?(n=function(t,e,r=null){if(r)return r;const n={fetch:Gt(e,t),...t};return Array.isArray(n.loaders)||(n.loaders=null),n}({url:s,parse:Wt,loaders:i},r=function(t,e,r,n){return r=r||[],function(t,e){xt(t,null,_t,Mt,e);for(const r of e){const n=t&&t[r.id]||{},s=r.options&&r.options[r.id]||{},i=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};xt(n,r.id,s,i,e)}}(t,r=Array.isArray(r)?r:[r]),function(t,e,r){const n={...t.options||{}};return function(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}(n,r),null===n.log&&(n.log=new It),Rt(n,Dt()),Rt(n,e),n}(e,t,n)}(r,o,i,s),n),await async function(t,e,r,n){if(function(t,e="3.1.4"){a(t,"no worker provided");t.version}(t),e=await zt(e,t,r),t.parseTextSync&&"string"==typeof e)return r.dataType="text",t.parseTextSync(e,r,n,t);if(function(t,e){return!!T.isSupported()&&t.worker&&(null==e?void 0:e.worker)}(t,r))return await F(t,e,r,0,Wt);if(t.parseText&&"string"==typeof e)return await t.parseText(e,r,n,t);if(t.parse)return await t.parse(e,r,n,t);throw a(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}(o,t,r,n)):null}async function Yt(t,e,r,n){Array.isArray(e)||Ot(e)||(r=e,e=void 0);const s=Gt(r);let i=t;return"string"==typeof t&&(i=await s(t)),z(t)&&(i=await s(t)),await Wt(i,e,r)}function Xt(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const Zt=1/Math.PI*180,$t=1/180*Math.PI,te={};function ee(t,{precision:e=te.precision||4}={}){return t=function(t){return Math.round(t/te.EPSILON)*te.EPSILON}(t),"".concat(parseFloat(t.toPrecision(e)))}function re(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function ne(t,e,r){if(re(t)){r=r||((n=t).clone?n.clone():new Array(n.length));for(let n=0;n<r.length&&n<t.length;++n)r[n]=e(t[n],n,r);return r}var n;return e(t)}function se(t){return function(t,e){return ne(t,(t=>t*$t),void 0)}(t)}function ie(t){return oe(t)}function oe(t,e){return ne(t,(t=>t*Zt),e)}function ae(t,e,r){const n=te.EPSILON;r&&(te.EPSILON=r);try{if(t===e)return!0;if(re(t)&&re(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!ae(t[r],e[r]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):!(!Number.isFinite(t)||!Number.isFinite(e))&&Math.abs(t-e)<=te.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{te.EPSILON=n}}te.EPSILON=1e-12,te.debug=!1,te.precision=4,te.printTypes=!1,te.printDegrees=!1,te.printRowMajor=!0;class ce extends(function(t){function e(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}(Array)){get ELEMENTS(){return Xt(!1),0}clone(){return(new this.constructor).copy(this)}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}fromArray(t,e=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=t[r+e];return this.check()}to(t){return t===this?this:re(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toArray(t=[],e=0){for(let r=0;r<this.ELEMENTS;++r)t[e+r]=this[r];return t}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(te)}formatString(t){let e="";for(let r=0;r<this.ELEMENTS;++r)e+=(r>0?", ":"")+ee(this[r],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!ae(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,r){void 0===r&&(r=e,e=t,t=this);for(let n=0;n<this.ELEMENTS;++n){const s=t[n];this[n]=s+r*(e[n]-s)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t[r]),e[r]);return this.check()}add(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]+=e[t];return this.check()}subtract(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]-=e[t];return this.check()}scale(t){if(Array.isArray(t))return this.multiply(t);for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.scale(1/t)}clampScalar(t,e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t),e);return this.check()}multiplyByScalar(t){return this.scale(t)}get elements(){return this}check(){if(te.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}}function le(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function he(t,e,r=""){if(te.debug&&!function(t,e){if(t.length!==e)return!1;for(let e=0;e<t.length;++e)if(!Number.isFinite(t[e]))return!1;return!0}(t,e))throw new Error("math.gl: ".concat(r," some fields set to invalid numbers'"));return t}const ue={};function de(t,e){ue[t]||(ue[t]=!0,console.warn("".concat(t," has been removed in version ").concat(e,", see upgrade guide for more information")))}class fe extends ce{get ELEMENTS(){return Xt(!1),0}copy(t){return Xt(!1),this}get x(){return this[0]}set x(t){this[0]=le(t)}get y(){return this[1]}set y(t){this[1]=le(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let r=0;r<this.ELEMENTS;++r){const n=this[r]-t[r];e+=n*n}return le(e)}dot(t){let e=0;for(let r=0;r<this.ELEMENTS;++r)e+=this[r]*t[r];return le(e)}normalize(){const t=this.magnitude();if(0!==t)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e[t];return this.check()}divide(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e[t];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return Xt(t>=0&&t<this.ELEMENTS,"index is out of range"),le(this[t])}setComponent(t,e){return Xt(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}var me,Ae=1e-6,pe="undefined"!=typeof Float32Array?Float32Array:Array;function Be(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[3]*s+r[6],t[1]=r[1]*n+r[4]*s+r[7],t}function ge(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[4]*s+r[12],t[1]=r[1]*n+r[5]*s+r[13],t}function ye(t,e,r){const n=e[0],s=e[1],i=r[3]*n+r[7]*s||1;return t[0]=(r[0]*n+r[4]*s)/i,t[1]=(r[1]*n+r[5]*s)/i,t}function Ce(t,e,r){const n=e[0],s=e[1],i=e[2],o=r[3]*n+r[7]*s+r[11]*i||1;return t[0]=(r[0]*n+r[4]*s+r[8]*i)/o,t[1]=(r[1]*n+r[5]*s+r[9]*i)/o,t[2]=(r[2]*n+r[6]*s+r[10]*i)/o,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),me=new pe(2),pe!=Float32Array&&(me[0]=0,me[1]=0);class be extends fe{constructor(t=0,e=0){super(2),re(t)&&1===arguments.length?this.copy(t):(te.debug&&(le(t),le(e)),this[0]=t,this[1]=e)}set(t,e){return this[0]=t,this[1]=e,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return te.debug&&(le(t.x),le(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return ge(this,this,t),this.check()}transformAsVector(t){return ye(this,this,t),this.check()}transformByMatrix3(t){return Be(this,this,t),this.check()}transformByMatrix2x3(t){return function(t,e,r){var n=e[0],s=e[1];t[0]=r[0]*n+r[2]*s+r[4],t[1]=r[1]*n+r[3]*s+r[5]}(this,this,t),this.check()}transformByMatrix2(t){return function(t,e,r){var n=e[0],s=e[1];t[0]=r[0]*n+r[2]*s,t[1]=r[1]*n+r[3]*s}(this,this,t),this.check()}}function we(){var t=new pe(3);return pe!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Ee(t){var e=t[0],r=t[1],n=t[2];return Math.hypot(e,r,n)}function Te(t,e,r){var n=new pe(3);return n[0]=t,n[1]=e,n[2]=r,n}function ve(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Ie(t,e,r){var n=e[0],s=e[1],i=e[2],o=r[0],a=r[1],c=r[2];return t[0]=s*c-i*a,t[1]=i*o-n*c,t[2]=n*a-s*o,t}function _e(t,e,r){var n=e[0],s=e[1],i=e[2],o=r[3]*n+r[7]*s+r[11]*i+r[15];return o=o||1,t[0]=(r[0]*n+r[4]*s+r[8]*i+r[12])/o,t[1]=(r[1]*n+r[5]*s+r[9]*i+r[13])/o,t[2]=(r[2]*n+r[6]*s+r[10]*i+r[14])/o,t}function Me(t,e,r){var n=e[0],s=e[1],i=e[2];return t[0]=n*r[0]+s*r[3]+i*r[6],t[1]=n*r[1]+s*r[4]+i*r[7],t[2]=n*r[2]+s*r[5]+i*r[8],t}var Fe=Ee;we();const De=[0,0,0],Ge={};class xe extends fe{static get ZERO(){return Ge.ZERO=Ge.ZERO||Object.freeze(new xe(0,0,0,0))}constructor(t=0,e=0,r=0){super(-0,-0,-0),1===arguments.length&&re(t)?this.copy(t):(te.debug&&(le(t),le(e),le(r)),this[0]=t,this[1]=e,this[2]=r)}set(t,e,r){return this[0]=t,this[1]=e,this[2]=r,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return te.debug&&(le(t.x),le(t.y),le(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=le(t)}angle(t){return function(t,e){var r=t[0],n=t[1],s=t[2],i=e[0],o=e[1],a=e[2],c=Math.sqrt(r*r+n*n+s*s)*Math.sqrt(i*i+o*o+a*a),l=c&&ve(t,e)/c;return Math.acos(Math.min(Math.max(l,-1),1))}(this,t)}cross(t){return Ie(this,this,t),this.check()}rotateX({radians:t,origin:e=De}){return function(t,e,r,n){var s=[],i=[];s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],i[0]=s[0],i[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),i[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2]}(this,this,e,t),this.check()}rotateY({radians:t,origin:e=De}){return function(t,e,r,n){var s=[],i=[];s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],i[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),i[1]=s[1],i[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2]}(this,this,e,t),this.check()}rotateZ({radians:t,origin:e=De}){return function(t,e,r,n){var s=[],i=[];s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],i[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),i[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),i[2]=s[2],t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2]}(this,this,e,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return _e(this,this,t),this.check()}transformAsVector(t){return Ce(this,this,t),this.check()}transformByMatrix3(t){return Me(this,this,t),this.check()}transformByMatrix2(t){return function(t,e,r){const n=e[0],s=e[1];t[0]=r[0]*n+r[2]*s,t[1]=r[1]*n+r[3]*s,t[2]=e[2]}(this,this,t),this.check()}transformByQuaternion(t){return function(t,e,r){var n=r[0],s=r[1],i=r[2],o=r[3],a=e[0],c=e[1],l=e[2],h=s*l-i*c,u=i*a-n*l,d=n*c-s*a,f=s*d-i*u,m=i*h-n*d,A=n*u-s*h,p=2*o;h*=p,u*=p,d*=p,f*=2,m*=2,A*=2,t[0]=a+h+f,t[1]=c+u+m,t[2]=l+d+A}(this,this,t),this.check()}}class Se extends ce{get ELEMENTS(){return Xt(!1),0}get RANK(){return Xt(!1),0}toString(){let t="[";if(te.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let r=0;r<this.RANK;++r)t+=" ".concat(this[r*this.RANK+e])}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=" ".concat(this[e])}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,r){return this[e*this.RANK+t]=le(r),this}getColumn(t,e=new Array(this.RANK).fill(-0)){const r=t*this.RANK;for(let t=0;t<this.RANK;++t)e[t]=this[r+t];return e}setColumn(t,e){const r=t*this.RANK;for(let t=0;t<this.RANK;++t)this[r+t]=e[t];return this}}function Re(t,e,r){var n=e[0],s=e[1],i=e[2],o=e[3],a=e[4],c=e[5],l=e[6],h=e[7],u=e[8],d=r[0],f=r[1],m=r[2],A=r[3],p=r[4],B=r[5],g=r[6],y=r[7],C=r[8];return t[0]=d*n+f*o+m*l,t[1]=d*s+f*a+m*h,t[2]=d*i+f*c+m*u,t[3]=A*n+p*o+B*l,t[4]=A*s+p*a+B*h,t[5]=A*i+p*c+B*u,t[6]=g*n+y*o+C*l,t[7]=g*s+y*a+C*h,t[8]=g*i+y*c+C*u,t}function Oe(t,e,r){var n=r[0],s=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}const Ue=Object.freeze([1,0,0,0,1,0,0,0,1]),Le=Object.freeze([0,0,0,0,0,0,0,0,0]),Ne=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL1ROW0:3,COL1ROW1:4,COL1ROW2:5,COL2ROW0:6,COL2ROW1:7,COL2ROW2:8}),He={};class Je extends Se{static get IDENTITY(){return He.IDENTITY=He.IDENTITY||Object.freeze(new Je(Ue)),He.IDENTITY}static get ZERO(){return He.ZERO=He.ZERO||Object.freeze(new Je(Le)),He.ZERO}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Ne}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}set(t,e,r,n,s,i,o,a,c){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this[4]=s,this[5]=i,this[6]=o,this[7]=a,this[8]=c,this.check()}setRowMajor(t,e,r,n,s,i,o,a,c){return this[0]=t,this[1]=n,this[2]=o,this[3]=e,this[4]=s,this[5]=a,this[6]=r,this[7]=i,this[8]=c,this.check()}determinant(){return function(t){var e=t[0],r=t[1],n=t[2],s=t[3],i=t[4],o=t[5],a=t[6],c=t[7],l=t[8];return e*(l*i-o*c)+r*(-l*s+o*a)+n*(c*s-i*a)}(this)}identity(){return this.copy(Ue)}fromQuaternion(t){return function(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],o=r+r,a=n+n,c=s+s,l=r*o,h=n*o,u=n*a,d=s*o,f=s*a,m=s*c,A=i*o,p=i*a,B=i*c;t[0]=1-u-m,t[3]=h-B,t[6]=d+p,t[1]=h+B,t[4]=1-l-m,t[7]=f-A,t[2]=d-p,t[5]=f+A,t[8]=1-l-u}(this,t),this.check()}transpose(){return function(t,e){if(t===e){var r=e[1],n=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8]}(this,this),this.check()}invert(){return function(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],o=e[4],a=e[5],c=e[6],l=e[7],h=e[8],u=h*o-a*l,d=-h*i+a*c,f=l*i-o*c,m=r*u+n*d+s*f;m&&(m=1/m,t[0]=u*m,t[1]=(-h*n+s*l)*m,t[2]=(a*n-s*o)*m,t[3]=d*m,t[4]=(h*r-s*c)*m,t[5]=(-a*r+s*i)*m,t[6]=f*m,t[7]=(-l*r+n*c)*m,t[8]=(o*r-n*i)*m)}(this,this),this.check()}multiplyLeft(t){return Re(this,t,this),this.check()}multiplyRight(t){return Re(this,this,t),this.check()}rotate(t){return function(t,e,r){var n=e[0],s=e[1],i=e[2],o=e[3],a=e[4],c=e[5],l=e[6],h=e[7],u=e[8],d=Math.sin(r),f=Math.cos(r);t[0]=f*n+d*o,t[1]=f*s+d*a,t[2]=f*i+d*c,t[3]=f*o-d*n,t[4]=f*a-d*s,t[5]=f*c-d*i,t[6]=l,t[7]=h,t[8]=u}(this,this,t),this.check()}scale(t){return Array.isArray(t)?Oe(this,this,t):Oe(this,this,[t,t,t]),this.check()}translate(t){return function(t,e,r){var n=e[0],s=e[1],i=e[2],o=e[3],a=e[4],c=e[5],l=e[6],h=e[7],u=e[8],d=r[0],f=r[1];t[0]=n,t[1]=s,t[2]=i,t[3]=o,t[4]=a,t[5]=c,t[6]=d*n+f*o+l,t[7]=d*s+f*a+h,t[8]=d*i+f*c+u}(this,this,t),this.check()}transform(t,e){switch(t.length){case 2:e=Be(e||[-0,-0],t,this);break;case 3:e=Me(e||[-0,-0,-0],t,this);break;case 4:e=function(t,e,r){const n=e[0],s=e[1],i=e[2];return t[0]=r[0]*n+r[3]*s+r[6]*i,t[1]=r[1]*n+r[4]*s+r[7]*i,t[2]=r[2]*n+r[5]*s+r[8]*i,t[3]=e[3],t}(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return he(e,t.length),e}transformVector(t,e){return de("Matrix3.transformVector"),this.transform(t,e)}transformVector2(t,e){return de("Matrix3.transformVector"),this.transform(t,e)}transformVector3(t,e){return de("Matrix3.transformVector"),this.transform(t,e)}}function Pe(t,e,r){var n=e[0],s=e[1],i=e[2],o=e[3],a=e[4],c=e[5],l=e[6],h=e[7],u=e[8],d=e[9],f=e[10],m=e[11],A=e[12],p=e[13],B=e[14],g=e[15],y=r[0],C=r[1],b=r[2],w=r[3];return t[0]=y*n+C*a+b*u+w*A,t[1]=y*s+C*c+b*d+w*p,t[2]=y*i+C*l+b*f+w*B,t[3]=y*o+C*h+b*m+w*g,y=r[4],C=r[5],b=r[6],w=r[7],t[4]=y*n+C*a+b*u+w*A,t[5]=y*s+C*c+b*d+w*p,t[6]=y*i+C*l+b*f+w*B,t[7]=y*o+C*h+b*m+w*g,y=r[8],C=r[9],b=r[10],w=r[11],t[8]=y*n+C*a+b*u+w*A,t[9]=y*s+C*c+b*d+w*p,t[10]=y*i+C*l+b*f+w*B,t[11]=y*o+C*h+b*m+w*g,y=r[12],C=r[13],b=r[14],w=r[15],t[12]=y*n+C*a+b*u+w*A,t[13]=y*s+C*c+b*d+w*p,t[14]=y*i+C*l+b*f+w*B,t[15]=y*o+C*h+b*m+w*g,t}function je(t,e,r){var n=r[0],s=r[1],i=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}!function(){var t=new pe(4);pe!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();const ke=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Ve=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Ke=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15}),Qe={};class qe extends Se{static get IDENTITY(){return Qe.IDENTITY=Qe.IDENTITY||Object.freeze(new qe(ke)),Qe.IDENTITY}static get ZERO(){return Qe.ZERO=Qe.ZERO||Object.freeze(new qe(Ve)),Qe.ZERO}get INDICES(){return Ke}get ELEMENTS(){return 16}get RANK(){return 4}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,r,n,s,i,o,a,c,l,h,u,d,f,m,A){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this[4]=s,this[5]=i,this[6]=o,this[7]=a,this[8]=c,this[9]=l,this[10]=h,this[11]=u,this[12]=d,this[13]=f,this[14]=m,this[15]=A,this.check()}setRowMajor(t,e,r,n,s,i,o,a,c,l,h,u,d,f,m,A){return this[0]=t,this[1]=s,this[2]=c,this[3]=d,this[4]=e,this[5]=i,this[6]=l,this[7]=f,this[8]=r,this[9]=o,this[10]=h,this[11]=m,this[12]=n,this[13]=a,this[14]=u,this[15]=A,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(ke)}fromQuaternion(t){return function(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],o=r+r,a=n+n,c=s+s,l=r*o,h=n*o,u=n*a,d=s*o,f=s*a,m=s*c,A=i*o,p=i*a,B=i*c;t[0]=1-u-m,t[1]=h+B,t[2]=d-p,t[3]=0,t[4]=h-B,t[5]=1-l-m,t[6]=f+A,t[7]=0,t[8]=d+p,t[9]=f-A,t[10]=1-l-u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this,t),this.check()}frustum({left:t,right:e,bottom:r,top:n,near:s,far:i}){return i===1/0?qe._computeInfinitePerspectiveOffCenter(this,t,e,r,n,s):function(t,e,r,n,s,i,o){var a=1/(r-e),c=1/(s-n),l=1/(i-o);t[0]=2*i*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*i*c,t[6]=0,t[7]=0,t[8]=(r+e)*a,t[9]=(s+n)*c,t[10]=(o+i)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*i*2*l,t[15]=0}(this,t,e,r,n,s,i),this.check()}static _computeInfinitePerspectiveOffCenter(t,e,r,n,s,i){const o=2*i/(r-e),a=2*i/(s-n),c=(r+e)/(r-e),l=(s+n)/(s-n),h=-2*i;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=c,t[9]=l,t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=h,t[15]=0,t}lookAt(t,e,r){return 1===arguments.length&&({eye:t,center:e,up:r}=t),function(t,e,r,n){var s,i,o,a,c,l,h,u,d,f,m=e[0],A=e[1],p=e[2],B=n[0],g=n[1],y=n[2],C=r[0],b=r[1],w=r[2];Math.abs(m-C)<Ae&&Math.abs(A-b)<Ae&&Math.abs(p-w)<Ae?function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(t):(h=m-C,u=A-b,d=p-w,s=g*(d*=f=1/Math.hypot(h,u,d))-y*(u*=f),i=y*(h*=f)-B*d,o=B*u-g*h,(f=Math.hypot(s,i,o))?(s*=f=1/f,i*=f,o*=f):(s=0,i=0,o=0),a=u*o-d*i,c=d*s-h*o,l=h*i-u*s,(f=Math.hypot(a,c,l))?(a*=f=1/f,c*=f,l*=f):(a=0,c=0,l=0),t[0]=s,t[1]=a,t[2]=h,t[3]=0,t[4]=i,t[5]=c,t[6]=u,t[7]=0,t[8]=o,t[9]=l,t[10]=d,t[11]=0,t[12]=-(s*m+i*A+o*p),t[13]=-(a*m+c*A+l*p),t[14]=-(h*m+u*A+d*p),t[15]=1)}(this,t,e=e||[0,0,0],r=r||[0,1,0]),this.check()}ortho({left:t,right:e,bottom:r,top:n,near:s=.1,far:i=500}){return function(t,e,r,n,s,i,o){var a=1/(e-r),c=1/(n-s),l=1/(i-o);t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+r)*a,t[13]=(s+n)*c,t[14]=(o+i)*l,t[15]=1}(this,t,e,r,n,s,i),this.check()}orthographic({fovy:t=45*Math.PI/180,aspect:e=1,focalDistance:r=1,near:n=.1,far:s=500}){if(t>2*Math.PI)throw Error("radians");const i=t/2,o=r*Math.tan(i),a=o*e;return(new qe).ortho({left:-a,right:a,bottom:-o,top:o,near:n,far:s})}perspective({fovy:t,fov:e=45*Math.PI/180,aspect:r=1,near:n=.1,far:s=500}={}){if((t=t||e)>2*Math.PI)throw Error("radians");return function(t,e,r,n,s){var i,o=1/Math.tan(e/2);t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=s&&s!==1/0?(i=1/(n-s),t[10]=(s+n)*i,t[14]=2*s*n*i):(t[10]=-1,t[14]=-2*n)}(this,t,r,n,s),this.check()}determinant(){return function(t){var e=t[0],r=t[1],n=t[2],s=t[3],i=t[4],o=t[5],a=t[6],c=t[7],l=t[8],h=t[9],u=t[10],d=t[11],f=t[12],m=t[13],A=t[14],p=t[15];return(e*o-r*i)*(u*p-d*A)-(e*a-n*i)*(h*p-d*m)+(e*c-s*i)*(h*A-u*m)+(r*a-n*o)*(l*p-d*f)-(r*c-s*o)*(l*A-u*f)+(n*c-s*a)*(l*m-h*f)}(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t=[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=null){const r=this.getScale(e||[-0,-0,-0]),n=1/r[0],s=1/r[1],i=1/r[2];return t[0]=this[0]*n,t[1]=this[1]*s,t[2]=this[2]*i,t[3]=0,t[4]=this[4]*n,t[5]=this[5]*s,t[6]=this[6]*i,t[7]=0,t[8]=this[8]*n,t[9]=this[9]*s,t[10]=this[10]*i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t=[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=null){const r=this.getScale(e||[-0,-0,-0]),n=1/r[0],s=1/r[1],i=1/r[2];return t[0]=this[0]*n,t[1]=this[1]*s,t[2]=this[2]*i,t[3]=this[4]*n,t[4]=this[5]*s,t[5]=this[6]*i,t[6]=this[8]*n,t[7]=this[9]*s,t[8]=this[10]*i,t}transpose(){return function(t,e){if(t===e){var r=e[1],n=e[2],s=e[3],i=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=i,t[11]=e[14],t[12]=s,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15]}(this,this),this.check()}invert(){return function(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],o=e[4],a=e[5],c=e[6],l=e[7],h=e[8],u=e[9],d=e[10],f=e[11],m=e[12],A=e[13],p=e[14],B=e[15],g=r*a-n*o,y=r*c-s*o,C=r*l-i*o,b=n*c-s*a,w=n*l-i*a,E=s*l-i*c,T=h*A-u*m,v=h*p-d*m,I=h*B-f*m,_=u*p-d*A,M=u*B-f*A,F=d*B-f*p,D=g*F-y*M+C*_+b*I-w*v+E*T;D&&(D=1/D,t[0]=(a*F-c*M+l*_)*D,t[1]=(s*M-n*F-i*_)*D,t[2]=(A*E-p*w+B*b)*D,t[3]=(d*w-u*E-f*b)*D,t[4]=(c*I-o*F-l*v)*D,t[5]=(r*F-s*I+i*v)*D,t[6]=(p*C-m*E-B*y)*D,t[7]=(h*E-d*C+f*y)*D,t[8]=(o*M-a*I+l*T)*D,t[9]=(n*I-r*M-i*T)*D,t[10]=(m*w-A*C+B*g)*D,t[11]=(u*C-h*w-f*g)*D,t[12]=(a*v-o*_-c*T)*D,t[13]=(r*_-n*v+s*T)*D,t[14]=(A*y-m*b-p*g)*D,t[15]=(h*b-u*y+d*g)*D)}(this,this),this.check()}multiplyLeft(t){return Pe(this,t,this),this.check()}multiplyRight(t){return Pe(this,this,t),this.check()}rotateX(t){return function(t,e,r){var n=Math.sin(r),s=Math.cos(r),i=e[4],o=e[5],a=e[6],c=e[7],l=e[8],h=e[9],u=e[10],d=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=i*s+l*n,t[5]=o*s+h*n,t[6]=a*s+u*n,t[7]=c*s+d*n,t[8]=l*s-i*n,t[9]=h*s-o*n,t[10]=u*s-a*n,t[11]=d*s-c*n}(this,this,t),this.check()}rotateY(t){return function(t,e,r){var n=Math.sin(r),s=Math.cos(r),i=e[0],o=e[1],a=e[2],c=e[3],l=e[8],h=e[9],u=e[10],d=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*s-l*n,t[1]=o*s-h*n,t[2]=a*s-u*n,t[3]=c*s-d*n,t[8]=i*n+l*s,t[9]=o*n+h*s,t[10]=a*n+u*s,t[11]=c*n+d*s}(this,this,t),this.check()}rotateZ(t){return function(t,e,r){var n=Math.sin(r),s=Math.cos(r),i=e[0],o=e[1],a=e[2],c=e[3],l=e[4],h=e[5],u=e[6],d=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*s+l*n,t[1]=o*s+h*n,t[2]=a*s+u*n,t[3]=c*s+d*n,t[4]=l*s-i*n,t[5]=h*s-o*n,t[6]=u*s-a*n,t[7]=d*s-c*n}(this,this,t),this.check()}rotateXYZ([t,e,r]){return this.rotateX(t).rotateY(e).rotateZ(r)}rotateAxis(t,e){return function(t,e,r,n){var s,i,o,a,c,l,h,u,d,f,m,A,p,B,g,y,C,b,w,E,T,v,I,_,M=n[0],F=n[1],D=n[2],G=Math.hypot(M,F,D);G<Ae||(M*=G=1/G,F*=G,D*=G,s=Math.sin(r),o=1-(i=Math.cos(r)),a=e[0],c=e[1],l=e[2],h=e[3],u=e[4],d=e[5],f=e[6],m=e[7],A=e[8],p=e[9],B=e[10],g=e[11],y=M*M*o+i,C=F*M*o+D*s,b=D*M*o-F*s,w=M*F*o-D*s,E=F*F*o+i,T=D*F*o+M*s,v=M*D*o+F*s,I=F*D*o-M*s,_=D*D*o+i,t[0]=a*y+u*C+A*b,t[1]=c*y+d*C+p*b,t[2]=l*y+f*C+B*b,t[3]=h*y+m*C+g*b,t[4]=a*w+u*E+A*T,t[5]=c*w+d*E+p*T,t[6]=l*w+f*E+B*T,t[7]=h*w+m*E+g*T,t[8]=a*v+u*I+A*_,t[9]=c*v+d*I+p*_,t[10]=l*v+f*I+B*_,t[11]=h*v+m*I+g*_,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(this,this,t,e),this.check()}scale(t){return Array.isArray(t)?je(this,this,t):je(this,this,[t,t,t]),this.check()}translate(t){return function(t,e,r){var n,s,i,o,a,c,l,h,u,d,f,m,A=r[0],p=r[1],B=r[2];e===t?(t[12]=e[0]*A+e[4]*p+e[8]*B+e[12],t[13]=e[1]*A+e[5]*p+e[9]*B+e[13],t[14]=e[2]*A+e[6]*p+e[10]*B+e[14],t[15]=e[3]*A+e[7]*p+e[11]*B+e[15]):(n=e[0],s=e[1],i=e[2],o=e[3],a=e[4],c=e[5],l=e[6],h=e[7],u=e[8],d=e[9],f=e[10],m=e[11],t[0]=n,t[1]=s,t[2]=i,t[3]=o,t[4]=a,t[5]=c,t[6]=l,t[7]=h,t[8]=u,t[9]=d,t[10]=f,t[11]=m,t[12]=n*A+a*p+u*B+e[12],t[13]=s*A+c*p+d*B+e[13],t[14]=i*A+l*p+f*B+e[14],t[15]=o*A+h*p+m*B+e[15])}(this,this,t),this.check()}transform(t,e){return 4===t.length?(e=function(t,e,r){var n=e[0],s=e[1],i=e[2],o=e[3];return t[0]=r[0]*n+r[4]*s+r[8]*i+r[12]*o,t[1]=r[1]*n+r[5]*s+r[9]*i+r[13]*o,t[2]=r[2]*n+r[6]*s+r[10]*i+r[14]*o,t[3]=r[3]*n+r[7]*s+r[11]*i+r[15]*o,t}(e||[-0,-0,-0,-0],t,this),he(e,4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:r}=t;switch(r){case 2:e=ge(e||[-0,-0],t,this);break;case 3:e=_e(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return he(e,t.length),e}transformAsVector(t,e){switch(t.length){case 2:e=ye(e||[-0,-0],t,this);break;case 3:e=Ce(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return he(e,t.length),e}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,r){return this.identity().translate([t,e,r])}transformPoint(t,e){return de("Matrix4.transformPoint","3.0"),this.transformAsPoint(t,e)}transformVector(t,e){return de("Matrix4.transformVector","3.0"),this.transformAsPoint(t,e)}transformDirection(t,e){return de("Matrix4.transformDirection","3.0"),this.transformAsVector(t,e)}}function ze(){var t=new pe(4);return pe!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function We(t,e,r){r*=.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function Ye(t,e,r){var n=e[0],s=e[1],i=e[2],o=e[3],a=r[0],c=r[1],l=r[2],h=r[3];return t[0]=n*h+o*a+s*l-i*c,t[1]=s*h+o*c+i*a-n*l,t[2]=i*h+o*l+n*c-s*a,t[3]=o*h-n*a-s*c-i*l,t}var Xe,Ze,$e,tr=(Xe=we(),Ze=Te(1,0,0),$e=Te(0,1,0),function(t,e,r){var n=ve(e,r);return n<-.999999?(Ie(Xe,Ze,e),Fe(Xe)<1e-6&&Ie(Xe,$e,e),function(t,e){var r=e[0],n=e[1],s=e[2],i=r*r+n*n+s*s;i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}(Xe,Xe),We(t,Xe,Math.PI),t):n>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Ie(Xe,e,r),t[0]=Xe[0],t[1]=Xe[1],t[2]=Xe[2],t[3]=1+n,function(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],o=r*r+n*n+s*s+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=r*o,t[1]=n*o,t[2]=s*o,t[3]=i*o,t}(t,t))});ze(),ze(),function(){var t=new pe(9);pe!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1}();const er=[0,0,0,1];class rr extends ce{constructor(t=0,e=0,r=0,n=1){super(-0,-0,-0,-0),Array.isArray(t)&&1===arguments.length?this.copy(t):this.set(t,e,r,n)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,e,r,n){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this.check()}fromMatrix3(t){return function(t,e){var r,n=e[0]+e[4]+e[8];if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);var i=(s+1)%3,o=(s+2)%3;r=Math.sqrt(e[3*s+s]-e[3*i+i]-e[3*o+o]+1),t[s]=.5*r,r=.5/r,t[3]=(e[3*i+o]-e[3*o+i])*r,t[i]=(e[3*i+s]+e[3*s+i])*r,t[o]=(e[3*o+s]+e[3*s+o])*r}}(this,t),this.check()}identity(){return function(t){t[0]=0,t[1]=0,t[2]=0,t[3]=1}(this),this.check()}fromAxisRotation(t,e){return We(this,t,e),this.check()}setAxisAngle(t,e){return this.fromAxisRotation(t,e)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=le(t)}get y(){return this[1]}set y(t){this[1]=le(t)}get z(){return this[2]}set z(t){this[2]=le(t)}get w(){return this[3]}set w(t){this[3]=le(t)}len(){return function(t){var e=t[0],r=t[1],n=t[2],s=t[3];return Math.hypot(e,r,n,s)}(this)}lengthSquared(){return function(t){var e=t[0],r=t[1],n=t[2],s=t[3];return e*e+r*r+n*n+s*s}(this)}dot(t,e){if(void 0!==e)throw new Error("Quaternion.dot only takes one argument");return function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}(this,t)}rotationTo(t,e){return tr(this,t,e),this.check()}add(t,e){if(void 0!==e)throw new Error("Quaternion.add only takes one argument");return function(t,e,r){t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3]}(this,this,t),this.check()}calculateW(){return function(t,e){var r=e[0],n=e[1],s=e[2];t[0]=r,t[1]=n,t[2]=s,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-s*s))}(this,this),this.check()}conjugate(){return function(t,e){t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3]}(this,this),this.check()}invert(){return function(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],o=r*r+n*n+s*s+i*i,a=o?1/o:0;t[0]=-r*a,t[1]=-n*a,t[2]=-s*a,t[3]=i*a}(this,this),this.check()}lerp(t,e,r){return function(t,e,r,n){var s=e[0],i=e[1],o=e[2],a=e[3];t[0]=s+n*(r[0]-s),t[1]=i+n*(r[1]-i),t[2]=o+n*(r[2]-o),t[3]=a+n*(r[3]-a)}(this,t,e,r),this.check()}multiplyRight(t,e){return Xt(!e),Ye(this,this,t),this.check()}multiplyLeft(t,e){return Xt(!e),Ye(this,t,this),this.check()}normalize(){const t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,0===t&&(this[3]=1),this.check()}rotateX(t){return function(t,e,r){r*=.5;var n=e[0],s=e[1],i=e[2],o=e[3],a=Math.sin(r),c=Math.cos(r);t[0]=n*c+o*a,t[1]=s*c+i*a,t[2]=i*c-s*a,t[3]=o*c-n*a}(this,this,t),this.check()}rotateY(t){return function(t,e,r){r*=.5;var n=e[0],s=e[1],i=e[2],o=e[3],a=Math.sin(r),c=Math.cos(r);t[0]=n*c-i*a,t[1]=s*c+o*a,t[2]=i*c+n*a,t[3]=o*c-s*a}(this,this,t),this.check()}rotateZ(t){return function(t,e,r){r*=.5;var n=e[0],s=e[1],i=e[2],o=e[3],a=Math.sin(r),c=Math.cos(r);t[0]=n*c+s*a,t[1]=s*c-n*a,t[2]=i*c+o*a,t[3]=o*c-i*a}(this,this,t),this.check()}scale(t){return function(t,e,r){t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r}(this,this,t),this.check()}slerp(t,e,r){switch(arguments.length){case 1:({start:t=er,target:e,ratio:r}=arguments[0]);break;case 2:[e,r]=arguments,t=this}return function(t,e,r,n){var s,i,o,a,c,l=e[0],h=e[1],u=e[2],d=e[3],f=r[0],m=r[1],A=r[2],p=r[3];(i=l*f+h*m+u*A+d*p)<0&&(i=-i,f=-f,m=-m,A=-A,p=-p),1-i>Ae?(s=Math.acos(i),o=Math.sin(s),a=Math.sin((1-n)*s)/o,c=Math.sin(n*s)/o):(a=1-n,c=n),t[0]=a*l+c*f,t[1]=a*h+c*m,t[2]=a*u+c*A,t[3]=a*d+c*p}(this,t,e,r),this.check()}transformVector4(t,e=t){return function(t,e,r){var n=e[0],s=e[1],i=e[2],o=r[0],a=r[1],c=r[2],l=r[3],h=l*n+a*i-c*s,u=l*s+c*n-o*i,d=l*i+o*s-a*n,f=-o*n-a*s-c*i;t[0]=h*l+f*-o+u*-c-d*-a,t[1]=u*l+f*-a+d*-o-h*-c,t[2]=d*l+f*-c+h*-a-u*-o,t[3]=e[3]}(e,t,this),he(e,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,e){return this.setAxisAngle(t,e)}premultiply(t,e){return this.multiplyLeft(t,e)}multiply(t,e){return this.multiplyRight(t,e)}}Math.PI,Math.PI,Math.PI,Math.PI;const nr=t=>t,sr=new xe;const ir=new xe,or=new xe,ar=new xe,cr=new xe,lr={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},hr={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},ur={east:new xe,north:new xe,up:new xe,west:new xe,south:new xe,down:new xe},dr=new xe,fr=new xe,mr=new xe;function Ar(t,e,r,n,s,i){const o=lr[e]&&lr[e][r];let a,c,l;Xt(o&&(!n||n===o));const h=cr.copy(s);if(ae(h.x,0,1e-14)&&ae(h.y,0,1e-14)){const t=Math.sign(h.z);a=dr.fromArray(hr[e]),"east"!==e&&"west"!==e&&a.scale(t),c=fr.fromArray(hr[r]),"east"!==r&&"west"!==r&&c.scale(t),l=mr.fromArray(hr[n]),"east"!==n&&"west"!==n&&l.scale(t)}else{const{up:s,east:i,north:o}=ur;i.set(-h.y,h.x,0).normalize(),t.geodeticSurfaceNormal(h,s),o.copy(s).cross(i);const{down:u,west:d,south:f}=ur;u.copy(s).scale(-1),d.copy(i).scale(-1),f.copy(o).scale(-1),a=ur[e],c=ur[r],l=ur[n]}return i[0]=a.x,i[1]=a.y,i[2]=a.z,i[3]=0,i[4]=c.x,i[5]=c.y,i[6]=c.z,i[7]=0,i[8]=l.x,i[9]=l.y,i[10]=l.z,i[11]=0,i[12]=h.x,i[13]=h.y,i[14]=h.z,i[15]=1,i}const pr=new xe,Br=new xe,gr=new xe,yr=new xe,Cr=new xe,br=new xe;let wr;class Er{static get WGS84(){return wr=wr||new Er(6378137,6378137,6356752.314245179),wr}constructor(t=0,e=0,r=0){Xt(t>=0),Xt(e>=0),Xt(r>=0),this.radii=new xe(t,e,r),this.radiiSquared=new xe(t*t,e*e,r*r),this.radiiToTheFourth=new xe(t*t*t*t,e*e*e*e,r*r*r*r),this.oneOverRadii=new xe(0===t?0:1/t,0===e?0:1/e,0===r?0:1/r),this.oneOverRadiiSquared=new xe(0===t?0:1/(t*t),0===e?0:1/(e*e),0===r?0:1/(r*r)),this.minimumRadius=Math.min(t,e,r),this.maximumRadius=Math.max(t,e,r),this.centerToleranceSquared=.1,0!==this.radiiSquared.z&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(t){return this===t||Boolean(t&&this.radii.equals(t.radii))}toString(){return this.radii.toString()}cartographicToCartesian(t,e=[0,0,0]){const r=Br,n=gr,[,,s]=t;this.geodeticSurfaceNormalCartographic(t,r),n.copy(this.radiiSquared).scale(r);const i=Math.sqrt(r.dot(n));return n.scale(1/i),r.scale(s),n.add(r),n.to(e)}cartesianToCartographic(t,e=[0,0,0]){br.from(t);const r=this.scaleToGeodeticSurface(br,yr);if(!r)return;const n=this.geodeticSurfaceNormal(r,Br),s=Cr;return s.copy(br).subtract(r),function(t,e,r=nr){return re(e)?(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]):"longitude"in e?(e.longitude=r(t[0]),e.latitude=r(t[1]),e.height=t[2]):(e.x=r(t[0]),e.y=r(t[1]),e.z=t[2]),e}([Math.atan2(n.y,n.x),Math.asin(n.z),Math.sign(ve(s,br))*Ee(s)],e,te._cartographicRadians?nr:ie)}eastNorthUpToFixedFrame(t,e=new qe){return Ar(this,"east","north","up",t,e)}localFrameToFixedFrame(t,e,r,n,s=new qe){return Ar(this,t,e,r,n,s)}geocentricSurfaceNormal(t,e=[0,0,0]){return pr.from(t).normalize().to(e)}geodeticSurfaceNormalCartographic(t,e=[0,0,0]){const r=function(t,e=sr){return function(t,e,r=nr){return re(t)?(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]):"longitude"in t?(e[0]=r(t.longitude),e[1]=r(t.latitude),e[2]=t.height):(e[0]=r(t.x),e[1]=r(t.y),e[2]=t.z),e}(t,e,te._cartographicRadians?nr:se)}(t),n=r[0],s=r[1],i=Math.cos(s);return pr.set(i*Math.cos(n),i*Math.sin(n),Math.sin(s)).normalize(),pr.to(e)}geodeticSurfaceNormal(t,e=[0,0,0]){return pr.from(t).scale(this.oneOverRadiiSquared).normalize().to(e)}scaleToGeodeticSurface(t,e){return function(t,e,r=new xe){const{oneOverRadii:n,oneOverRadiiSquared:s,centerToleranceSquared:i}=e;ir.from(t);const o=t.x,a=t.y,c=t.z,l=n.x,h=n.y,u=n.z,d=o*o*l*l,f=a*a*h*h,m=c*c*u*u,A=d+f+m,p=Math.sqrt(1/A);if(!Number.isFinite(p))return;const B=or;if(B.copy(t).scale(p),A<i)return B.to(r);const g=s.x,y=s.y,C=s.z,b=ar;b.set(B.x*g*2,B.y*y*2,B.z*C*2);let w,E,T,v,I=(1-p)*t.len()/(.5*b.len()),_=0;do{I-=_,w=1/(1+I*g),E=1/(1+I*y),T=1/(1+I*C);const t=w*w,e=E*E,r=T*T;v=d*t+f*e+m*r-1,_=v/(-2*(d*(t*w)*g+f*(e*E)*y+m*(r*T)*C))}while(Math.abs(v)>1e-12);return ir.scale([w,E,T]).to(r)}(t,this,e)}scaleToGeocentricSurface(t,e=[0,0,0]){yr.from(t);const r=yr.x,n=yr.y,s=yr.z,i=this.oneOverRadiiSquared,o=1/Math.sqrt(r*r*i.x+n*n*i.y+s*s*i.z);return yr.multiplyScalar(o).to(e)}transformPositionToScaledSpace(t,e=[0,0,0]){return yr.from(t).scale(this.oneOverRadii).to(e)}transformPositionFromScaledSpace(t,e=[0,0,0]){return yr.from(t).scale(this.radii).to(e)}getSurfaceNormalIntersectionWithZAxis(t,e=0,r=[0,0,0]){Xt(ae(this.radii.x,this.radii.y,1e-15)),Xt(this.radii.z>0),yr.from(t);const n=yr.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(n)>=this.radii.z-e))return yr.set(0,0,n).to(r)}}class Tr{constructor(t,e,r){m(this,"item",void 0),m(this,"previous",void 0),m(this,"next",void 0),this.item=t,this.previous=e,this.next=r}}class vr{constructor(){m(this,"head",null),m(this,"tail",null),m(this,"_length",0)}get length(){return this._length}add(t){const e=new Tr(t,this.tail,null);return this.tail?(this.tail.next=e,this.tail=e):(this.head=e,this.tail=e),++this._length,e}remove(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}splice(t,e){t!==e&&(this.remove(e),this._insert(t,e))}_insert(t,e){const r=t.next;t.next=e,this.tail===t?this.tail=e:r.previous=e,e.next=r,e.previous=t,++this._length}}function Ir(t){return null!=t}class _r{constructor(){m(this,"_list",void 0),m(this,"_sentinel",void 0),m(this,"_trimTiles",void 0),this._list=new vr,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){const e=t._cacheNode;Ir(e)&&this._list.splice(this._sentinel,e)}add(t,e,r){Ir(e._cacheNode)||(e._cacheNode=this._list.add(e),r&&r(t,e))}unloadTile(t,e,r){const n=e._cacheNode;Ir(n)&&(this._list.remove(n),e._cacheNode=void 0,r&&r(t,e))}unloadTiles(t,e){const r=this._trimTiles;this._trimTiles=!1;const n=this._list,s=1024*t.maximumMemoryUsage*1024,i=this._sentinel;let o=n.head;for(;o!==i&&(t.gpuMemoryUsageInBytes>s||r);){const r=o.item;o=o.next,this.unloadTile(t,r,e)}}trim(){this._trimTiles=!0}}const Mr=Object.freeze({OUTSIDE:-1,INTERSECTING:0,INSIDE:1});new xe,new xe;const Fr=new xe,Dr=new xe;class Gr{constructor(t=[0,0,0],e=0){this.radius=-0,this.center=new xe,this.fromCenterRadius(t,e)}fromCenterRadius(t,e){return this.center.from(t),this.radius=e,this}fromCornerPoints(t,e){return e=Fr.from(e),this.center=(new xe).from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}equals(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new Gr(this.center,this.radius)}union(t){const e=this.center,r=this.radius,n=t.center,s=t.radius,i=Fr.copy(n).subtract(e),o=i.magnitude();if(r>=o+s)return this.clone();if(s>=o+r)return t.clone();const a=.5*(r+o+s);return Dr.copy(i).scale((-r+a)/o).add(e),this.center.copy(Dr),this.radius=a,this}expand(t){const e=(t=Fr.from(t)).subtract(this.center).magnitude();return e>this.radius&&(this.radius=e),this}transform(t){this.center.transform(t);const e=function(t,e){var r=e[0],n=e[1],s=e[2],i=e[4],o=e[5],a=e[6],c=e[8],l=e[9],h=e[10];return t[0]=Math.hypot(r,n,s),t[1]=Math.hypot(i,o,a),t[2]=Math.hypot(c,l,h),t}(Fr,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}distanceSquaredTo(t){const e=this.distanceTo(t);return e*e}distanceTo(t){const e=(t=Fr.from(t)).subtract(this.center);return Math.max(0,e.len()-this.radius)}intersectPlane(t){const e=this.center,r=this.radius,n=t.normal.dot(e)+t.distance;return n<-r?Mr.OUTSIDE:n<r?Mr.INTERSECTING:Mr.INSIDE}}const xr=new xe,Sr=new xe,Rr=new xe,Or=new xe,Ur=new xe,Lr=new xe,Nr=new xe;class Hr{constructor(t=[0,0,0],e=[0,0,0,0,0,0,0,0,0]){this.center=(new xe).from(t),this.halfAxes=new Je(e)}get halfSize(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new xe(t).len(),new xe(e).len(),new xe(r).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),n=new xe(t).normalize(),s=new xe(e).normalize(),i=new xe(r).normalize();return(new rr).fromMatrix3(new Je([...n,...s,...i]))}fromCenterHalfSizeQuaternion(t,e,r){const n=new rr(r),s=(new Je).fromQuaternion(n);return s[0]=s[0]*e[0],s[1]=s[1]*e[0],s[2]=s[2]*e[0],s[3]=s[3]*e[1],s[4]=s[4]*e[1],s[5]=s[5]*e[1],s[6]=s[6]*e[2],s[7]=s[7]*e[2],s[8]=s[8]*e[2],this.center=(new xe).from(t),this.halfAxes=s,this}clone(){return new Hr(this.center,this.halfAxes)}equals(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(t=new Gr){const e=this.halfAxes,r=e.getColumn(0,Rr),n=e.getColumn(1,Or),s=e.getColumn(2,Ur),i=xr.copy(r).add(n).add(s);return t.center.copy(this.center),t.radius=i.magnitude(),t}intersectPlane(t){const e=this.center,r=t.normal,n=this.halfAxes,s=r.x,i=r.y,o=r.z,a=Math.abs(s*n[0]+i*n[1]+o*n[2])+Math.abs(s*n[3]+i*n[4]+o*n[5])+Math.abs(s*n[6]+i*n[7]+o*n[8]),c=r.dot(e)+t.distance;return c<=-a?Mr.OUTSIDE:c>=a?Mr.INSIDE:Mr.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const e=Sr.from(t).subtract(this.center),r=this.halfAxes,n=r.getColumn(0,Rr),s=r.getColumn(1,Or),i=r.getColumn(2,Ur),o=n.magnitude(),a=s.magnitude(),c=i.magnitude();n.normalize(),s.normalize(),i.normalize();let l,h=0;return l=Math.abs(e.dot(n))-o,l>0&&(h+=l*l),l=Math.abs(e.dot(s))-a,l>0&&(h+=l*l),l=Math.abs(e.dot(i))-c,l>0&&(h+=l*l),h}computePlaneDistances(t,e,r=[-0,-0]){let n=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const i=this.center,o=this.halfAxes,a=o.getColumn(0,Rr),c=o.getColumn(1,Or),l=o.getColumn(2,Ur),h=Lr.copy(a).add(c).add(l).add(i),u=Nr.copy(h).subtract(t);let d=e.dot(u);return n=Math.min(d,n),s=Math.max(d,s),h.copy(i).add(a).add(c).subtract(l),u.copy(h).subtract(t),d=e.dot(u),n=Math.min(d,n),s=Math.max(d,s),h.copy(i).add(a).subtract(c).add(l),u.copy(h).subtract(t),d=e.dot(u),n=Math.min(d,n),s=Math.max(d,s),h.copy(i).add(a).subtract(c).subtract(l),u.copy(h).subtract(t),d=e.dot(u),n=Math.min(d,n),s=Math.max(d,s),i.copy(h).subtract(a).add(c).add(l),u.copy(h).subtract(t),d=e.dot(u),n=Math.min(d,n),s=Math.max(d,s),i.copy(h).subtract(a).add(c).subtract(l),u.copy(h).subtract(t),d=e.dot(u),n=Math.min(d,n),s=Math.max(d,s),i.copy(h).subtract(a).subtract(c).add(l),u.copy(h).subtract(t),d=e.dot(u),n=Math.min(d,n),s=Math.max(d,s),i.copy(h).subtract(a).subtract(c).subtract(l),u.copy(h).subtract(t),d=e.dot(u),n=Math.min(d,n),s=Math.max(d,s),r[0]=n,r[1]=s,r}transform(t){this.center.transformAsPoint(t);const e=this.halfAxes.getColumn(0,Rr);e.transformAsPoint(t);const r=this.halfAxes.getColumn(1,Or);r.transformAsPoint(t);const n=this.halfAxes.getColumn(2,Ur);return n.transformAsPoint(t),this.halfAxes=new Je([...e,...r,...n]),this}getTransform(){throw new Error("not implemented")}}const Jr=new xe,Pr=new xe;class jr{constructor(t=[0,0,1],e=0){this.normal=new xe,this.distance=-0,this.fromNormalDistance(t,e)}fromNormalDistance(t,e){return Xt(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}fromPointNormal(t,e){t=Jr.from(t),this.normal.from(e).normalize();const r=-this.normal.dot(t);return this.distance=r,this}fromCoefficients(t,e,r,n){return this.normal.set(t,e,r),Xt(ae(this.normal.len(),1)),this.distance=n,this}clone(t){return new jr(this.normal,this.distance)}equals(t){return ae(this.distance,t.distance)&&ae(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const e=Pr.copy(this.normal).transformAsVector(t).normalize(),r=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(r,e)}projectPointOntoPlane(t,e=[0,0,0]){t=Jr.from(t);const r=this.getPointDistance(t),n=Pr.copy(this.normal).scale(r);return t.subtract(n).to(e)}}const kr=[new xe([1,0,0]),new xe([0,1,0]),new xe([0,0,1])],Vr=new xe,Kr=new xe;new jr(new xe(1,0,0),0);class Qr{static get MASK_OUTSIDE(){return 4294967295}static get MASK_INSIDE(){return 0}static get MASK_INDETERMINATE(){return 2147483647}constructor(t=[]){this.planes=t,Xt(this.planes.every((t=>t instanceof jr)))}fromBoundingSphere(t){this.planes.length=2*kr.length;const e=t.center,r=t.radius;let n=0;for(const t of kr){let s=this.planes[n],i=this.planes[n+1];s||(s=this.planes[n]=new jr),i||(i=this.planes[n+1]=new jr);const o=Vr.copy(t).scale(-r).add(e);t.dot(o),s.fromPointNormal(o,t);const a=Vr.copy(t).scale(r).add(e),c=Kr.copy(t).negate();c.dot(a),i.fromPointNormal(a,c),n+=2}return this}computeVisibility(t){Xt(t);let e=Mr.INSIDE;for(const r of this.planes)switch(t.intersectPlane(r)){case Mr.OUTSIDE:return Mr.OUTSIDE;case Mr.INTERSECTING:e=Mr.INTERSECTING}return e}computeVisibilityWithPlaneMask(t,e){if(Xt(t,"boundingVolume is required."),Xt(Number.isFinite(e),"parentPlaneMask is required."),e===Qr.MASK_OUTSIDE||e===Qr.MASK_INSIDE)return e;let r=Qr.MASK_INSIDE;const n=this.planes;for(let s=0;s<this.planes.length;++s){const i=s<31?1<<s:0;if(s<31&&0==(e&i))continue;const o=n[s],a=t.intersectPlane(o);if(a===Mr.OUTSIDE)return Qr.MASK_OUTSIDE;a===Mr.INTERSECTING&&(r|=i)}return r}}const qr=new xe,zr=new xe,Wr=new xe,Yr=new xe,Xr=new xe;class Zr{constructor(t={}){t={near:1,far:5e8,...t},this.left=t.left,this._left=void 0,this.right=t.right,this._right=void 0,this.top=t.top,this._top=void 0,this.bottom=t.bottom,this._bottom=void 0,this.near=t.near,this._near=this.near,this.far=t.far,this._far=this.far,this._cullingVolume=new Qr([new jr,new jr,new jr,new jr,new jr,new jr]),this._perspectiveMatrix=new qe,this._infinitePerspective=new qe}clone(){return new Zr({right:this.right,left:this.left,top:this.top,bottom:this.bottom,near:this.near,far:this.far})}equals(t){return t&&t instanceof Zr&&this.right===t.right&&this.left===t.left&&this.top===t.top&&this.bottom===t.bottom&&this.near===t.near&&this.far===t.far}get projectionMatrix(){return $r(this),this._perspectiveMatrix}get infiniteProjectionMatrix(){return $r(this),this._infinitePerspective}computeCullingVolume(t,e,r){Xt(t,"position is required."),Xt(e,"direction is required."),Xt(r,"up is required.");const n=this._cullingVolume.planes;r=qr.copy(r).normalize();const s=zr.copy(e).cross(r).normalize(),i=Wr.copy(e).multiplyByScalar(this.near).add(t),o=Yr.copy(e).multiplyByScalar(this.far).add(t);let a=Xr;return a.copy(s).multiplyByScalar(this.left).add(i).subtract(t).cross(r),n[0].fromPointNormal(t,a),a.copy(s).multiplyByScalar(this.right).add(i).subtract(t).cross(r).negate(),n[1].fromPointNormal(t,a),a.copy(r).multiplyByScalar(this.bottom).add(i).subtract(t).cross(s).negate(),n[2].fromPointNormal(t,a),a.copy(r).multiplyByScalar(this.top).add(i).subtract(t).cross(s),n[3].fromPointNormal(t,a),a=(new xe).copy(e),n[4].fromPointNormal(i,a),a.negate(),n[5].fromPointNormal(o,a),this._cullingVolume}getPixelDimensions(t,e,r,n){$r(this),Xt(Number.isFinite(t)&&Number.isFinite(e)),Xt(t>0),Xt(e>0),Xt(r>0),Xt(n);const s=1/this.near;let i=this.top*s;const o=2*r*i/e;i=this.right*s;const a=2*r*i/t;return n.x=a,n.y=o,n}}function $r(t){Xt(Number.isFinite(t.right)&&Number.isFinite(t.left)&&Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.near)&&Number.isFinite(t.far));const{top:e,bottom:r,right:n,left:s,near:i,far:o}=t;e===t._top&&r===t._bottom&&s===t._left&&n===t._right&&i===t._near&&o===t._far||(Xt(t.near>0&&t.near<t.far,"near must be greater than zero and less than far."),t._left=s,t._right=n,t._top=e,t._bottom=r,t._near=i,t._far=o,t._perspectiveMatrix=(new qe).frustum({left:s,right:n,bottom:r,top:e,near:i,far:o}),t._infinitePerspective=(new qe).frustum({left:s,right:n,bottom:r,top:e,near:i,far:1/0}))}class tn{constructor(t={}){t={near:1,far:5e8,xOffset:0,yOffset:0,...t},this._offCenterFrustum=new Zr,this.fov=t.fov,this._fov=void 0,this._fovy=void 0,this._sseDenominator=void 0,this.aspectRatio=t.aspectRatio,this._aspectRatio=void 0,this.near=t.near,this._near=this.near,this.far=t.far,this._far=this.far,this.xOffset=t.xOffset,this._xOffset=this.xOffset,this.yOffset=t.yOffset,this._yOffset=this.yOffset}clone(){return new tn({aspectRatio:this.aspectRatio,fov:this.fov,near:this.near,far:this.far})}equals(t){return null!=t&&t instanceof tn&&(en(this),en(t),this.fov===t.fov&&this.aspectRatio===t.aspectRatio&&this.near===t.near&&this.far===t.far&&this._offCenterFrustum.equals(t._offCenterFrustum))}get projectionMatrix(){return en(this),this._offCenterFrustum.projectionMatrix}get infiniteProjectionMatrix(){return en(this),this._offCenterFrustum.infiniteProjectionMatrix}get fovy(){return en(this),this._fovy}get sseDenominator(){return en(this),this._sseDenominator}computeCullingVolume(t,e,r){return en(this),this._offCenterFrustum.computeCullingVolume(t,e,r)}getPixelDimensions(t,e,r,n){return en(this),this._offCenterFrustum.getPixelDimensions(t,e,r,n)}}function en(t){Xt(Number.isFinite(t.fov)&&Number.isFinite(t.aspectRatio)&&Number.isFinite(t.near)&&Number.isFinite(t.far));const e=t._offCenterFrustum;t.fov===t._fov&&t.aspectRatio===t._aspectRatio&&t.near===t._near&&t.far===t._far&&t.xOffset===t._xOffset&&t.yOffset===t._yOffset||(Xt(t.fov>=0&&t.fov<Math.PI),Xt(t.aspectRatio>0),Xt(t.near>=0&&t.near<t.far),t._aspectRatio=t.aspectRatio,t._fov=t.fov,t._fovy=t.aspectRatio<=1?t.fov:2*Math.atan(Math.tan(.5*t.fov)/t.aspectRatio),t._near=t.near,t._far=t.far,t._sseDenominator=2*Math.tan(.5*t._fovy),t._xOffset=t.xOffset,t._yOffset=t.yOffset,e.top=t.near*Math.tan(.5*t._fovy),e.bottom=-e.top,e.right=t.aspectRatio*e.top,e.left=-e.right,e.near=t.near,e.far=t.far,e.right+=t.xOffset,e.left+=t.xOffset,e.top+=t.yOffset,e.bottom+=t.yOffset)}new xe,new xe,new xe,new xe,new xe,new xe,new xe,new xe,new xe,new xe,new xe,new xe,new Je,new Je,new Je,new Je,new Je,new xe,new xe,new xe,new xe,new xe,new Je,new Je,new Je;const rn=new xe,nn=new xe,sn=new Qr([new jr,new jr,new jr,new jr,new jr,new jr]);function on(t,e){const{cameraDirection:r,cameraUp:n,height:s}=t,{metersPerUnit:i}=t.distanceScales,o=t.unprojectPosition(t.center),a=Er.WGS84.cartographicToCartesian(o,new xe),c=Er.WGS84.eastNorthUpToFixedFrame(a),l=t.unprojectPosition(t.cameraPosition),h=Er.WGS84.cartographicToCartesian(l,new xe),u=new xe(c.transformAsVector(new xe(r).scale(i))).normalize(),d=new xe(c.transformAsVector(new xe(n).scale(i))).normalize();return function(t,e){const r=t.getFrustumPlanes();let n=0;for(const s in r){const i=r[s],o=i.normal.dot(t.center);nn.copy(i.normal).scale(i.distance-o).add(t.center);const a=t.unprojectPosition(nn),c=Er.WGS84.cartographicToCartesian(a,new xe);sn.planes[n++].fromPointNormal(c,rn.copy(e).subtract(c))}}(t,a),{camera:{position:h,direction:u,up:d},viewport:t,height:s,cullingVolume:sn,frameNumber:e,sseDenominator:1.15}}const an=6356752.314245179,cn=new xe;const ln="scenegraph",hn="pointcloud",un="I3S",dn="TILES3D",fn="geometricError";function mn(t){return null!=t}const An=new xe,pn=new xe,Bn=new xe;function gn(t,e,n){if(r(t,"3D Tile: boundingVolume must be defined"),t.box)return function(t,e,r){const n=new xe(t[0],t[1],t[2]);e.transform(n,n);let s=[];if(10===t.length){const e=t.slice(3,6),r=new rr;r.fromArray(t,6);const n=new xe([1,0,0]),i=new xe([0,1,0]),o=new xe([0,0,1]);n.transformByQuaternion(r),n.scale(e[0]),i.transformByQuaternion(r),i.scale(e[1]),o.transformByQuaternion(r),o.scale(e[2]),s=[...n.toArray(),...i.toArray(),...o.toArray()]}else s=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];const i=e.transformAsVector(s.slice(0,3)),o=e.transformAsVector(s.slice(3,6)),a=e.transformAsVector(s.slice(6,9)),c=new Je([i[0],i[1],i[2],o[0],o[1],o[2],a[0],a[1],a[2]]);return mn(r)?(r.center=n,r.halfAxes=c,r):new Hr(n,c)}(t.box,e,n);if(t.region){const[e,r,n,s,i,o]=t.region,a=Er.WGS84.cartographicToCartesian([oe(e),oe(s),i],pn),c=Er.WGS84.cartographicToCartesian([oe(n),oe(r),o],Bn),l=(new xe).addVectors(a,c).multiplyScalar(.5),h=(new xe).subVectors(a,c).len()/2;return yn([l[0],l[1],l[2],h],new qe)}if(t.sphere)return yn(t.sphere,e,n);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function yn(t,e,r){const n=new xe(t[0],t[1],t[2]);e.transform(n,n);const s=e.getScale(An),i=Math.max(Math.max(s[0],s[1]),s[2]),o=t[3]*i;return mn(r)?(r.center=n,r.radius=o,r):new Gr(n,o)}function Cn(t,e){const r=e.viewport,n=r.constructor,{longitude:s,latitude:i,height:o,width:a,bearing:c,zoom:l}=r,h=new n({longitude:s,latitude:i,height:o,width:a,bearing:c,zoom:l,pitch:0}),u=t.header.mbs[1],d=t.header.mbs[0],f=t.header.mbs[2],m=t.header.mbs[3],A=[...t.boundingVolume.center],p=h.unprojectPosition(h.cameraPosition),B=Er.WGS84.cartographicToCartesian(p,new xe),g=new xe(B).subtract(A).normalize(),y=new qe;Er.WGS84.eastNorthUpToFixedFrame(A,y);const C=new qe(y).invert(),b=new xe(B).transform(C),w=Math.sqrt(b[0]*b[0]+b[1]*b[1]),E=w*w/b[2],T=new xe([b[0],b[1],E]).transform(y),v=new xe(T).subtract(A).normalize(),I=g.cross(v).normalize().scale(m),_=new xe(A).add(I),M=Er.WGS84.cartesianToCartographic(_),F=h.project([d,u,f]),D=h.project(M);return new xe(F).subtract(D).magnitude()}new xe,new xe,new qe,new xe,new xe,new xe;class bn{constructor(t=0){m(this,"_map",new Map),m(this,"_array",void 0),m(this,"_length",void 0),this._array=new Array(t),this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return r(t<this._array.length),this._array[t]}set(t,e){r(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=e,this._map.set(e,t)}delete(t){const e=this._map.get(t);e>=0&&(this._array.splice(e,1),this._map.delete(t),this.length--)}peek(){return this._array[this._length-1]}push(t){if(!this._map.has(t)){const e=this.length++;this._array[e]=t,this._map.set(t,e)}}pop(){const t=this._array[--this.length];return this._map.delete(t),t}reserve(t){r(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){r(t>=0),this.length=t}trim(t){null==t&&(t=this.length),this._array.length=t}reset(){this._array=[],this._map=new Map,this._length=0}find(t){return this._map.has(t)}}const wn={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class En{constructor(t){m(this,"options",void 0),m(this,"root",void 0),m(this,"requestedTiles",void 0),m(this,"selectedTiles",void 0),m(this,"emptyTiles",void 0),m(this,"_traversalStack",void 0),m(this,"_emptyTraversalStack",void 0),m(this,"_frameNumber",void 0),this.options={...wn,...t},this._traversalStack=new bn,this._emptyTraversalStack=new bn,this._frameNumber=null,this.root=null,this.selectedTiles={},this.requestedTiles={},this.emptyTiles={}}traverse(t,e,r){this.root=t,this.options={...this.options,...r},this.reset(),this.updateTile(t,e),this._frameNumber=e.frameNumber,this.executeTraversal(t,e)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(t,e){const r=this._traversalStack;for(t._selectionDepth=1,r.push(t);r.length>0;){const t=r.pop();let n=!1;this.canTraverse(t,e)&&(this.updateChildTiles(t,e),n=this.updateAndPushChildren(t,e,r,t.hasRenderContent?t._selectionDepth+1:t._selectionDepth));const s=t.parent,i=Boolean(!s||s._shouldRefine),o=!n;t.hasRenderContent?1===t.refine?(this.loadTile(t,e),this.selectTile(t,e)):2===t.refine&&(this.loadTile(t,e),o&&this.selectTile(t,e)):(this.emptyTiles[t.id]=t,this.loadTile(t,e),o&&this.selectTile(t,e)),this.touchTile(t,e),t._shouldRefine=n&&i}this.options.onTraversalEnd(e)}updateChildTiles(t,e){const r=t.children;for(const t of r)this.updateTile(t,e);return!0}updateAndPushChildren(t,e,r,n){const{loadSiblings:s,skipLevelOfDetail:i}=this.options,o=t.children;o.sort(this.compareDistanceToCamera.bind(this));const a=2===t.refine&&t.hasRenderContent&&!i;let c=!1,l=!0;for(const t of o)if(t._selectionDepth=n,t.isVisibleAndInRequestVolume?(r.find(t)&&r.delete(t),r.push(t),c=!0):(a||s)&&(this.loadTile(t,e),this.touchTile(t,e)),a){let r;if(r=!!t._inRequestVolume&&(t.hasRenderContent?t.contentAvailable:this.executeEmptyTraversal(t,e)),l=l&&r,!l)return!1}return c||(l=!1),l}updateTile(t,e){this.updateTileVisibility(t,e)}selectTile(t,e){this.shouldSelectTile(t)&&(t._selectedFrame=e.frameNumber,this.selectedTiles[t.id]=t)}loadTile(t,e){this.shouldLoadTile(t)&&(t._requestedFrame=e.frameNumber,t._priority=t._getPriority(),this.requestedTiles[t.id]=t)}touchTile(t,e){t.tileset._cache.touch(t),t._touchedFrame=e.frameNumber}canTraverse(t,e,r=!1,n=!1){return!!t.hasChildren&&(t.hasTilesetContent?!t.contentExpired:!(!n&&!t.isVisibleAndInRequestVolume)&&this.shouldRefine(t,e,r))}shouldLoadTile(t){return t.hasUnloadedContent||t.contentExpired}shouldSelectTile(t){return t.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(t,e,r){let n=t._screenSpaceError;return r&&(n=t.getScreenSpaceError(e,!0)),n>this.options.maximumScreenSpaceError}updateTileVisibility(t,e){const r=[];if(this.options.viewportTraversersMap)for(const t in this.options.viewportTraversersMap)this.options.viewportTraversersMap[t]===e.viewport.id&&r.push(t);else r.push(e.viewport.id);t.updateVisibility(e,r)}compareDistanceToCamera(t,e){return t._distanceToCamera-e._distanceToCamera}anyChildrenVisible(t,e){let r=!1;for(const n of t.children)n.updateVisibility(e),r=r||n.isVisibleAndInRequestVolume;return r}executeEmptyTraversal(t,e){let r=!0;const n=this._emptyTraversalStack;for(n.push(t);n.length>0&&r;){const t=n.pop();if(this.updateTile(t,e),t.isVisibleAndInRequestVolume||this.loadTile(t,e),this.touchTile(t,e),!t.hasRenderContent&&this.canTraverse(t,e,!1,!0)){const e=t.children;for(const t of e)n.find(t)&&n.delete(t),n.push(t)}else t.contentAvailable||(r=!1)}return r}}const Tn=new xe;class vn{constructor(t,e,r,n=""){m(this,"tileset",void 0),m(this,"header",void 0),m(this,"id",void 0),m(this,"url",void 0),m(this,"parent",void 0),m(this,"refine",void 0),m(this,"type",void 0),m(this,"contentUrl",void 0),m(this,"lodMetricType",void 0),m(this,"lodMetricValue",void 0),m(this,"boundingVolume",void 0),m(this,"content",void 0),m(this,"contentState",void 0),m(this,"gpuMemoryUsageInBytes",void 0),m(this,"children",void 0),m(this,"depth",void 0),m(this,"viewportIds",void 0),m(this,"transform",void 0),m(this,"extensions",void 0),m(this,"userData",void 0),m(this,"computedTransform",void 0),m(this,"hasEmptyContent",void 0),m(this,"hasTilesetContent",void 0),m(this,"traverser",void 0),m(this,"_cacheNode",void 0),m(this,"_frameNumber",void 0),m(this,"_lodJudge",void 0),m(this,"_expireDate",void 0),m(this,"_expiredContent",void 0),m(this,"_shouldRefine",void 0),m(this,"_distanceToCamera",void 0),m(this,"_centerZDepth",void 0),m(this,"_screenSpaceError",void 0),m(this,"_visibilityPlaneMask",void 0),m(this,"_visible",void 0),m(this,"_inRequestVolume",void 0),m(this,"_stackLength",void 0),m(this,"_selectionDepth",void 0),m(this,"_touchedFrame",void 0),m(this,"_visitedFrame",void 0),m(this,"_selectedFrame",void 0),m(this,"_requestedFrame",void 0),m(this,"_priority",void 0),m(this,"_contentBoundingVolume",void 0),m(this,"_viewerRequestVolume",void 0),m(this,"_initialTransform",void 0),this.header=e,this.tileset=t,this.id=n||e.id,this.url=e.url,this.parent=r,this.refine=this._getRefine(e.refine),this.type=e.type,this.contentUrl=e.contentUrl,this.lodMetricType="geometricError",this.lodMetricValue=0,this.boundingVolume=null,this.content=null,this.contentState=0,this.gpuMemoryUsageInBytes=0,this.children=[],this.hasEmptyContent=!1,this.hasTilesetContent=!1,this.depth=0,this.viewportIds=[],this.userData={},this.extensions=null,this._priority=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._screenSpaceError=0,this._cacheNode=null,this._frameNumber=null,this._cacheNode=null,this.traverser=new En({}),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._initialTransform=new qe,this.transform=new qe,this._initializeLodMetric(e),this._initializeTransforms(e),this._initializeBoundingVolumes(e),this._initializeContent(e),this._initializeRenderingState(e),this._lodJudge=null,this._expireDate=null,this._expiredContent=null,Object.seal(this)}destroy(){this.header=null}isDestroyed(){return null===this.header}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return 3===this.contentState||this.hasEmptyContent}get contentAvailable(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return 0===this.contentState}get contentExpired(){return 4===this.contentState}get contentFailed(){return 5===this.contentState}getScreenSpaceError(t,e){switch(this.tileset.type){case un:return Cn(this,t);case dn:return function(t,e,r){const n=t.tileset,s=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,i=r?s:t.lodMetricValue;if(0===i)return 0;const o=Math.max(t._distanceToCamera,1e-7),{height:a,sseDenominator:c}=e,{viewDistanceScale:l}=n.options;let h=i*a*(l||1)/(o*c);return h-=function(t,e){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){const r=t.dynamicScreenSpaceErrorComputedDensity,n=t.dynamicScreenSpaceErrorFactor,s=function(t,e){const r=t*e;return 1-Math.exp(-r*r)}(e,r)*n;return s}return 0}(n,o),h}(this,t,e);default:throw new Error("Unsupported tileset type")}}_getPriority(){const t=this.tileset._traverser,{skipLevelOfDetail:e}=t.options,r=1===this.refine||e;if(r&&!this.isVisible&&void 0!==this._visible)return-1;if(this.tileset._frameNumber-this._touchedFrame>=1)return-1;if(0===this.contentState)return-1;const n=this.parent,s=!n||r&&0!==this._screenSpaceError&&!n.hasTilesetContent?this._screenSpaceError:n._screenSpaceError,i=t.root?t.root._screenSpaceError:0;return Math.max(i-s,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=1;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=0,!1;try{const e=this.tileset.getTileUrl(this.contentUrl),r=this.tileset.loader,n={...this.tileset.loadOptions,[r.id]:{...this.tileset.loadOptions[r.id],isTileset:"json"===this.type,...this._getLoaderSpecificOptions(r.id)}};return this.content=await Yt(e,r,n),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=3,this._onContentLoaded(),!0}catch(t){throw this.contentState=5,t}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=0,!0}updateVisibility(t,e){if(this._frameNumber===t.frameNumber)return;const r=this.parent,n=r?r._visibilityPlaneMask:Qr.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const t=r?r.computedTransform:this.tileset.modelMatrix;this._updateTransform(t)}this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,n),this._visible=this._visibilityPlaneMask!==Qr.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=e}visibility(t,e){const{cullingVolume:r}=t,{boundingVolume:n}=this;return r.computeVisibilityWithPlaneMask(n,e)}contentVisibility(){return!0}distanceToTile(t){const e=this.boundingVolume;return Math.sqrt(Math.max(e.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth({camera:t}){const e=this.boundingVolume;return Tn.subVectors(e.center,t.position),t.direction.dot(Tn)}insideViewerRequestVolume(t){const e=this._viewerRequestVolume;return!e||e.distanceSquaredTo(t.camera.position)<=0}updateExpiration(){if(null!=this._expireDate&&this.contentReady&&!this.hasEmptyContent){const t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=4,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(t){this.transform=t.transform?new qe(t.transform):new qe;const e=this.parent,r=this.tileset,n=e&&e.computedTransform?e.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new qe(n).multiplyRight(this.transform);const s=e&&e._initialTransform?e._initialTransform.clone():new qe;this._initialTransform=new qe(s).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}_initializeContent(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=0,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(t){this.depth=t.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Qr.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(t){return t||this.parent&&this.parent.refine||2}_isTileset(){return-1!==this.contentUrl.indexOf(".json")}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0}this._isTileset()&&(this.hasTilesetContent=!0)}_updateBoundingVolume(t){this.boundingVolume=gn(t.boundingVolume,this.computedTransform,this.boundingVolume);const e=t.content;e&&(e.boundingVolume&&(this._contentBoundingVolume=gn(e.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=gn(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(t=new qe){const e=t.clone().multiplyRight(this.transform);!e.equals(this.computedTransform)&&(this.computedTransform=e,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(t){return"i3s"===t?{...this.tileset.options.i3s,tile:this.header,tileset:this.tileset.tileset,isTileHeader:!1}:{assetGltfUpAxis:(e=this.tileset.tileset).asset&&e.asset.gltfUpAxis||"Y"};var e}}class In extends En{compareDistanceToCamera(t,e){return 0===e._distanceToCamera&&0===t._distanceToCamera?e._centerZDepth-t._centerZDepth:e._distanceToCamera-t._distanceToCamera}updateTileVisibility(t,e){if(super.updateTileVisibility(t,e),!t.isVisibleAndInRequestVolume)return;const r=t.children.length>0;if(t.hasTilesetContent&&r){const r=t.children[0];return this.updateTileVisibility(r,e),void(t._visible=r._visible)}if(this.meetsScreenSpaceErrorEarly(t,e))return void(t._visible=!1);const n=2===t.refine,s=1===t._optimChildrenWithinParent;n&&s&&r&&!this.anyChildrenVisible(t,e)&&(t._visible=!1)}meetsScreenSpaceErrorEarly(t,e){const{parent:r}=t;return!(!r||r.hasTilesetContent||1!==r.refine||this.shouldRefine(t,e,!0))}}class _n{constructor(){m(this,"_statusMap",void 0),this._statusMap={}}add(t,e,r,n){this._statusMap[e]||(this._statusMap[e]={request:t,callback:r,key:e,frameState:n,status:"REQUESTED"},t().then((t=>{this._statusMap[e].status="COMPLETED",this._statusMap[e].callback(t,n)})).catch((t=>{this._statusMap[e].status="ERROR",r(t)})))}update(t,e){this._statusMap[t]&&(this._statusMap[t].frameState=e)}find(t){return this._statusMap[t]}}class Mn extends En{constructor(t){super(t),m(this,"_tileManager",void 0),this._tileManager=new _n}shouldRefine(t,e){return t._lodJudge=function(t,e){if(0===t.lodMetricValue||isNaN(t.lodMetricValue))return"DIG";const r=2*Cn(t,e);return r<2?"OUT":!t.header.children||r<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}(t,e),"DIG"===t._lodJudge}updateChildTiles(t,e){const r=t.header.children||[],n=t.children,s=t.tileset;for(const i of r){const r="".concat(i.id,"-").concat(e.viewport.id),o=n&&n.find((t=>t.id===r));if(o)o&&this.updateTile(o,e);else{let n=()=>this._loadTile(i.id,s);this._tileManager.find(r)?this._tileManager.update(r,e):(s.tileset.nodePages&&(n=()=>s.tileset.nodePagesTile.formTileFromNodePages(i.id)),this._tileManager.add(n,r,(e=>this._onTileLoad(e,t,r)),e))}}return!1}async _loadTile(t,e){const{loader:r}=e,n=e.getTileUrl("".concat(e.url,"/nodes/").concat(t)),s={...e.loadOptions,i3s:{...e.loadOptions.i3s,isTileHeader:!0,loadContent:!1}};return await Yt(n,r,s)}_onTileLoad(t,e,r){const n=new vn(e.tileset,t,e,r);e.children.push(n);const s=this._tileManager.find(n.id).frameState;this.updateTile(n,s),this._frameNumber===s.frameNumber&&this.executeTraversal(n,s)}}const Fn={description:"",ellipsoid:Er.WGS84,modelMatrix:new qe,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:t=>t,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},Dn="Tiles In Tileset(s)",Gn="Tiles In Memory",xn="Tiles In View",Sn="Tiles To Render",Rn="Tiles Loaded",On="Tiles Loading",Un="Tiles Unloaded",Ln="Failed Tile Loads",Nn="Points",Hn="Tile Memory Use";class Jn{constructor(t,e){m(this,"options",void 0),m(this,"loadOptions",void 0),m(this,"type",void 0),m(this,"tileset",void 0),m(this,"loader",void 0),m(this,"url",void 0),m(this,"basePath",void 0),m(this,"modelMatrix",void 0),m(this,"ellipsoid",void 0),m(this,"lodMetricType",void 0),m(this,"lodMetricValue",void 0),m(this,"refine",void 0),m(this,"root",void 0),m(this,"roots",void 0),m(this,"asset",void 0),m(this,"description",void 0),m(this,"properties",void 0),m(this,"extras",void 0),m(this,"attributions",void 0),m(this,"credits",void 0),m(this,"stats",void 0),m(this,"traverseCounter",void 0),m(this,"geometricError",void 0),m(this,"selectedTiles",void 0),m(this,"cartographicCenter",void 0),m(this,"cartesianCenter",void 0),m(this,"zoom",void 0),m(this,"boundingVolume",void 0),m(this,"gpuMemoryUsageInBytes",void 0),m(this,"dynamicScreenSpaceErrorComputedDensity",void 0),m(this,"_traverser",void 0),m(this,"_cache",void 0),m(this,"_requestScheduler",void 0),m(this,"_frameNumber",void 0),m(this,"_queryParamsString",void 0),m(this,"_queryParams",void 0),m(this,"_extensionsUsed",void 0),m(this,"_tiles",void 0),m(this,"_pendingCount",void 0),m(this,"lastUpdatedVieports",void 0),m(this,"_requestedTiles",void 0),m(this,"_emptyTiles",void 0),m(this,"frameStateData",void 0),m(this,"maximumMemoryUsage",void 0),r(t),this.options={...Fn,...e},this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||k(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.loadOptions=this.options.loadOptions||{},this.root=null,this.roots={},this.cartographicCenter=null,this.cartesianCenter=null,this.zoom=1,this.boundingVolume=null,this.traverseCounter=0,this.geometricError=0,this._traverser=this._initializeTraverser(),this._cache=new _r,this._requestScheduler=new P({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this._frameNumber=0,this._pendingCount=0,this._tiles={},this.selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this.frameStateData={},this.lastUpdatedVieports=null,this._queryParams={},this._queryParamsString="",this.maximumMemoryUsage=this.options.maximumMemoryUsage||32,this.gpuMemoryUsageInBytes=0,this.stats=new H({id:this.url}),this._initializeStats(),this._extensionsUsed=void 0,this.dynamicScreenSpaceErrorComputedDensity=0,this.extras=null,this.asset={},this.credits={},this.description=this.options.description||"",this._initializeTileSet(t)}destroy(){this._destroy()}isLoaded(){return 0===this._pendingCount&&0!==this._frameNumber}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return this._queryParamsString||(this._queryParamsString=function(t){const e=[];for(const r of Object.keys(t))e.push("".concat(r,"=").concat(t[r]));switch(e.length){case 0:return"";case 1:return"?".concat(e[0]);default:return"?".concat(e.join("&"))}}(this._queryParams)),this._queryParamsString}setProps(t){this.options={...this.options,...t}}setOptions(t){this.options={...this.options,...t}}getTileUrl(t){return t.startsWith("data:")?t:"".concat(t).concat(this.queryParams)}hasExtension(t){return Boolean(this._extensionsUsed&&this._extensionsUsed.indexOf(t)>-1)}update(t){if("loadTiles"in this.options&&!this.options.loadTiles)return;if(this.traverseCounter>0)return;!t&&this.lastUpdatedVieports?t=this.lastUpdatedVieports:this.lastUpdatedVieports=t,t instanceof Array||(t=[t]),this._cache.reset(),this._frameNumber++,this.traverseCounter=t.length;const e=[];for(const r of t){const t=r.id;this._needTraverse(t)?e.push(t):this.traverseCounter--}for(const r of t){const t=r.id;if(this.roots[t]||(this.roots[t]=this._initializeTileHeaders(this.tileset,null)),!e.includes(t))continue;const n=on(r,this._frameNumber);this._traverser.traverse(this.roots[t],n,this.options)}}_needTraverse(t){let e=t;return this.options.viewportTraversersMap&&(e=this.options.viewportTraversersMap[t]),e===t}_onTraversalEnd(t){const e=t.viewport.id;this.frameStateData[e]||(this.frameStateData[e]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const r=this.frameStateData[e],n=Object.values(this._traverser.selectedTiles);r.selectedTiles=n,r._requestedTiles=Object.values(this._traverser.requestedTiles),r._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,this.traverseCounter>0||this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const t in this.frameStateData){const e=this.frameStateData[t];this.selectedTiles=this.selectedTiles.concat(e.selectedTiles),this._requestedTiles=this._requestedTiles.concat(e._requestedTiles),this._emptyTiles=this._emptyTiles.concat(e._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const t of this.selectedTiles)this._tiles[t.id]=t;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(t,e){if(t.length!==e.length)return!0;const r=new Set(t.map((t=>t.id))),n=new Set(e.map((t=>t.id)));let s=t.filter((t=>!n.has(t.id))).length>0;return s=s||e.filter((t=>!r.has(t.id))).length>0,s}_loadTiles(){for(const t of this._requestedTiles)t.contentUnloaded&&this._loadTile(t)}_unloadTiles(){this._cache.unloadTiles(this,((t,e)=>t._unloadTile(e)))}_updateStats(){let t=0,e=0;for(const r of this.selectedTiles)r.contentAvailable&&r.content&&(t++,r.content.pointCount&&(e+=r.content.pointCount));this.stats.get(xn).count=this.selectedTiles.length,this.stats.get(Sn).count=t,this.stats.get(Nn).count=e}_initializeTileSet(t){this.root=this._initializeTileHeaders(t,null),this.type===dn&&this._initializeCesiumTileset(t),this.type===un&&this._initializeI3STileset(),this._calculateViewProps()}_calculateViewProps(){const t=this.root;r(t);const{center:e}=t.boundingVolume;if(!e)return console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new xe,void(this.zoom=1);this.cartographicCenter=Er.WGS84.cartesianToCartographic(e,new xe),this.cartesianCenter=e,this.zoom=function(t){const{halfAxes:e,radius:r,width:n,height:s}=t;if(e){const t=function(t){t.getColumn(0,cn);const e=t.getColumn(1),r=t.getColumn(2);return cn.add(e).add(r).len()}(e);return Math.log2(an/t)}return r?Math.log2(an/r):s&&n?(Math.log2(6378137/n)+Math.log2(6378137/s))/2:1}(t.boundingVolume)}_initializeStats(){this.stats.get(Dn),this.stats.get(On),this.stats.get(Gn),this.stats.get(xn),this.stats.get(Sn),this.stats.get(Rn),this.stats.get(Un),this.stats.get(Ln),this.stats.get(Nn,"memory"),this.stats.get(Hn,"memory")}_initializeTileHeaders(t,e){const r=new vn(this,t.root,e);if(e&&(e.children.push(r),r.depth=e.depth+1),this.type===dn){const t=[];for(t.push(r);t.length>0;){const e=t.pop();this.stats.get(Dn).incrementCount();const r=e.header.children||[];for(const n of r){const r=new vn(this,n,e);e.children.push(r),r.depth=e.depth+1,t.push(r)}}}return r}_initializeTraverser(){let t;switch(this.type){case dn:t=In;break;case un:t=Mn;break;default:t=En}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t){let e;try{this._onStartTileLoading(),e=await t.loadContent()}catch(e){this._onTileLoadError(t,e)}finally{this._onEndTileLoading(),this._onTileLoad(t,e)}}_onTileLoadError(t,e){this.stats.get(Ln).incrementCount();const r=e.message||e.toString(),n=t.url;console.error("A 3D tile failed to load: ".concat(t.url," ").concat(r)),this.options.onTileError(t,r,n)}_onTileLoad(t,e){e&&(t&&t.content&&function(t,e){r(t),r(e);const{rtcCenter:n,gltfUpAxis:s}=e,{computedTransform:i,boundingVolume:{center:o}}=t;let a=new qe(i);switch(n&&a.translate(n),s){case"Z":break;case"Y":const t=(new qe).rotateX(Math.PI/2);a=a.multiplyRight(t);break;case"X":const e=(new qe).rotateY(-Math.PI/2);a=a.multiplyRight(e)}e.isQuantized&&a.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const c=new xe(o);e.cartesianModelMatrix=a,e.cartesianOrigin=c;const l=Er.WGS84.cartesianToCartographic(c,new xe),h=Er.WGS84.eastNorthUpToFixedFrame(c).invert();e.cartographicModelMatrix=h.multiplyRight(a),e.cartographicOrigin=l,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}(t,t.content),this._addTileToCache(t),this.options.onTileLoad(t))}_onStartTileLoading(){this._pendingCount++,this.stats.get(On).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(On).decrementCount()}_addTileToCache(t){this._cache.add(this,t,(e=>e._updateCacheStats(t)))}_updateCacheStats(t){this.stats.get(Rn).incrementCount(),this.stats.get(Gn).incrementCount(),this.gpuMemoryUsageInBytes+=t.content.byteLength||0,this.stats.get(Hn).count=this.gpuMemoryUsageInBytes}_unloadTile(t){this.gpuMemoryUsageInBytes-=t.content&&t.content.byteLength||0,this.stats.get(Gn).decrementCount(),this.stats.get(Un).incrementCount(),this.stats.get(Hn).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_destroy(){const t=[];for(this.root&&t.push(this.root);t.length>0;){const e=t.pop();for(const r of e.children)t.push(r);this._destroyTile(e)}this.root=null}_destroySubtree(t){const e=t,r=[];for(r.push(e);r.length>0;){t=r.pop();for(const e of t.children)r.push(e);t!==e&&this._destroyTile(t)}e.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}_initializeCesiumTileset(t){if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed,this.extras=t.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const Pn="3.1.4";function jn(t,e,n){r(t instanceof ArrayBuffer);const s=new TextDecoder("utf8"),i=new Uint8Array(t,e,n);return s.decode(i)}const kn={name:"Draco",id:"draco",module:"draco",shapes:["mesh"],version:"3.1.4",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:"object"==typeof WebAssembly?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};class Vn{constructor(t,e){m(this,"fields",void 0),m(this,"metadata",void 0),function(t,e){if(!t)throw new Error("loader assertion failed.")}(Array.isArray(t)),function(t){const e={};for(const r of t)e[r.name]&&console.warn("Schema: duplicated field name",r.name,r),e[r.name]=!0}(t),this.fields=t,this.metadata=e||new Map}compareTo(t){if(this.metadata!==t.metadata)return!1;if(this.fields.length!==t.fields.length)return!1;for(let e=0;e<this.fields.length;++e)if(!this.fields[e].compareTo(t.fields[e]))return!1;return!0}select(...t){const e=Object.create(null);for(const r of t)e[r]=!0;const r=this.fields.filter((t=>e[t.name]));return new Vn(r,this.metadata)}selectAt(...t){const e=t.map((t=>this.fields[t])).filter(Boolean);return new Vn(e,this.metadata)}assign(t){let e,r=this.metadata;if(t instanceof Vn){const n=t;e=n.fields,r=Kn(Kn(new Map,this.metadata),n.metadata)}else e=t;const n=Object.create(null);for(const t of this.fields)n[t.name]=t;for(const t of e)n[t.name]=t;const s=Object.values(n);return new Vn(s,r)}}function Kn(t,e){return new Map([...t||new Map,...e||new Map])}class Qn{constructor(t,e,r=!1,n=new Map){m(this,"name",void 0),m(this,"type",void 0),m(this,"nullable",void 0),m(this,"metadata",void 0),this.name=t,this.type=e,this.nullable=r,this.metadata=n}get typeId(){return this.type&&this.type.typeId}clone(){return new Qn(this.name,this.type,this.nullable,this.metadata)}compareTo(t){return this.name===t.name&&this.type===t.type&&this.nullable===t.nullable&&this.metadata===t.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let qn,zn,Wn,Yn;!function(t){t[t.NONE=0]="NONE",t[t.Null=1]="Null",t[t.Int=2]="Int",t[t.Float=3]="Float",t[t.Binary=4]="Binary",t[t.Utf8=5]="Utf8",t[t.Bool=6]="Bool",t[t.Decimal=7]="Decimal",t[t.Date=8]="Date",t[t.Time=9]="Time",t[t.Timestamp=10]="Timestamp",t[t.Interval=11]="Interval",t[t.List=12]="List",t[t.Struct=13]="Struct",t[t.Union=14]="Union",t[t.FixedSizeBinary=15]="FixedSizeBinary",t[t.FixedSizeList=16]="FixedSizeList",t[t.Map=17]="Map",t[t.Dictionary=-1]="Dictionary",t[t.Int8=-2]="Int8",t[t.Int16=-3]="Int16",t[t.Int32=-4]="Int32",t[t.Int64=-5]="Int64",t[t.Uint8=-6]="Uint8",t[t.Uint16=-7]="Uint16",t[t.Uint32=-8]="Uint32",t[t.Uint64=-9]="Uint64",t[t.Float16=-10]="Float16",t[t.Float32=-11]="Float32",t[t.Float64=-12]="Float64",t[t.DateDay=-13]="DateDay",t[t.DateMillisecond=-14]="DateMillisecond",t[t.TimestampSecond=-15]="TimestampSecond",t[t.TimestampMillisecond=-16]="TimestampMillisecond",t[t.TimestampMicrosecond=-17]="TimestampMicrosecond",t[t.TimestampNanosecond=-18]="TimestampNanosecond",t[t.TimeSecond=-19]="TimeSecond",t[t.TimeMillisecond=-20]="TimeMillisecond",t[t.TimeMicrosecond=-21]="TimeMicrosecond",t[t.TimeNanosecond=-22]="TimeNanosecond",t[t.DenseUnion=-23]="DenseUnion",t[t.SparseUnion=-24]="SparseUnion",t[t.IntervalDayTime=-25]="IntervalDayTime",t[t.IntervalYearMonth=-26]="IntervalYearMonth"}(qn||(qn={}));class Xn{static isNull(t){return t&&t.typeId===qn.Null}static isInt(t){return t&&t.typeId===qn.Int}static isFloat(t){return t&&t.typeId===qn.Float}static isBinary(t){return t&&t.typeId===qn.Binary}static isUtf8(t){return t&&t.typeId===qn.Utf8}static isBool(t){return t&&t.typeId===qn.Bool}static isDecimal(t){return t&&t.typeId===qn.Decimal}static isDate(t){return t&&t.typeId===qn.Date}static isTime(t){return t&&t.typeId===qn.Time}static isTimestamp(t){return t&&t.typeId===qn.Timestamp}static isInterval(t){return t&&t.typeId===qn.Interval}static isList(t){return t&&t.typeId===qn.List}static isStruct(t){return t&&t.typeId===qn.Struct}static isUnion(t){return t&&t.typeId===qn.Union}static isFixedSizeBinary(t){return t&&t.typeId===qn.FixedSizeBinary}static isFixedSizeList(t){return t&&t.typeId===qn.FixedSizeList}static isMap(t){return t&&t.typeId===qn.Map}static isDictionary(t){return t&&t.typeId===qn.Dictionary}get typeId(){return qn.NONE}compareTo(t){return this===t}}zn=Symbol.toStringTag;class Zn extends Xn{constructor(t,e){super(),m(this,"isSigned",void 0),m(this,"bitWidth",void 0),this.isSigned=t,this.bitWidth=e}get typeId(){return qn.Int}get[zn](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class $n extends Zn{constructor(){super(!0,8)}}class ts extends Zn{constructor(){super(!0,16)}}class es extends Zn{constructor(){super(!0,32)}}class rs extends Zn{constructor(){super(!1,8)}}class ns extends Zn{constructor(){super(!1,16)}}class ss extends Zn{constructor(){super(!1,32)}}Wn=Symbol.toStringTag;class is extends Xn{constructor(t){super(),m(this,"precision",void 0),this.precision=t}get typeId(){return qn.Float}get[Wn](){return"Float"}toString(){return"Float".concat(this.precision)}}class os extends is{constructor(){super(32)}}class as extends is{constructor(){super(64)}}Yn=Symbol.toStringTag;class cs extends Xn{constructor(t,e){super(),m(this,"listSize",void 0),m(this,"children",void 0),this.listSize=t,this.children=[e]}get typeId(){return qn.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[Yn](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function ls(t,e,r){return function(t,e,r){const n=function(t){switch(t.constructor){case Int8Array:return new $n;case Uint8Array:return new rs;case Int16Array:return new ts;case Uint16Array:return new ns;case Int32Array:return new es;case Uint32Array:return new ss;case Float32Array:return new os;case Float64Array:return new as;default:throw new Error("array type not supported")}}(e.value),s=r||function(t){const e=new Map;return"byteOffset"in t&&e.set("byteOffset",t.byteOffset.toString(10)),"byteStride"in t&&e.set("byteStride",t.byteStride.toString(10)),"normalized"in t&&e.set("normalized",t.normalized.toString()),e}(e);return new Qn(t,new cs(e.size,new Qn("value",n)),!1,s)}(t,e,r?hs(r.metadata):void 0)}function hs(t){const e=new Map;for(const r in t)e.set("".concat(r,".string"),JSON.stringify(t[r]));return e}const us={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},ds={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array};class fs{constructor(t){m(this,"draco",void 0),m(this,"decoder",void 0),m(this,"metadataQuerier",void 0),this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t,e={}){const r=new this.draco.DecoderBuffer;r.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(e);const n=this.decoder.GetEncodedGeometryType(r),s=n===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let t;switch(n){case this.draco.TRIANGULAR_MESH:t=this.decoder.DecodeBufferToMesh(r,s);break;case this.draco.POINT_CLOUD:t=this.decoder.DecodeBufferToPointCloud(r,s);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!t.ok()||!s.ptr){const e="DRACO decompression failed: ".concat(t.error_msg());throw new Error(e)}const i=this._getDracoLoaderData(s,n,e),o=this._getMeshData(s,i,e),a=function(t){let e=1/0,r=1/0,n=1/0,s=-1/0,i=-1/0,o=-1/0;const a=t.POSITION?t.POSITION.value:[],c=a&&a.length;for(let t=0;t<c;t+=3){const c=a[t],l=a[t+1],h=a[t+2];e=c<e?c:e,r=l<r?l:r,n=h<n?h:n,s=c>s?c:s,i=l>i?l:i,o=h>o?h:o}return[[e,r,n],[s,i,o]]}(o.attributes),c=function(t,e,r){const n=hs(e.metadata),s=[],i=function(t){const e={};for(const r in t){const n=t[r];e[n.name||"undefined"]=n}return e}(e.attributes);for(const e in t){const r=ls(e,t[e],i[e]);s.push(r)}if(r){const t=ls("indices",r);s.push(t)}return new Vn(s,n)}(o.attributes,i,o.indices);return{loader:"draco",loaderData:i,header:{vertexCount:s.num_points(),boundingBox:a},...o,schema:c}}finally{this.draco.destroy(r),s&&this.draco.destroy(s)}}_getDracoLoaderData(t,e,r){const n=this._getTopLevelMetadata(t),s=this._getDracoAttributes(t,r);return{geometry_type:e,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:n,attributes:s}}_getDracoAttributes(t,e){const r={};for(let n=0;n<t.num_attributes();n++){const s=this.decoder.GetAttribute(t,n),i=this._getAttributeMetadata(t,n);r[s.unique_id()]={unique_id:s.unique_id(),attribute_type:s.attribute_type(),data_type:s.data_type(),num_components:s.num_components(),byte_offset:s.byte_offset(),byte_stride:s.byte_stride(),normalized:s.normalized(),attribute_index:n,metadata:i};const o=this._getQuantizationTransform(s,e);o&&(r[s.unique_id()].quantization_transform=o);const a=this._getOctahedronTransform(s,e);a&&(r[s.unique_id()].octahedron_transform=a)}return r}_getMeshData(t,e,r){const n=this._getMeshAttributes(e,t,r);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");return t instanceof this.draco.Mesh?"triangle-strip"===r.topology?{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(t),size:1}}:{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(t),size:1}}:{topology:"point-list",mode:0,attributes:n}}_getMeshAttributes(t,e,r){const n={};for(const s of Object.values(t.attributes)){const t=this._deduceAttributeName(s,r);s.name=t;const{value:i,size:o}=this._getAttributeValues(e,s);n[t]={value:i,size:o,byteOffset:s.byte_offset,byteStride:s.byte_stride,normalized:s.normalized}}return n}_getTriangleListIndices(t){const e=3*t.num_faces(),r=4*e,n=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(t,r,n),new Uint32Array(this.draco.HEAPF32.buffer,n,e).slice()}finally{this.draco._free(n)}}_getTriangleStripIndices(t){const e=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,e),function(t){const e=t.size(),r=new Int32Array(e);for(let n=0;n<e;n++)r[n]=t.GetValue(n);return r}(e)}finally{this.draco.destroy(e)}}_getAttributeValues(t,e){const r=ds[e.data_type],n=e.num_components,s=t.num_points()*n,i=s*r.BYTES_PER_ELEMENT,o=function(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}(this.draco,r);let a;const c=this.draco._malloc(i);try{const n=this.decoder.GetAttribute(t,e.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,n,o,i,c),a=new r(this.draco.HEAPF32.buffer,c,s).slice()}finally{this.draco._free(c)}return{value:a,size:n}}_deduceAttributeName(t,e){const r=t.unique_id;for(const[t,n]of Object.entries(e.extraAttributes||{}))if(n===r)return t;const n=t.attribute_type;for(const t in us)if(this.draco[t]===n)return us[t];const s=e.attributeNameEntry||"name";return t.metadata[s]?t.metadata[s].string:"CUSTOM_ATTRIBUTE_".concat(r)}_getTopLevelMetadata(t){const e=this.decoder.GetMetadata(t);return this._getDracoMetadata(e)}_getAttributeMetadata(t,e){const r=this.decoder.GetAttributeMetadata(t,e);return this._getDracoMetadata(r)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const e={},r=this.metadataQuerier.NumEntries(t);for(let n=0;n<r;n++){const r=this.metadataQuerier.GetEntryName(t,n);e[r]=this._getDracoMetadataField(t,r)}return e}_getDracoMetadataField(t,e){const r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,e,r);const n=function(t){const e=t.size(),r=new Int32Array(e);for(let n=0;n<e;n++)r[n]=t.GetValue(n);return r}(r);return{int:this.metadataQuerier.GetIntEntry(t,e),string:this.metadataQuerier.GetStringEntry(t,e),double:this.metadataQuerier.GetDoubleEntry(t,e),intArray:n}}finally{this.draco.destroy(r)}}_disableAttributeTransforms(t){const{quantizedAttributes:e=[],octahedronAttributes:r=[]}=t,n=[...e,...r];for(const t of n)this.decoder.SkipAttributeTransform(this.draco[t])}_getQuantizationTransform(t,e){const{quantizedAttributes:r=[]}=e,n=t.attribute_type();if(r.map((t=>this.decoder[t])).includes(n)){const e=new this.draco.AttributeQuantizationTransform;try{if(e.InitFromAttribute(t))return{quantization_bits:e.quantization_bits(),range:e.range(),min_values:new Float32Array([1,2,3]).map((t=>e.min_value(t)))}}finally{this.draco.destroy(e)}}return null}_getOctahedronTransform(t,e){const{octahedronAttributes:r=[]}=e,n=t.attribute_type();if(r.map((t=>this.decoder[t])).includes(n)){const e=new this.draco.AttributeQuantizationTransform;try{if(e.InitFromAttribute(t))return{quantization_bits:e.quantization_bits()}}finally{this.draco.destroy(e)}}return null}}const ms="1.4.1",As="https://www.gstatic.com/draco/versioned/decoders/".concat(ms,"/draco_decoder.js"),ps="https://www.gstatic.com/draco/versioned/decoders/".concat(ms,"/draco_wasm_wrapper.js"),Bs="https://www.gstatic.com/draco/versioned/decoders/".concat(ms,"/draco_decoder.wasm");let gs;const ys={...kn,parse:async function(t,e){const{draco:r}=await async function(t){const e=t.modules||{};return gs=e.draco3d?gs||e.draco3d.createDecoderModule({}).then((t=>({draco:t}))):gs||async function(t){let e,r;return"js"===(t.draco&&t.draco.decoderType)?e=await M(As,"draco",t):[e,r]=await Promise.all([await M(ps,"draco",t),await M(Bs,"draco",t)]),e=e||globalThis.DracoDecoderModule,await function(t,e){const r={};return e&&(r.wasmBinary=e),new Promise((e=>{t({...r,onModuleLoaded:t=>e({draco:t})})}))}(e,r)}(t),await gs}(e),n=new fs(r);try{return n.parseSync(t,null==e?void 0:e.draco)}finally{n.destroy()}}},Cs={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},bs={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,...Cs},ws={[Cs.DOUBLE]:Float64Array,[Cs.FLOAT]:Float32Array,[Cs.UNSIGNED_SHORT]:Uint16Array,[Cs.UNSIGNED_INT]:Uint32Array,[Cs.UNSIGNED_BYTE]:Uint8Array,[Cs.BYTE]:Int8Array,[Cs.SHORT]:Int16Array,[Cs.INT]:Int32Array},Es={DOUBLE:Cs.DOUBLE,FLOAT:Cs.FLOAT,UNSIGNED_SHORT:Cs.UNSIGNED_SHORT,UNSIGNED_INT:Cs.UNSIGNED_INT,UNSIGNED_BYTE:Cs.UNSIGNED_BYTE,BYTE:Cs.BYTE,SHORT:Cs.SHORT,INT:Cs.INT},Ts="Failed to convert GL type";class vs{static fromTypedArray(t){t=ArrayBuffer.isView(t)?t.constructor:t;for(const e in ws)if(ws[e]===t)return e;throw new Error(Ts)}static fromName(t){const e=Es[t];if(!e)throw new Error(Ts);return e}static getArrayType(t){switch(t){case Cs.UNSIGNED_SHORT_5_6_5:case Cs.UNSIGNED_SHORT_4_4_4_4:case Cs.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const e=ws[t];if(!e)throw new Error(Ts);return e}}static getByteSize(t){return vs.getArrayType(t).BYTES_PER_ELEMENT}static validate(t){return Boolean(vs.getArrayType(t))}static createTypedArray(t,e,r=0,n){return void 0===n&&(n=(e.byteLength-r)/vs.getByteSize(t)),new(vs.getArrayType(t))(e,r,n)}}function Is(t,e=[0,0,0]){const r=t>>11&31,n=t>>5&63,s=31&t;return e[0]=r<<3,e[1]=n<<2,e[2]=s<<3,e}function _s(t,e=255){return function(t,e,r){return ne(t,(t=>Math.max(0,Math.min(r,t))))}(t,0,e)/e*2-1}function Ms(t){return t<0?-1:1}function Fs(t,e,r,n){if(function(t,e){if(!t)throw new Error("math.gl assertion failed. ".concat(void 0))}(n),t<0||t>r||e<0||e>r)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(r));if(n.x=_s(t,r),n.y=_s(e,r),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){const t=n.x;n.x=(1-Math.abs(n.y))*Ms(t),n.y=(1-Math.abs(t))*Ms(n.y)}return n.normalize()}new be,new xe,new be,new be;class Ds{constructor(t,e){m(this,"json",void 0),m(this,"buffer",void 0),m(this,"featuresLength",0),m(this,"_cachedTypedArrays",{}),this.json=t,this.buffer=e}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return Boolean(this.json[t])}getGlobalProperty(t,e=bs.UNSIGNED_INT,r=1){const n=this.json[t];return n&&Number.isFinite(n.byteOffset)?this._getTypedArrayFromBinary(t,e,r,1,n.byteOffset):n}getPropertyArray(t,e,r){const n=this.json[t];return n&&Number.isFinite(n.byteOffset)?("componentType"in n&&(e=vs.fromName(n.componentType)),this._getTypedArrayFromBinary(t,e,r,this.featuresLength,n.byteOffset)):this._getTypedArrayFromArray(t,e,n)}getProperty(t,e,r,n,s){const i=this.json[t];if(!i)return i;const o=this.getPropertyArray(t,e,r);if(1===r)return o[n];for(let t=0;t<r;++t)s[t]=o[r*n+t];return s}_getTypedArrayFromBinary(t,e,r,n,s){const i=this._cachedTypedArrays;let o=i[t];return o||(o=vs.createTypedArray(e,this.buffer.buffer,this.buffer.byteOffset+s,n*r),i[t]=o),o}_getTypedArrayFromArray(t,e,r){const n=this._cachedTypedArrays;let s=n[t];return s||(s=vs.createTypedArray(e,r),n[t]=s),s}}const Gs={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},xs={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},Ss={SCALAR:(t,e,r)=>{e[r]=t},VEC2:(t,e,r)=>{e[2*r+0]=t[0],e[2*r+1]=t[1]},VEC3:(t,e,r)=>{e[3*r+0]=t[0],e[3*r+1]=t[1],e[3*r+2]=t[2]},VEC4:(t,e,r)=>{e[4*r+0]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3]},MAT2:(t,e,r)=>{e[4*r+0]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3]},MAT3:(t,e,r)=>{e[9*r+0]=t[0],e[9*r+1]=t[1],e[9*r+2]=t[2],e[9*r+3]=t[3],e[9*r+4]=t[4],e[9*r+5]=t[5],e[9*r+6]=t[6],e[9*r+7]=t[7],e[9*r+8]=t[8],e[9*r+9]=t[9]},MAT4:(t,e,r)=>{e[16*r+0]=t[0],e[16*r+1]=t[1],e[16*r+2]=t[2],e[16*r+3]=t[3],e[16*r+4]=t[4],e[16*r+5]=t[5],e[16*r+6]=t[6],e[16*r+7]=t[7],e[16*r+8]=t[8],e[16*r+9]=t[9],e[16*r+10]=t[10],e[16*r+11]=t[11],e[16*r+12]=t[12],e[16*r+13]=t[13],e[16*r+14]=t[14],e[16*r+15]=t[15]}},Rs=t=>void 0!==t;function Os(t,e,r){if(!t)return;const n=t.parentCounts;return t.parentIds?r(t,e):n>0?function(t,e,r){const n=t.classIds,s=t.parentCounts,i=t.parentIds,o=t.parentIndexes,a=n.length,c=scratchVisited;c.length=Math.max(c.length,a);const l=++marker,h=scratchStack;for(h.length=0,h.push(e);h.length>0;){if(c[e=h.pop()]===l)continue;c[e]=l;const n=r(t,e);if(Rs(n))return n;const a=s[e],u=o[e];for(let t=0;t<a;++t){const r=i[u+t];r!==e&&h.push(r)}}return null}(t,e,r):function(t,e,r){let n=!0;for(;n;){const s=r(t,e);if(Rs(s))return s;const i=t.parentIds[e];n=i!==e,e=i}throw new Error("traverseHierarchySingleParent")}(t,e,r)}function Us(t,e,r){const n=t.parentCounts,s=t.parentIds,i=t.parentIndexes,o=t.classIds.length;if(!Rs(s))return;assert(e<o,"Parent index ".concat(e," exceeds the total number of instances: ").concat(o)),assert(-1===r.indexOf(e),"Circular dependency detected in the batch table hierarchy."),r.push(e);const a=Rs(n)?n[e]:1,c=Rs(n)?i[e]:e;for(let n=0;n<a;++n){const i=s[c+n];i!==e&&Us(t,i,r)}r.pop(e)}function Ls(t){return null!=t}const Ns=(t,e)=>t,Hs={HIERARCHY:!0,extensions:!0,extras:!0};class Js{constructor(t,e,n,s={}){var i;m(this,"json",void 0),m(this,"binary",void 0),m(this,"featureCount",void 0),m(this,"_extensions",void 0),m(this,"_properties",void 0),m(this,"_binaryProperties",void 0),m(this,"_hierarchy",void 0),r(n>=0),this.json=t||{},this.binary=e,this.featureCount=n,this._extensions=(null===(i=this.json)||void 0===i?void 0:i.extensions)||{},this._properties={};for(const t in this.json)Hs[t]||(this._properties[t]=this.json[t]);this._binaryProperties=this._initializeBinaryProperties(),s["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=function(t,e,r){if(!e)return null;let n=t.getExtension("3DTILES_batch_table_hierarchy");const s=e.HIERARCHY;return s&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=s,n=s),n?function(t,e){let r,n,s;const i=t.instancesLength,o=t.classes;let a,c=t.classIds,l=t.parentCounts,h=t.parentIds,u=i;if(Rs(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,s=getBinaryAccessor(c),c=s.createArrayBufferView(e.buffer,e.byteOffset+c.byteOffset,i)),Rs(l))for(Rs(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,s=getBinaryAccessor(l),l=s.createArrayBufferView(e.buffer,e.byteOffset+l.byteOffset,i)),a=new Uint16Array(i),u=0,r=0;r<i;++r)a[r]=u,u+=l[r];Rs(h)&&Rs(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,s=getBinaryAccessor(h),h=s.createArrayBufferView(e.buffer,e.byteOffset+h.byteOffset,u));const d=o.length;for(r=0;r<d;++r){const t=o[r].length,n=o[r].instances,s=getBinaryProperties(t,n,e);o[r].instances=combine(s,n)}const f=new Array(d).fill(0),m=new Uint16Array(i);for(r=0;r<i;++r)n=c[r],m[r]=f[n],++f[n];const A={classes:o,classIds:c,classIndexes:m,parentCounts:l,parentIndexes:a,parentIds:h};return function(t){const e=t.classIds.length;for(let r=0;r<e;++r)Us(t,r,stack)}(A),A}(n,r):null}(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,e){return this._checkBatchId(t),r("string"==typeof e,e),!!this._hierarchy&&Ls(Os(this._hierarchy,t,((t,r)=>{const n=t.classIds[r];return t.classes[n].name===e})))}isExactClass(t,e){return r("string"==typeof e,e),this.getExactClassName(t)===e}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){const e=this._hierarchy.classIds[t];return this._hierarchy.classes[e].name}}hasProperty(t,e){return this._checkBatchId(t),r("string"==typeof e,e),Ls(this._properties[e])||this._hasPropertyInHierarchy(t,e)}getPropertyNames(t,e){this._checkBatchId(t),(e=Ls(e)?e:[]).length=0;const r=Object.keys(this._properties);return e.push(...r),this._hierarchy&&this._getPropertyNamesInHierarchy(t,e),e}getProperty(t,e){if(this._checkBatchId(t),r("string"==typeof e,e),this._binaryProperties){const r=this._binaryProperties[e];if(Ls(r))return this._getBinaryProperty(r,t)}const n=this._properties[e];if(Ls(n))return Ns(n[t]);if(this._hierarchy){const r=this._getHierarchyProperty(t,e);if(Ls(r))return r}}setProperty(t,e,n){const s=this.featureCount;if(this._checkBatchId(t),r("string"==typeof e,e),this._binaryProperties){const r=this._binaryProperties[e];if(r)return void this._setBinaryProperty(r,t,n)}if(this._hierarchy&&this._setHierarchyProperty(this,t,e,n))return;let i=this._properties[e];Ls(i)||(this._properties[e]=new Array(s),i=this._properties[e]),i[t]=Ns(n)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,e){return t.unpack(t.typedArray,e)}_setBinaryProperty(t,e,r){t.pack(r,t.typedArray,e)}_initializeBinaryProperties(){let t=null;for(const e in this._properties){const r=this._properties[e],n=this._initializeBinaryProperty(e,r);n&&(t=t||{},t[e]=n)}return t}_initializeBinaryProperty(t,e){if("byteOffset"in e){const n=e;r(this.binary,"Property ".concat(t," requires a batch table binary.")),r(n.type,"Property ".concat(t," requires a type."));const s=function(t,e,n,s){const{componentType:i}=t;r(t.componentType);const o="string"==typeof i?vs.fromName(i):i,a=Gs[t.type],c=xs[t.type],l=Ss[t.type];return n+=t.byteOffset,{values:vs.createTypedArray(o,e,n,a*s),type:o,size:a,unpacker:c,packer:l}}(n,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return{typedArray:s.values,componentCount:s.size,unpack:s.unpacker,pack:s.packer}}return null}_hasPropertyInHierarchy(t,e){if(!this._hierarchy)return!1;const r=Os(this._hierarchy,t,((t,r)=>{const n=t.classIds[r];return Ls(t.classes[n].instances[e])}));return Ls(r)}_getPropertyNamesInHierarchy(t,e){Os(this._hierarchy,t,((t,r)=>{const n=t.classIds[r],s=t.classes[n].instances;for(const t in s)s.hasOwnProperty(t)&&-1===e.indexOf(t)&&e.push(t)}))}_getHierarchyProperty(t,e){return Os(this._hierarchy,t,((t,r)=>{const n=t.classIds[r],s=t.classes[n],i=t.classIndexes[r],o=s.instances[e];return Ls(o)?Ls(o.typedArray)?this._getBinaryProperty(o,i):Ns(o[i]):null}))}_setHierarchyProperty(t,e,n,s){const i=Os(this._hierarchy,e,((t,i)=>{const o=t.classIds[i],a=t.classes[o],c=t.classIndexes[i],l=a.instances[n];return!!Ls(l)&&(r(i===e,'Inherited property "'.concat(n,'" is read-only.')),Ls(l.typedArray)?this._setBinaryProperty(l,c,s):l[c]=Ns(s),!0)}));return Ls(i)}}function Ps(t,e,r=0){const n=new DataView(e);if(t.magic=n.getUint32(r,!0),r+=4,t.version=n.getUint32(r,!0),r+=4,t.byteLength=n.getUint32(r,!0),r+=4,1!==t.version)throw new Error("3D Tile Version ".concat(t.version," not supported"));return r}const js="b3dm tile in legacy format.";function ks(t,e,r){const n=new DataView(e);let s;t.header=t.header||{};let i=n.getUint32(r,!0);r+=4;let o=n.getUint32(r,!0);r+=4;let a=n.getUint32(r,!0);r+=4;let c=n.getUint32(r,!0);return r+=4,a>=570425344?(r-=8,s=i,a=o,c=0,i=0,o=0,console.warn(js)):c>=570425344&&(r-=4,s=a,a=i,c=o,i=0,o=0,console.warn(js)),t.header.featureTableJsonByteLength=i,t.header.featureTableBinaryByteLength=o,t.header.batchTableJsonByteLength=a,t.header.batchTableBinaryByteLength=c,t.header.batchLength=s,r}function Vs(t,e,r,n){return r=function(t,e,r,n){const{featureTableJsonByteLength:s,featureTableBinaryByteLength:i,batchLength:o}=t.header;if(t.featureTableJson={BATCH_LENGTH:o||0},s>0){const n=jn(e,r,s);t.featureTableJson=JSON.parse(n)}return r+=s,t.featureTableBinary=new Uint8Array(e,r,i),r+i}(t,e,r),r=function(t,e,r,n){const{batchTableJsonByteLength:s,batchTableBinaryByteLength:i}=t.header;if(s>0){const n=jn(e,r,s);t.batchTableJson=JSON.parse(n),r+=s,i>0&&(t.batchTableBinary=new Uint8Array(e,r,i),t.batchTableBinary=new Uint8Array(t.batchTableBinary),r+=i)}return r}(t,e,r),r}function Ks(t,e,r){if(!(e||t&&t.batchIds&&r))return null;const{batchIds:n,isRGB565:s,pointCount:i}=t;if(n&&r){const t=new Uint8ClampedArray(3*i);for(let e=0;e<i;e++){const s=n[e],i=r.getProperty(s,"dimensions").map((t=>255*t));t[3*e]=i[0],t[3*e+1]=i[1],t[3*e+2]=i[2]}return{type:bs.UNSIGNED_BYTE,value:t,size:3,normalized:!0}}if(s){const t=new Uint8ClampedArray(3*i);for(let r=0;r<i;r++){const n=Is(e[r]);t[3*r]=n[0],t[3*r+1]=n[1],t[3*r+2]=n[2]}return{type:bs.UNSIGNED_BYTE,value:t,size:3,normalized:!0}}return e&&e.length===3*i?{type:bs.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:bs.UNSIGNED_BYTE,value:e,size:4,normalized:!0}}const Qs=new xe;async function qs(t,e,r,n,s){r=Vs(t,e,r=ks(t,e,r=Ps(t,e,r))),function(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}(t);const{featureTable:i,batchTable:o}=function(t){const e=new Ds(t.featureTableJson,t.featureTableBinary),r=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(r))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=r,t.featuresLength=r,t.pointsLength=r,t.pointCount=r,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",bs.FLOAT,3);const n=function(t,e){let r=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",bs.UNSIGNED_SHORT,1),t.batchIds)){const n=e.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:s,batchTableBinary:i}=t;r=new Js(s,i,n)}return r}(t,e);return{featureTable:e,batchTable:n}}(t);return await async function(t,e,r,n,s){let i,o,a;const c=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];c&&(a=c.properties);const l=e.getExtension("3DTILES_draco_point_compression");if(l){o=l.properties;const e=l.byteOffset,r=l.byteLength;if(!o||!Number.isFinite(e)||!r)throw new Error("Draco properties, byteOffset, and byteLength must be defined");i=t.featureTableBinary.slice(e,e+r),t.hasPositions=Number.isFinite(o.POSITION),t.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),t.hasNormals=Number.isFinite(o.NORMAL),t.hasBatchIds=Number.isFinite(o.BATCH_ID),t.isTranslucent=Number.isFinite(o.RGBA)}if(!i)return!0;const h={buffer:i,properties:{...o,...a},featureTableProperties:o,batchTableProperties:a,dequantizeInShader:!1};return await async function(t,e,r,n){const{parse:s}=n,i={...r,draco:{...r.draco,extraAttributes:e.batchTableProperties||{}}};delete i["3d-tiles"];const o=await s(e.buffer,ys,i),a=o.attributes.POSITION&&o.attributes.POSITION.value,c=o.attributes.COLOR_0&&o.attributes.COLOR_0.value,l=o.attributes.NORMAL&&o.attributes.NORMAL.value,h=o.attributes.BATCH_ID&&o.attributes.BATCH_ID.value,u=a&&o.attributes.POSITION.value.quantization,d=l&&o.attributes.NORMAL.value.quantization;if(u){const e=o.POSITION.data.quantization,r=e.range;t.quantizedVolumeScale=new xe(r,r,r),t.quantizedVolumeOffset=new xe(e.minValues),t.quantizedRange=(1<<e.quantizationBits)-1,t.isQuantizedDraco=!0}d&&(t.octEncodedRange=(1<<o.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);const f={};if(e.batchTableProperties)for(const t of Object.keys(e.batchTableProperties))o.attributes[t]&&o.attributes[t].value&&(f[t.toLowerCase()]=o.attributes[t].value);t.attributes={positions:a,colors:Ks(t,c,void 0),normals:l,batchIds:h,...f}}(t,h,n,s)}(t,i,0,n,s),function(t,e,r){if(!t.attributes.positions)if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",bs.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const n=e.getPropertyArray("POSITION_QUANTIZED",bs.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65535,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",bs.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",bs.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=function(t,e,r){return t.isQuantized?r["3d-tiles"]&&r["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,function(t,e){const r=new xe,n=new Float32Array(3*t.pointCount);for(let s=0;s<t.pointCount;s++)r.set(e[3*s],e[3*s+1],e[3*s+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(n,3*s);return n}(t,e)):{type:bs.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}(t,n,r)}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}(t,i,n),function(t,e,r){if(!t.attributes.colors){let n=null;e.hasProperty("RGBA")?(n=e.getPropertyArray("RGBA",bs.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?n=e.getPropertyArray("RGB",bs.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(n=e.getPropertyArray("RGB565",bs.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=Ks(t,n,r)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",bs.UNSIGNED_BYTE,4))}(t,i,o),function(t,e){if(!t.attributes.normals){let r=null;e.hasProperty("NORMAL")?r=e.getPropertyArray("NORMAL",bs.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(r=e.getPropertyArray("NORMAL_OCT16P",bs.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=function(t,e){if(!e)return null;if(t.isOctEncoded16P){const s=new Float32Array(3*t.pointsLength);for(let i=0;i<t.pointsLength;i++)r=e[2*i],n=e[2*i+1],Fs(r,n,255,Qs),Qs.toArray(s,3*i);return{type:bs.FLOAT,size:2,value:s}}var r,n;return{type:bs.FLOAT,size:2,value:e}}(t,r)}}(t,i),r}const zs="3.1.4",Ws="https://unpkg.com/@loaders.gl/textures@".concat(zs,"/dist/libs/basis_encoder.wasm"),Ys="https://unpkg.com/@loaders.gl/textures@".concat(zs,"/dist/libs/basis_encoder.js");let Xs,Zs;async function $s(t){const e=t.modules||{};return e.basis?e.basis:(Xs=Xs||async function(t){let e=null,r=null;return[e,r]=await Promise.all([await M("basis_transcoder.js","textures",t),await M("basis_transcoder.wasm","textures",t)]),e=e||globalThis.BASIS,await function(t,e){const r={};return e&&(r.wasmBinary=e),new Promise((e=>{t(r).then((t=>{const{BasisFile:r,initializeBasis:n}=t;n(),e({BasisFile:r})}))}))}(e,r)}(t),await Xs)}async function ti(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(Zs=Zs||async function(t){let e=null,r=null;return[e,r]=await Promise.all([await M(Ys,"textures",t),await M(Ws,"textures",t)]),e=e||globalThis.BASIS,await function(t,e){const r={};return e&&(r.wasmBinary=e),new Promise((e=>{t(r).then((t=>{const{BasisFile:r,KTX2File:n,initializeBasis:s,BasisEncoder:i}=t;s(),e({BasisFile:r,KTX2File:n,BasisEncoder:i})}))}))}(e,r)}(t),await Zs)}const ei=["","WEBKIT_","MOZ_"],ri={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let ni=null;var si,ii,oi,ai,ci,li,hi,ui,di;(di=si||(si={}))[di.NONE=0]="NONE",di[di.BASISLZ=1]="BASISLZ",di[di.ZSTD=2]="ZSTD",di[di.ZLIB=3]="ZLIB",function(t){t[t.BASICFORMAT=0]="BASICFORMAT"}(ii||(ii={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.ETC1S=163]="ETC1S",t[t.UASTC=166]="UASTC"}(oi||(oi={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.SRGB=1]="SRGB"}(ai||(ai={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.LINEAR=1]="LINEAR",t[t.SRGB=2]="SRGB",t[t.ITU=3]="ITU",t[t.NTSC=4]="NTSC",t[t.SLOG=5]="SLOG",t[t.SLOG2=6]="SLOG2"}(ci||(ci={})),function(t){t[t.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",t[t.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(li||(li={})),function(t){t[t.RGB=0]="RGB",t[t.RRR=3]="RRR",t[t.GGG=4]="GGG",t[t.AAA=15]="AAA"}(hi||(hi={})),function(t){t[t.RGB=0]="RGB",t[t.RGBA=3]="RGBA",t[t.RRR=4]="RRR",t[t.RRRG=5]="RRRG"}(ui||(ui={}));const fi=[171,75,84,88,32,50,48,187,13,10,26,10],mi={etc1:{basisFormat:0,compressed:!0,format:36196},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:33776},bc3:{basisFormat:3,compressed:!0,format:33779},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:35840},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:35842},"astc-4x4":{basisFormat:10,compressed:!0,format:37808},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};function Ai(t,e,r){const n=new t(new Uint8Array(e));try{if(!n.startTranscoding())return null;const t=n.getNumImages(),e=[];for(let s=0;s<t;s++){const t=n.getNumLevels(s),i=[];for(let e=0;e<t;e++)i.push(pi(n,s,e,r));e.push(i)}return e}finally{n.close(),n.delete()}}function pi(t,e,r,n){const s=t.getImageWidth(e,r),i=t.getImageHeight(e,r),o=t.getHasAlpha(),{compressed:a,format:c,basisFormat:l}=yi(n,o),h=t.getImageTranscodedSizeInBytes(e,r,l),u=new Uint8Array(h);return t.transcodeImage(u,e,r,l,0,0)?{width:s,height:i,data:u,compressed:a,hasAlpha:o,format:c}:null}function Bi(t,e,r){const n=new t(new Uint8Array(e));try{if(!n.startTranscoding())return null;const t=n.getLevels(),e=[];for(let s=0;s<t;s++){e.push(gi(n,s,r));break}return e}finally{n.close(),n.delete()}}function gi(t,e,r){const{alphaFlag:n,height:s,width:i}=t.getImageLevelInfo(e,0,0),{compressed:o,format:a,basisFormat:c}=yi(r,n),l=t.getImageTranscodedSizeInBytes(e,0,0,c),h=new Uint8Array(l);return t.transcodeImage(h,e,0,0,c,0,-1,-1)?{width:i,height:s,data:h,compressed:o,alphaFlag:n,format:a}:null}function yi(t,e){let r=t&&t.basis&&t.basis.format;return"auto"===r&&(r=Ci()),"object"==typeof r&&(r=e?r.alpha:r.noAlpha),r=r.toLowerCase(),mi[r]}function Ci(){const t=function(t){if(!ni){t=t||function(){try{return document.createElement("canvas").getContext("webgl")}catch(t){return null}}()||void 0,ni=new Set;for(const e of ei)for(const r in ri)if(t&&t.getExtension("".concat(e).concat(r))){const t=ri[r];ni.add(t)}}return ni}();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const bi={name:"Basis",id:"basis",module:"textures",version:"3.1.4",worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}},parse:async function(t,e){if("auto"===e.basis.containerFormat){if(function(t){const e=new Uint8Array(t);return!(e.byteLength<fi.length||e[0]!==fi[0]||e[1]!==fi[1]||e[2]!==fi[2]||e[3]!==fi[3]||e[4]!==fi[4]||e[5]!==fi[5]||e[6]!==fi[6]||e[7]!==fi[7]||e[8]!==fi[8]||e[9]!==fi[9]||e[10]!==fi[10]||e[11]!==fi[11])}(t))return Bi((await ti(e)).KTX2File,t,e);const{BasisFile:r}=await $s(e);return Ai(r,t,e)}if("encoder"===e.basis.module){const r=await ti(e);return"ktx2"===e.basis.containerFormat?Bi(r.KTX2File,t,e):Ai(r.BasisFile,t,e)}{const{BasisFile:r}=await $s(e);return Ai(r,t,e)}}},{_parseImageNode:wi}=globalThis,Ei="undefined"!=typeof Image,Ti="undefined"!=typeof ImageBitmap,vi=Boolean(wi),Ii=!!i||vi;const _i=/^data:image\/svg\+xml/,Mi=/\.svg((\?|#).*)?$/;function Fi(t){return t&&(_i.test(t)||Mi.test(t))}function Di(t,e){if(Fi(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function Gi(t,e,r){const n=function(t,e){if(Fi(e)){let e=(new TextDecoder).decode(t);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(e=unescape(encodeURIComponent(e)))}catch(t){throw new Error(t.message)}return"data:image/svg+xml;base64,".concat(btoa(e))}return Di(t,e)}(t,r),s=self.URL||self.webkitURL,i="string"!=typeof n&&s.createObjectURL(n);try{return await async function(t,e){const r=new Image;return r.src=t,e.image&&e.image.decode&&r.decode?(await r.decode(),r):await new Promise(((e,n)=>{try{r.onload=()=>e(r),r.onerror=e=>n(new Error("Could not load image ".concat(t,": ").concat(e)))}catch(t){n(t)}}))}(i||n,e)}finally{i&&s.revokeObjectURL(i)}}const xi={};let Si=!0;const Ri=!1,Oi=!0;function Ui(t){const e=Li(t);return function(t){const e=Li(t);return e.byteLength>=24&&2303741511===e.getUint32(0,Ri)?{mimeType:"image/png",width:e.getUint32(16,Ri),height:e.getUint32(20,Ri)}:null}(e)||function(t){const e=Li(t);if(!(e.byteLength>=3&&65496===e.getUint16(0,Ri)&&255===e.getUint8(2)))return null;const{tableMarkers:r,sofMarkers:n}=function(){const t=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)t.add(e);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}();let s=2;for(;s+9<e.byteLength;){const t=e.getUint16(s,Ri);if(n.has(t))return{mimeType:"image/jpeg",height:e.getUint16(s+5,Ri),width:e.getUint16(s+7,Ri)};if(!r.has(t))return null;s+=2,s+=e.getUint16(s,Ri)}return null}(e)||function(t){const e=Li(t);return e.byteLength>=10&&1195984440===e.getUint32(0,Ri)?{mimeType:"image/gif",width:e.getUint16(6,Oi),height:e.getUint16(8,Oi)}:null}(e)||function(t){const e=Li(t);return e.byteLength>=14&&16973===e.getUint16(0,Ri)&&e.getUint32(2,Oi)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Oi),height:e.getUint32(22,Oi)}:null}(e)}function Li(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}const Ni={id:"image",module:"images",name:"Images",version:"3.1.4",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg"],parse:async function(t,e,n){const s=((e=e||{}).image||{}).type||"auto",{url:i}=n||{};let o;switch(function(t){switch(t){case"auto":case"data":return function(){if(Ti)return"imagebitmap";if(Ei)return"image";if(Ii)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(t){switch(t){case"auto":return Ti||Ei||Ii;case"imagebitmap":return Ti;case"image":return Ei;case"data":return Ii;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}(t),t}}(s)){case"imagebitmap":o=await async function(t,e,r){let n;n=Fi(r)?await Gi(t,e,r):Di(t,r);const s=e&&e.imagebitmap;return await async function(t,e=null){if(!function(t){for(const e in t||xi)return!1;return!0}(e)&&Si||(e=null),e)try{return await createImageBitmap(t,e)}catch(t){console.warn(t),Si=!1}return await createImageBitmap(t)}(n,s)}(t,e,i);break;case"image":o=await Gi(t,e,i);break;case"data":o=await async function(t,e){const{mimeType:n}=Ui(t)||{},s=globalThis._parseImageNode;return r(s),await s(t,n)}(t);break;default:r(!1)}return"data"===s&&(o=function(t){switch(function(t){const e=function(t){return"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&t instanceof Image?"image":t&&"object"==typeof t&&t.data&&t.width&&t.height?"data":null}(t);if(!e)throw new Error("Not an image");return e}(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),r=e.getContext("2d");if(!r)throw new Error("getImageData");return e.width=t.width,e.height=t.height,r.drawImage(t,0,0),r.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}(o)),o},tests:[t=>Boolean(Ui(new DataView(t)))],options:{image:{type:"auto",decode:!0}}},Hi=["image/png","image/jpeg","image/gif"],Ji={};function Pi(t,e){if(!t)throw new Error(e||"assert failed: gltf")}function ji(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const r=e.baseUri||e.uri;if(!r)throw new Error("'baseUri' must be provided to resolve relative url ".concat(t));return r.substr(0,r.lastIndexOf("/")+1)+t}const ki=["SCALAR","VEC2","VEC3","VEC4"],Vi=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Ki=new Map(Vi),Qi={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},qi={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},zi={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Wi(t){return ki[t-1]||ki[0]}function Yi(t){const e=Ki.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function Xi(t,e){const r=zi[t.componentType],n=Qi[t.type],s=qi[t.componentType],i=t.count*n,o=t.count*n*s;return Pi(o>=0&&o<=e.byteLength),{ArrayType:r,length:i,byteLength:o}}const Zi={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class $i{constructor(t){m(this,"gltf",void 0),m(this,"sourceBuffers",void 0),m(this,"byteLength",void 0),this.gltf=t||{json:{...Zi},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}getExtension(t){const e=this.getUsedExtensions().find((e=>e===t)),r=this.json.extensions||{};return e?r[t]||!0:null}getRequiredExtension(t){return this.getRequiredExtensions().find((e=>e===t))?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getObjectExtension(t,e){return(t.extensions||{})[e]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,e){if("object"==typeof e)return e;const r=this.json[t]&&this.json[t][e];if(!r)throw new Error("glTF file error: Could not find ".concat(t,"[").concat(e,"]"));return r}getTypedArrayForBufferView(t){const e=(t=this.getBufferView(t)).buffer,r=this.gltf.buffers[e];Pi(r);const n=(t.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,n,t.byteLength)}getTypedArrayForAccessor(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),r=this.getBuffer(e.buffer).data,{ArrayType:n,length:s}=Xi(t,e);return new n(r,e.byteOffset+t.byteOffset,s)}getTypedArrayForImageData(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),r=this.getBuffer(e.buffer).data,n=e.byteOffset||0;return new Uint8Array(r,n,e.byteLength)}addApplicationData(t,e){return this.json[t]=e,this}addExtraData(t,e){return this.json.extras=this.json.extras||{},this.json.extras[t]=e,this}addObjectExtension(t,e,r){return t.extensions=t.extensions||{},t.extensions[e]=r,this.registerUsedExtension(e),this}setObjectExtension(t,e,r){(t.extensions||{})[e]=r}removeObjectExtension(t,e){const r=t.extensions||{},n=r[e];return delete r[e],n}addExtension(t,e={}){return Pi(e),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=e,this.registerUsedExtension(t),e}addRequiredExtension(t,e={}){return Pi(e),this.addExtension(t,e),this.registerRequiredExtension(t),e}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find((e=>e===t))||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find((e=>e===t))||this.json.extensionsRequired.push(t)}removeExtension(t){this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t),this.json.extensions&&delete this.json.extensions[t]}setDefaultScene(t){this.json.scene=t}addScene(t){const{nodeIndices:e}=t;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:e}),this.json.scenes.length-1}addNode(t){const{meshIndex:e,matrix:r}=t;this.json.nodes=this.json.nodes||[];const n={mesh:e};return r&&(n.matrix=r),this.json.nodes.push(n),this.json.nodes.length-1}addMesh(t){const{attributes:e,indices:r,material:n,mode:s=4}=t,i={primitives:[{attributes:this._addAttributes(e),mode:s}]};if(r){const t=this._addIndices(r);i.primitives[0].indices=t}return Number.isFinite(n)&&(i.primitives[0].material=n),this.json.meshes=this.json.meshes||[],this.json.meshes.push(i),this.json.meshes.length-1}addPointCloud(t){const e={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(e),this.json.meshes.length-1}addImage(t,e){const r=Ui(t),n=e||(null==r?void 0:r.mimeType),s={bufferView:this.addBufferView(t),mimeType:n};return this.json.images=this.json.images||[],this.json.images.push(s),this.json.images.length-1}addBufferView(t){const e=t.byteLength;Pi(Number.isFinite(e)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const r={buffer:0,byteOffset:this.byteLength,byteLength:e};return this.byteLength+=O(e,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(r),this.json.bufferViews.length-1}addAccessor(t,e){const r={bufferView:t,type:Wi(e.size),componentType:e.componentType,count:e.count,max:e.max,min:e.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}addBinaryBuffer(t,e={size:3}){const r=this.addBufferView(t);let n={min:e.min,max:e.max};n.min&&n.max||(n=this._getAccessorMinMax(t,e.size));const s={size:e.size,componentType:Yi(t),count:Math.round(t.length/e.size),min:n.min,max:n.max};return this.addAccessor(r,Object.assign(s,e))}addTexture(t){const{imageIndex:e}=t,r={source:e};return this.json.textures=this.json.textures||[],this.json.textures.push(r),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){var t,e;this.gltf.buffers=[];const r=this.byteLength,n=new ArrayBuffer(r),s=new Uint8Array(n);let i=0;for(const t of this.sourceBuffers||[])i=U(t,s,i);null!==(t=this.json)&&void 0!==t&&null!==(e=t.buffers)&&void 0!==e&&e[0]?this.json.buffers[0].byteLength=r:this.json.buffers=[{byteLength:r}],this.gltf.binary=n,this.sourceBuffers=[n]}_removeStringFromArray(t,e){let r=!0;for(;r;){const n=t.indexOf(e);n>-1?t.splice(n,1):r=!1}}_addAttributes(t={}){const e={};for(const r in t){const n=t[r],s=this._getGltfAttributeName(r),i=this.addBinaryBuffer(n.value,n);e[s]=i}return e}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,e){const r={min:null,max:null};if(t.length<e)return r;r.min=[],r.max=[];const n=t.subarray(0,e);for(const t of n)r.min.push(t),r.max.push(t);for(let n=e;n<t.length;n+=e)for(let s=0;s<e;s++)r.min[0+s]=Math.min(r.min[0+s],t[n+s]),r.max[0+s]=Math.max(r.max[0+s],t[n+s]);return r}}const to="object"!=typeof WebAssembly,eo=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),ro=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),no={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},so={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};let io;const oo="EXT_meshopt_compression";async function ao(t,e){const r=t.getObjectExtension(e,oo);if(r){const t=e.buffer,{byteOffset:n=0,byteLength:s=0,byteStride:i,count:o,mode:a,filter:c="NONE"}=r,l=new Uint8Array(t,n,s),h=new ArrayBuffer(o*i);return await async function(t,e,r,n,s,i="NONE"){const o=await async function(){return io||(io=async function(){let t="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";WebAssembly.validate(eo)&&(t="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",console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(function(t){const e=new Uint8Array(t.length);for(let r=0;r<t.length;++r){const n=t.charCodeAt(r);e[r]=n>96?n-71:n>64?n-65:n>47?n+4:n>46?63:62}let r=0;for(let n=0;n<t.length;++n)e[r++]=e[n]<60?ro[e[n]]:64*(e[n]-60)+e[++n];return e.buffer.slice(0,r)}(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}()),io}();!function(t,e,r,n,s,i,o){const a=t.exports.sbrk,c=n+3&-4,l=a(c*s),h=a(i.length),u=new Uint8Array(t.exports.memory.buffer);u.set(i,h);const d=e(l,n,s,h,i.length);if(0===d&&o&&o(l,c,s),r.set(u.subarray(l,l+n*s)),a(l-a(0)),0!==d)throw new Error("Malformed buffer data: ".concat(d))}(o,o.exports[so[s]],t,e,r,n,o.exports[no[i||"NONE"]])}(new Uint8Array(h),o,i,l,a,c),h}return null}var co=Object.freeze({__proto__:null,name:"EXT_meshopt_compression",preprocess:function(t){if(new $i(t).getRequiredExtensions().includes(oo)&&!to)throw new Error("gltf: Required extension ".concat(oo," not supported by browser"))},decode:async function(t,e){var r;const n=new $i(t);if(null==e||null===(r=e.gltf)||void 0===r||!r.decompressMeshes)return;const s=[];for(const e of t.json.bufferViews||[])s.push(ao(n,e));await Promise.all(s),n.removeExtension(oo)}});const lo="EXT_texture_webp";var ho=Object.freeze({__proto__:null,name:"EXT_texture_webp",preprocess:function(t,e){const r=new $i(t);if(void 0===Ji[n="image/webp"]&&(Ji[n]=function(t){switch(t){case"image/webp":return function(){if(!i)return!1;try{return 0===document.createElement("canvas").toDataURL("image/webp").indexOf("data:image/webp")}catch{return!1}}();case"image/svg":return i;default:if(!i){const{_parseImageNode:e}=globalThis;return Boolean(e)&&Hi.includes(t)}return!0}}(n)),!Ji[n]){if(r.getRequiredExtensions().includes(lo))throw new Error("gltf: Required extension ".concat(lo," not supported by browser"));return}var n;const{json:s}=r;for(const t of s.textures||[]){const e=r.getObjectExtension(t,lo);e&&(t.source=e.source),r.removeObjectExtension(t,lo)}r.removeExtension(lo)}});const uo="KHR_texture_basisu";var fo=Object.freeze({__proto__:null,name:"KHR_texture_basisu",preprocess:function(t,e){const r=new $i(t),{json:n}=r;for(const t of n.textures||[]){const e=r.getObjectExtension(t,uo);e&&(t.source=e.source),r.removeObjectExtension(t,uo)}r.removeExtension(uo)}});function mo(t){const{buffer:e,size:r,count:n}=function(t){let e=t,r=1,n=0;return t&&t.value&&(e=t.value,r=t.size||1),e&&(ArrayBuffer.isView(e)||(e=function(t,e,r=!1){return t?Array.isArray(t)?new e(t):!r||t instanceof e?t:new e(t):null}(e,Float32Array)),n=e.length/r),{buffer:e,size:r,count:n}}(t);return{value:e,size:r,byteOffset:0,count:n,type:Wi(r),componentType:Yi(e)}}const Ao="KHR_draco_mesh_compression";async function po(t,e,r,n){const s=t.getObjectExtension(e,Ao);if(!s)return;const i=t.getTypedArrayForBufferView(s.bufferView),o=R(i.buffer,i.byteOffset),{parse:a}=n,c={...r};delete c["3d-tiles"];const l=await a(o,ys,c,n),h=function(t){const e={};for(const r in t){const n=t[r];if("indices"!==r){const t=mo(n);e[r]=t}}return e}(l.attributes);for(const[r,n]of Object.entries(h))if(r in e.attributes){const s=e.attributes[r],i=t.getAccessor(s);null!=i&&i.min&&null!=i&&i.max&&(n.min=i.min,n.max=i.max)}e.attributes=h,l.indices&&(e.indices=mo(l.indices)),function(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}(e)}function Bo(t,e,r=4,n,s){var i;if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=n.DracoWriter.encodeSync({attributes:t}),a=null==s||null===(i=s.parseSync)||void 0===i?void 0:i.call(s,{attributes:t}),c=n._addFauxAttributes(a.attributes),l=n.addBufferView(o);return{primitives:[{attributes:c,mode:r,extensions:{[Ao]:{bufferView:l,attributes:c}}}]}}function*go(t){for(const e of t.json.meshes||[])for(const t of e.primitives)yield t}var yo=Object.freeze({__proto__:null,name:"KHR_draco_mesh_compression",preprocess:function(t,e,r){const n=new $i(t);for(const t of go(n))n.getObjectExtension(t,Ao)},decode:async function(t,e,r){var n;if(null==e||null===(n=e.gltf)||void 0===n||!n.decompressMeshes)return;const s=new $i(t),i=[];for(const t of go(s))s.getObjectExtension(t,Ao)&&i.push(po(s,t,e,r));await Promise.all(i),s.removeExtension(Ao)},encode:function(t,e={}){const r=new $i(t);for(const t of r.json.meshes||[])Bo(t),r.addRequiredExtension(Ao)}});const Co="KHR_lights_punctual";var bo=Object.freeze({__proto__:null,name:"KHR_lights_punctual",decode:async function(t){const e=new $i(t),{json:r}=e,n=e.getExtension(Co);n&&(e.json.lights=n.lights,e.removeExtension(Co));for(const t of r.nodes||[]){const r=e.getObjectExtension(t,Co);r&&(t.light=r.light),e.removeObjectExtension(t,Co)}},encode:async function(t){const e=new $i(t),{json:r}=e;if(r.lights){const t=e.addExtension(Co);Pi(!t.lights),t.lights=r.lights,delete r.lights}if(e.json.lights){for(const t of e.json.lights){const r=t.node;e.addObjectExtension(r,Co,t)}delete e.json.lights}}});const wo="KHR_materials_unlit",Eo="KHR_techniques_webgl";function To(t,e){const r=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach((e=>{t.uniforms[e].value&&!(e in r)&&(r[e]=t.uniforms[e].value)})),Object.keys(r).forEach((t=>{"object"==typeof r[t]&&void 0!==r[t].index&&(r[t].texture=e.getTexture(r[t].index))})),r}const vo=[co,ho,fo,yo,bo,Object.freeze({__proto__:null,name:"KHR_materials_unlit",decode:async function(t){const e=new $i(t),{json:r}=e;e.removeExtension(wo);for(const t of r.materials||[])t.extensions&&t.extensions.KHR_materials_unlit&&(t.unlit=!0),e.removeObjectExtension(t,wo)},encode:function(t){const e=new $i(t),{json:r}=e;if(e.materials)for(const t of r.materials||[])t.unlit&&(delete t.unlit,e.addObjectExtension(t,wo,{}),e.addExtension(wo))}}),Object.freeze({__proto__:null,name:"KHR_techniques_webgl",decode:async function(t){const e=new $i(t),{json:r}=e,n=e.getExtension(Eo);if(n){const t=function(t,e){const{programs:r=[],shaders:n=[],techniques:s=[]}=t,i=new TextDecoder;return n.forEach((t=>{if(!Number.isFinite(t.bufferView))throw new Error("KHR_techniques_webgl: no shader code");t.code=i.decode(e.getTypedArrayForBufferView(t.bufferView))})),r.forEach((t=>{t.fragmentShader=n[t.fragmentShader],t.vertexShader=n[t.vertexShader]})),s.forEach((t=>{t.program=r[t.program]})),s}(n,e);for(const n of r.materials||[]){const r=e.getObjectExtension(n,Eo);r&&(n.technique=Object.assign({},r,t[r.technique]),n.technique.values=To(n.technique,e)),e.removeObjectExtension(n,Eo)}e.removeExtension(Eo)}},encode:async function(t,e){}})];function Io(t,e){var r;const n=(null==e||null===(r=e.gltf)||void 0===r?void 0:r.excludeExtensions)||{};return!(t in n&&!n[t])}const _o="KHR_binary_glTF",Mo={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},Fo={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class Do{constructor(){m(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),m(this,"json",void 0)}normalize(t,e){this.json=t.json;const r=t.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:return void console.warn("glTF: Unknown version ".concat(r.asset.version))}if(!e.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(r),this._convertTopLevelObjectsToArrays(r),function(t){const e=new $i(t),{json:r}=e;for(const t of r.images||[]){const r=e.getObjectExtension(t,_o);r&&Object.assign(t,r),e.removeObjectExtension(t,_o)}r.buffers&&r.buffers[0]&&delete r.buffers[0].uri,e.removeExtension(_o)}(t),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(const e in Mo)this._convertTopLevelObjectToArray(t,e)}_convertTopLevelObjectToArray(t,e){const r=t[e];if(r&&!Array.isArray(r)){t[e]=[];for(const n in r){const s=r[n];s.id=s.id||n;const i=t[e].length;t[e].push(s),this.idToIndexMap[e][n]=i}}}_convertObjectIdsToArrayIndices(t){for(const e in Mo)this._convertIdsToIndices(t,e);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(const e of t.textures)this._convertTextureIds(e);for(const e of t.meshes)this._convertMeshIds(e);for(const e of t.nodes)this._convertNodeIds(e);for(const e of t.scenes)this._convertSceneIds(e)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(const e of t.primitives){const{attributes:t,indices:r,material:n}=e;for(const e in t)t[e]=this._convertIdToIndex(t[e],"accessor");r&&(e.indices=this._convertIdToIndex(r,"accessor")),n&&(e.material=this._convertIdToIndex(n,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map((t=>this._convertIdToIndex(t,"node")))),t.meshes&&(t.meshes=t.meshes.map((t=>this._convertIdToIndex(t,"mesh"))))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map((t=>this._convertIdToIndex(t,"node"))))}_convertIdsToIndices(t,e){t[e]||(console.warn("gltf v1: json doesn't contain attribute ".concat(e)),t[e]=[]);for(const r of t[e])for(const t in r){const e=r[t],n=this._convertIdToIndex(e,t);r[t]=n}}_convertIdToIndex(t,e){const r=Fo[e];if(r in this.idToIndexMap){const n=this.idToIndexMap[r][t];if(!Number.isFinite(n))throw new Error("gltf v1: failed to resolve ".concat(e," with id ").concat(t));return n}return t}_updateObjects(t){for(const t of this.json.buffers)delete t.type}_updateMaterial(t){for(const e of t.materials){e.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const r=e.values&&e.values.tex,n=t.textures.findIndex((t=>t.id===r));-1!==n&&(e.pbrMetallicRoughness.baseColorTexture={index:n})}}}const Go={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},xo={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},So={magFilter:10240,minFilter:10241,wrapS:10242,wrapT:10243},Ro={10240:9729,10241:9986,10242:10497,10243:10497};class Oo{constructor(){m(this,"baseUri",""),m(this,"json",{}),m(this,"buffers",[]),m(this,"images",[])}postProcess(t,e={}){const{json:r,buffers:n=[],images:s=[],baseUri:i=""}=t;return Pi(r),this.baseUri=i,this.json=r,this.buffers=n,this.images=s,this._resolveTree(this.json,e),this.json}_resolveTree(t,e={}){t.bufferViews&&(t.bufferViews=t.bufferViews.map(((t,e)=>this._resolveBufferView(t,e)))),t.images&&(t.images=t.images.map(((t,e)=>this._resolveImage(t,e)))),t.samplers&&(t.samplers=t.samplers.map(((t,e)=>this._resolveSampler(t,e)))),t.textures&&(t.textures=t.textures.map(((t,e)=>this._resolveTexture(t,e)))),t.accessors&&(t.accessors=t.accessors.map(((t,e)=>this._resolveAccessor(t,e)))),t.materials&&(t.materials=t.materials.map(((t,e)=>this._resolveMaterial(t,e)))),t.meshes&&(t.meshes=t.meshes.map(((t,e)=>this._resolveMesh(t,e)))),t.nodes&&(t.nodes=t.nodes.map(((t,e)=>this._resolveNode(t,e)))),t.skins&&(t.skins=t.skins.map(((t,e)=>this._resolveSkin(t,e)))),t.scenes&&(t.scenes=t.scenes.map(((t,e)=>this._resolveScene(t,e)))),void 0!==t.scene&&(t.scene=t.scenes[this.json.scene])}getScene(t){return this._get("scenes",t)}getNode(t){return this._get("nodes",t)}getSkin(t){return this._get("skins",t)}getMesh(t){return this._get("meshes",t)}getMaterial(t){return this._get("materials",t)}getAccessor(t){return this._get("accessors",t)}getCamera(t){return null}getTexture(t){return this._get("textures",t)}getSampler(t){return this._get("samplers",t)}getImage(t){return this._get("images",t)}getBufferView(t){return this._get("bufferViews",t)}getBuffer(t){return this._get("buffers",t)}_get(t,e){if("object"==typeof e)return e;const r=this.json[t]&&this.json[t][e];return r||console.warn("glTF file error: Could not find ".concat(t,"[").concat(e,"]")),r}_resolveScene(t,e){return t.id=t.id||"scene-".concat(e),t.nodes=(t.nodes||[]).map((t=>this.getNode(t))),t}_resolveNode(t,e){return t.id=t.id||"node-".concat(e),t.children&&(t.children=t.children.map((t=>this.getNode(t)))),void 0!==t.mesh?t.mesh=this.getMesh(t.mesh):void 0!==t.meshes&&t.meshes.length&&(t.mesh=t.meshes.reduce(((t,e)=>{const r=this.getMesh(e);return t.id=r.id,t.primitives=t.primitives.concat(r.primitives),t}),{primitives:[]})),void 0!==t.camera&&(t.camera=this.getCamera(t.camera)),void 0!==t.skin&&(t.skin=this.getSkin(t.skin)),t}_resolveSkin(t,e){return t.id=t.id||"skin-".concat(e),t.inverseBindMatrices=this.getAccessor(t.inverseBindMatrices),t}_resolveMesh(t,e){return t.id=t.id||"mesh-".concat(e),t.primitives&&(t.primitives=t.primitives.map((t=>{const e=(t={...t}).attributes;t.attributes={};for(const r in e)t.attributes[r]=this.getAccessor(e[r]);return void 0!==t.indices&&(t.indices=this.getAccessor(t.indices)),void 0!==t.material&&(t.material=this.getMaterial(t.material)),t}))),t}_resolveMaterial(t,e){if(t.id=t.id||"material-".concat(e),t.normalTexture&&(t.normalTexture={...t.normalTexture},t.normalTexture.texture=this.getTexture(t.normalTexture.index)),t.occlusionTexture&&(t.occlustionTexture={...t.occlustionTexture},t.occlusionTexture.texture=this.getTexture(t.occlusionTexture.index)),t.emissiveTexture&&(t.emmisiveTexture={...t.emmisiveTexture},t.emissiveTexture.texture=this.getTexture(t.emissiveTexture.index)),t.emissiveFactor||(t.emissiveFactor=t.emmisiveTexture?[1,1,1]:[0,0,0]),t.pbrMetallicRoughness){t.pbrMetallicRoughness={...t.pbrMetallicRoughness};const e=t.pbrMetallicRoughness;e.baseColorTexture&&(e.baseColorTexture={...e.baseColorTexture},e.baseColorTexture.texture=this.getTexture(e.baseColorTexture.index)),e.metallicRoughnessTexture&&(e.metallicRoughnessTexture={...e.metallicRoughnessTexture},e.metallicRoughnessTexture.texture=this.getTexture(e.metallicRoughnessTexture.index))}return t}_resolveAccessor(t,e){var r,n;if(t.id=t.id||"accessor-".concat(e),void 0!==t.bufferView&&(t.bufferView=this.getBufferView(t.bufferView)),t.bytesPerComponent=(r=t.componentType,xo[r]),t.components=(n=t.type,Go[n]),t.bytesPerElement=t.bytesPerComponent*t.components,t.bufferView){const e=t.bufferView.buffer,{ArrayType:r,byteLength:n}=Xi(t,t.bufferView),s=(t.bufferView.byteOffset||0)+(t.byteOffset||0)+e.byteOffset;let i=e.arrayBuffer.slice(s,s+n);t.bufferView.byteStride&&(i=this._getValueFromInterleavedBuffer(e,s,t.bufferView.byteStride,t.bytesPerElement,t.count)),t.value=new r(i)}return t}_getValueFromInterleavedBuffer(t,e,r,n,s){const i=new Uint8Array(s*n);for(let o=0;o<s;o++){const s=e+o*r;i.set(new Uint8Array(t.arrayBuffer.slice(s,s+n)),o*n)}return i.buffer}_resolveTexture(t,e){return t.id=t.id||"texture-".concat(e),t.sampler="sampler"in t?this.getSampler(t.sampler):Ro,t.source=this.getImage(t.source),t}_resolveSampler(t,e){t.id=t.id||"sampler-".concat(e),t.parameters={};for(const e in t){const r=this._enumSamplerParameter(e);void 0!==r&&(t.parameters[r]=t[e])}return t}_enumSamplerParameter(t){return So[t]}_resolveImage(t,e){t.id=t.id||"image-".concat(e),void 0!==t.bufferView&&(t.bufferView=this.getBufferView(t.bufferView));const r=this.images[e];return r&&(t.image=r),t}_resolveBufferView(t,e){const r=t.buffer,n={id:"bufferView-".concat(e),...t,buffer:this.buffers[r]},s=this.buffers[r].arrayBuffer;let i=this.buffers[r].byteOffset||0;return"byteOffset"in t&&(i+=t.byteOffset),n.data=new Uint8Array(s,i,t.byteLength),n}_resolveCamera(t,e){return t.id=t.id||"camera-".concat(e),t.perspective,t.orthographic,t}}const Uo=1735152710,Lo=!0;function No(t,e,r,n){const s=new Uint8Array(e.buffer,r,n),i=new TextDecoder("utf8").decode(s);return t.json=JSON.parse(i),O(n,4)}function Ho(t,e,r,n){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:r,byteLength:n,arrayBuffer:e.buffer}),O(n,4)}async function Jo(t,e,n=0,s,i){var o,a,c,l;!function(t,e,n,s){if(s.uri&&(t.baseUri=s.uri),e instanceof ArrayBuffer&&!function(t,e=0,r={}){const n=new DataView(t),{magic:s=Uo}=r,i=n.getUint32(e,!1);return i===s||i===Uo}(e,n,s)&&(e=(new TextDecoder).decode(e)),"string"==typeof e)t.json=function(t){try{return JSON.parse(t)}catch(e){throw new Error('Failed to parse JSON from data starting with "'.concat(function(t,e=5){return"string"==typeof t?t.slice(0,e):ArrayBuffer.isView(t)?G(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?G(t,0,e):""}(t),'"'))}}(e);else if(e instanceof ArrayBuffer){const i={};n=function(t,e,n=0,s={}){const i=new DataView(e),o=function(t,e=0){return"".concat(String.fromCharCode(t.getUint8(e+0))).concat(String.fromCharCode(t.getUint8(e+1))).concat(String.fromCharCode(t.getUint8(e+2))).concat(String.fromCharCode(t.getUint8(e+3)))}(i,n+0),a=i.getUint32(n+4,Lo),c=i.getUint32(n+8,Lo);switch(Object.assign(t,{header:{byteOffset:n,byteLength:c,hasBinChunk:!1},type:o,version:a,json:{},binChunks:[]}),n+=12,t.version){case 1:return function(t,e,n){r(t.header.byteLength>20);const s=e.getUint32(n+0,Lo),i=e.getUint32(n+4,Lo);return n+=8,r(0===i),No(t,e,n,s),(n+=s)+Ho(t,e,n,t.header.byteLength)}(t,i,n);case 2:return function(t,e,n,s){return r(t.header.byteLength>20),function(t,e,r,n){for(;r+8<=t.header.byteLength;){const s=e.getUint32(r+0,Lo),i=e.getUint32(r+4,Lo);switch(r+=8,i){case 1313821514:No(t,e,r,s);break;case 5130562:Ho(t,e,r,s);break;case 0:n.strict||No(t,e,r,s);break;case 1:n.strict||Ho(t,e,r,s)}r+=O(s,4)}}(t,e,n,{}),n+t.header.byteLength}(t,i,n);default:throw new Error("Invalid GLB version ".concat(t.version,". Only supports v1 and v2."))}}(i,e,n,s.glb),Pi("glTF"===i.type,"Invalid GLB magic string ".concat(i.type)),t._glb=i,t.json=i.json}else Pi(!1,"GLTF: must be ArrayBuffer or string");const i=t.json.buffers||[];if(t.buffers=new Array(i.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:e}=t._glb;t.buffers[0]={arrayBuffer:e[0].arrayBuffer,byteOffset:e[0].byteOffset,byteLength:e[0].byteLength}}const o=t.json.images||[];t.images=new Array(o.length).fill({})}(t,e,n,s),function(t,e={}){(new Do).normalize(t,e)}(t,{normalize:null==s||null===(o=s.gltf)||void 0===o?void 0:o.normalize}),function(t,e={},r){const n=vo.filter((t=>Io(t.name,e)));for(const i of n){var s;null===(s=i.preprocess)||void 0===s||s.call(i,t,e,r)}}(t,s,i);const h=[];if(null!=s&&null!==(a=s.gltf)&&void 0!==a&&a.loadBuffers&&t.json.buffers&&await async function(t,e,r){const n=t.json.buffers||[];for(let o=0;o<n.length;++o){const a=n[o];if(a.uri){var s,i;const{fetch:n}=r;Pi(n);const c=ji(a.uri,e),l=await(null==r||null===(s=r.fetch)||void 0===s?void 0:s.call(r,c)),h=await(null==l||null===(i=l.arrayBuffer)||void 0===i?void 0:i.call(l));t.buffers[o]={arrayBuffer:h,byteOffset:0,byteLength:h.byteLength},delete a.uri}}}(t,s,i),null!=s&&null!==(c=s.gltf)&&void 0!==c&&c.loadImages){const e=async function(t,e,r){const n=function(t){const e=new Set,r=t.json.textures||[];for(const t of r)void 0!==t.source&&e.add(t.source);return Array.from(e).sort()}(t),s=t.json.images||[],i=[];for(const o of n)i.push(Po(t,s[o],o,e,r));return await Promise.all(i)}(t,s,i);h.push(e)}const u=async function(t,e={},r){const n=vo.filter((t=>Io(t.name,e)));for(const i of n){var s;await(null===(s=i.decode)||void 0===s?void 0:s.call(i,t,e,r))}}(t,s,i);return h.push(u),await Promise.all(h),null!=s&&null!==(l=s.gltf)&&void 0!==l&&l.postProcess?function(t,e){return(new Oo).postProcess(t,e)}(t,s):t}async function Po(t,e,r,n,s){const{fetch:i,parse:o}=s;let a;if(e.uri){const t=ji(e.uri,n),r=await i(t);a=await r.arrayBuffer()}if(Number.isFinite(e.bufferView)){const r=function(t,e,r){const n=t.bufferViews[r];Pi(n);const s=e[n.buffer];Pi(s);const i=(n.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,i,n.byteLength)}(t.json,t.buffers,e.bufferView);a=R(r.buffer,r.byteOffset,r.byteLength)}Pi(a,"glTF image has no data");let c=await o(a,[Ni,bi],{mimeType:e.mimeType,basis:n.basis||{format:Ci()}},s);c&&c[0]&&(c={compressed:!0,mipmaps:!1,width:c[0].width,height:c[0].height,data:c}),t.images=t.images||[],t.images[r]=c}const jo={name:"glTF",id:"gltf",module:"gltf",version:"3.1.4",extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:async function(t,e={},r){(e={...jo.options,...e}).gltf={...jo.options.gltf,...e.gltf};const{byteOffset:n=0}=e;return await Jo({},t,n,e,r)},options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};function ko(t,e,r,n){t.rotateYtoZ=!0;const s=t.byteOffset+t.byteLength-r;if(0===s)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=R(e,r,s),t.gltfByteOffset=0,t.gltfByteLength=s,r%4==0||console.warn("".concat(t.type,": embedded glb is not aligned to a 4-byte boundary.")),t.byteOffset+t.byteLength}async function Vo(t,e,r,n){const s=r["3d-tiles"]||{};if(function(t,e,r){switch(e){case 0:const e=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),r=(new TextDecoder).decode(e);t.gltfUrl=r.replace(/[\s\0]+$/,""),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case 1:break;default:throw new Error("b3dm: Illegal glTF format field")}}(t,e),s.loadGLTF){const{parse:e,fetch:s}=n;t.gltfUrl&&(t.gltfArrayBuffer=await s(t.gltfUrl,r),t.gltfByteOffset=0),t.gltfArrayBuffer&&(t.gltf=await e(t.gltfArrayBuffer,jo,r,n),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength)}}async function Ko(t,e=0,r,n,s={}){switch(s.byteOffset=e,s.type=function(t,e=0){const r=new DataView(t);return"".concat(String.fromCharCode(r.getUint8(e+0))).concat(String.fromCharCode(r.getUint8(e+1))).concat(String.fromCharCode(r.getUint8(e+2))).concat(String.fromCharCode(r.getUint8(e+3)))}(t,e),s.type){case"cmpt":return await async function(t,e,r,n,s,i){r=Ps(t,e,r);const o=new DataView(e);for(t.tilesLength=o.getUint32(r,!0),r+=4,t.tiles=[];t.tiles.length<t.tilesLength&&t.byteLength-r>12;){const o={};t.tiles.push(o),r=await i(e,r,n,s,o)}return r}(s,t,e,r,n,Ko);case"b3dm":return await async function(t,e,r,n,s){var i;r=function(t,e,r,n,s){r=ko(t,e,r=Vs(t,e,r=ks(t,e,r=Ps(t,e,r))),n);const i=new Ds(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=i.getGlobalProperty("RTC_CENTER",bs.FLOAT,3),r}(t,e,r,n),await Vo(t,1,n,s);const o=null==t||null===(i=t.gltf)||void 0===i?void 0:i.extensions;return o&&o.CESIUM_RTC&&(t.rtcCenter=o.CESIUM_RTC.center),r}(s,t,e,r,n);case"glTF":return await async function(t,e,r,n){t.rotateYtoZ=!0,t.gltfUpAxis=r["3d-tiles"]&&r["3d-tiles"].assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y";const{parse:s}=n;t.gltf=await s(e,jo,r,n)}(s,t,r,n);case"i3dm":return await async function(t,e,r,n,s){return r=function(t,e,r,n,s){if(r=Ps(t,e,r),1!==t.version)throw new Error("Instanced 3D Model version ".concat(t.version," is not supported"));r=ks(t,e,r);const i=new DataView(e);if(t.gltfFormat=i.getUint32(r,!0),r=ko(t,e,r=Vs(t,e,r+=4),n),0===t.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const o=new Ds(t.featureTableJson,t.featureTableBinary),a=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=a,!Number.isFinite(a))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");return t.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=o.getGlobalProperty("RTC_CENTER",bs.FLOAT,3),new Js(t.batchTableJson,t.batchTableBinary,a),function(t,e,r,n){const s=[new Array(n),t._batchTable][0],i=new xe;new xe,new xe,new xe;const o=new Je,a=new rr,c=new xe,l={},h=new qe,u=[],d=[],f=new xe,m=new xe;for(let r=0;r<n;r++){let n;if(e.hasProperty("POSITION"))n=e.getProperty("POSITION",bs.FLOAT,3,r,i);else if(e.hasProperty("POSITION_QUANTIZED")){n=e.getProperty("POSITION_QUANTIZED",bs.UNSIGNED_SHORT,3,r,i);const t=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",bs.FLOAT,3,f);if(!t)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const s=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",bs.FLOAT,3,m);if(!s)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const o=65535;for(let e=0;e<3;e++)n[e]=n[e]/o*s[e]+t[e]}if(!n)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(i.copy(n),l.translation=i,t.normalUp=e.getProperty("NORMAL_UP",bs.FLOAT,3,r,u),t.normalRight=e.getProperty("NORMAL_RIGHT",bs.FLOAT,3,r,d),t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",bs.UNSIGNED_SHORT,2,u),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",bs.UNSIGNED_SHORT,2,d),t.octNormalUp){if(!t.octNormalRight)throw new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw new Error("i3dm: oct-encoded orientation not implemented")}t.eastNorthUp?(Er.WGS84.eastNorthUpToFixedFrame(i,h),h.getRotationMatrix3(o)):o.identity()}a.fromMatrix3(o),l.rotation=a,c.set(1,1,1);const A=e.getProperty("SCALE",bs.FLOAT,1,r);Number.isFinite(A)&&c.multiplyByScalar(A);const p=e.getProperty("SCALE_NON_UNIFORM",bs.FLOAT,3,r,u);p&&c.scale(p),l.scale=c;let B=e.getProperty("BATCH_ID",bs.UNSIGNED_SHORT,1,r);void 0===B&&(B=r);const g=(new qe).fromQuaternion(l.rotation);h.identity(),h.translate(l.translation),h.multiplyRight(g),h.scale(l.scale);const y=h.clone();s[r]={modelMatrix:y,batchId:B}}t.instances=s}(t,o,0,a),r}(t,e,r,n),await Vo(t,t.gltfFormat,n,s),r}(s,t,e,r,n);case"pnts":return await qs(s,t,e,r,n);default:throw new Error("3DTileLoader: unknown type ".concat(s.type))}}async function Qo(t,e,r){const n=t[e].bufferView,s=t.bufferViews[n],i=t.buffers[s.buffer];if(i.uri){const t=await st(i.uri),e=await t.arrayBuffer();return new Uint8Array(e,s.byteOffset,s.byteLength)}return new Uint8Array(r,s.byteOffset,s.byteLength)}function qo(t){const e=new DataView(t);return e.getUint32(0,!0)+2**32*e.getUint32(4,!0)}const zo={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:Pn,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:async function(t){if(1952609651!==new Uint32Array(t.slice(0,4))[0])throw new Error("Wrong subtree file magic number");if(1!==new Uint32Array(t.slice(4,8))[0])throw new Error("Wrong subtree file verson, must be 1");const e=qo(t.slice(8,16)),r=new Uint8Array(t,24,e),n=new TextDecoder("utf8").decode(r),s=JSON.parse(n),i=qo(t.slice(16,24));let o=new ArrayBuffer(0);return i&&(o=t.slice(24+e)),"bufferView"in s.tileAvailability&&(s.tileAvailability.explicitBitstream=await Qo(s,"tileAvailability",o)),"bufferView"in s.contentAvailability&&(s.contentAvailability.explicitBitstream=await Qo(s,"contentAvailability",o)),"bufferView"in s.childSubtreeAvailability&&(s.childSubtreeAvailability.explicitBitstream=await Qo(s,"childSubtreeAvailability",o)),s},options:{}},Wo={QUADTREE:4,OCTREE:8};async function Yo(t,e,r={mortonIndex:0,x:0,y:0,z:0},n=0,s=0,i={level:0,mortonIndex:0,x:0,y:0,z:0}){const{subdivisionScheme:o,subtreeLevels:a,maximumLevel:c,contentUrlTemplate:l,subtreesUriTemplate:h,basePath:u}=e,d={children:[],lodMetricValue:0,contentUrl:""},f=Wo[o],m=1&n,A=n>>1&1,p=n>>2&1,B=(f**s-1)/(f-1);let g=$o(r.mortonIndex,n),y=B+g,C=$o(r.x,m),b=$o(r.y,A),w=$o(r.z,p),E=!1;s+1>a&&(E=Xo(t.childSubtreeAvailability,g));const T=$o(i.x,C),v=$o(i.y,b),I=$o(i.z,w),_=s+i.level;if(E){const e=ta("".concat(u,"/").concat(h),_,T,v,I);t=await Yt(e,zo),i.mortonIndex=g,i.x=C,i.y=b,i.z=w,i.level=s,g=0,y=0,C=0,b=0,w=0,s=0}if(!Xo(t.tileAvailability,y)||s>c)return d;Xo(t.contentAvailability,y)&&(d.contentUrl=ta(l,_,T,v,I));const M=s+1,F={mortonIndex:g,x:C,y:b,z:w};for(let r=0;r<f;r++){const n=await Yo(t,e,F,r,M,i);if(n.contentUrl||n.children.length){const t=Zo(n,_+1,{childTileX:C,childTileY:b,childTileZ:w},e);d.children.push(t)}}return d}function Xo(t,e){return"constant"in t?Boolean(t.constant):!!t.explicitBitstream&&function(t,e){const r=t%8;return 1==(e[Math.floor(t/8)]>>r&1)}(e,t.explicitBitstream)}function Zo(t,e,r,n){const{basePath:s,refine:i,getRefine:o,lodMetricType:a,getTileType:c,rootLodMetricValue:l,rootBoundingVolume:h}=n,u=t.contentUrl&&t.contentUrl.replace("".concat(s,"/"),""),d=l/2**e,f=function(t,e,r){if(e.region){const{childTileX:n,childTileY:s,childTileZ:i}=r,[o,a,c,l,h,u]=e.region,d=2**t,f=(c-o)/d,m=(l-a)/d,A=(u-h)/d,[p,B]=[o+f*n,o+f*(n+1)],[g,y]=[a+m*s,a+m*(s+1)],[C,b]=[h+A*i,h+A*(i+1)];return{region:[p,g,B,y,C,b]}}return console.warn("Unsupported bounding volume type: ",e),null}(e,h,r);return{children:t.children,contentUrl:t.contentUrl,content:{uri:u},id:t.contentUrl,refine:o(i),type:c(t),lodMetricType:a,lodMetricValue:d,boundingVolume:f}}function $o(t,e){return parseInt(t.toString(2)+e.toString(2),2)}function ta(t,e,r,n,s){const i=function(t){const e={};for(const r in t)e["{".concat(r,"}")]=t[r];return e}({level:e,x:r,y:n,z:s});return t.replace(/{level}|{x}|{y}|{z}/gi,(t=>i[t]))}function ea(t){if(!t.contentUrl)return"empty";const e=t.contentUrl.split(".").pop();switch(e){case"pnts":return hn;case"i3dm":case"b3dm":case"glb":case"gltf":return ln;default:return e}}function ra(t){switch(t){case"REPLACE":case"replace":return 2;case"ADD":case"add":return 1;default:return t}}function na(t,e){if(!t)return null;if(t.content){const r=t.content.uri||t.content.url;t.contentUrl="".concat(e.basePath,"/").concat(r)}return t.id=t.contentUrl,t.lodMetricType=fn,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform,t.type=ea(t),t.refine=ra(t.refine),t}async function sa(t){if(!t.root)return null;const e=t.basePath,r=t.root.extensions["3DTILES_implicit_tiling"],{subdivisionScheme:n,maximumLevel:s,subtreeLevels:i,subtrees:{uri:o}}=r,a=ta(o,0,0,0,0),c="".concat(e,"/").concat(a),l=await Yt(c,zo),h="".concat(e,"/").concat(t.root.content.uri),u=t.root.refine,d=t.root.geometricError,f=t.root.boundingVolume,m={contentUrlTemplate:h,subtreesUriTemplate:o,subdivisionScheme:n,subtreeLevels:i,maximumLevel:s,refine:u,basePath:e,lodMetricType:fn,rootLodMetricValue:d,rootBoundingVolume:f,getTileType:ea,getRefine:ra};return await async function(t,e,r){if(!t)return null;t.lodMetricType=fn,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform;const{children:n,contentUrl:s}=await Yo(e,r);return s&&(t.contentUrl=s,t.content={uri:s.replace("".concat(r.basePath,"/"),"")}),t.refine=ra(t.refine),t.type=ea(t),t.children=n,t.id=t.contentUrl,t}(t.root,l,m)}const ia="3DTILES_implicit_tiling",oa={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:Pn,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:async function(t,e,r){const n=e["3d-tiles"]||{};let s;return s="auto"===n.isTileset?r.url&&-1!==r.url.indexOf(".json"):n.isTileset,t=s?await async function(t,e,r){var n;const s=JSON.parse((new TextDecoder).decode(t));return s.loader=e.loader||oa,s.url=r.url,s.basePath=k(s.url),s.root=function(t){var e,r;return(null==t||null===(e=t.extensionsRequired)||void 0===e?void 0:e.includes(ia))&&(null==t||null===(r=t.extensionsUsed)||void 0===r?void 0:r.includes(ia))}(s)?await sa(s):function(t){const e=t.basePath,r=na(t.root,t),n=[];for(n.push(r);n.length>0;){const t=(n.pop()||{}).children||[];for(const r of t)na(r,{basePath:e}),n.push(r)}return r}(s),s.type=dn,s.lodMetricType=fn,s.lodMetricValue=(null===(n=s.root)||void 0===n?void 0:n.lodMetricValue)||0,s}(t,e,r):await async function(t,e,r){const n={content:{featureIds:null}};return await Ko(t,0,e,r,n.content),n.content}(t,e,r),t},options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}},aa="https://api.cesium.com/v1/assets";const ca={...oa,id:"cesium-ion",name:"Cesium Ion",preload:async function(t,e={}){e=e["cesium-ion"]||{};const{accessToken:n}=e;let s=e.assetId;if(!Number.isFinite(s)){const e=t.match(/\/([0-9]+)\/tileset.json/);s=e&&e[1]}return async function(t,e){if(!e){const n=await async function(t){r(t);const e={Authorization:"Bearer ".concat(t)},n=await st("https://api.cesium.com/v1/assets",{fetch:{headers:e}});if(!n.ok)throw new Error(n.statusText);return await n.json()}(t);for(const t of n.items)"3DTILES"===t.type&&(e=t.id)}const n=await async function(t,e){r(t,e);const n={Authorization:"Bearer ".concat(t)},s="".concat(aa,"/").concat(e);let i=await st("".concat(s),{fetch:{headers:n}});if(!i.ok)throw new Error(i.statusText);let o=await i.json();if(i=await st("".concat(s,"/endpoint"),{fetch:{headers:n}}),!i.ok)throw new Error(i.statusText);const a=await i.json();return o={...o,...a},o}(t,e),{type:s,url:i}=n;return r("3DTILES"===s&&i),n.headers={Authorization:"Bearer ".concat(n.accessToken)},n}(n,s)},parse:async(t,e,r)=>((e={...e})["3d-tiles"]=e["cesium-ion"],e.loader=ca,oa.parse(t,e,r)),options:{"cesium-ion":{...oa.options["3d-tiles"],accessToken:null}}};function la(e){const r=64,n=document.createElement("canvas");n.width=r,n.height=r;const s=n.getContext("2d");s.rect(0,0,r,r);const i=s.createLinearGradient(0,0,r,r);for(let t=0;t<e.length;t++){const r=e[t];i.addColorStop(r[0],"#"+r[1].getHexString())}s.fillStyle=i,s.fill();const o=new t.CanvasTexture(n);return o.needsUpdate=!0,o.minFilter=t.LinearFilter,o.wrapS=t.RepeatWrapping,o.wrapT=t.RepeatWrapping,o.repeat.set(2,2),o}function ha(e){e.updateMatrix(),e.updateMatrixWorld(),e.matrixWorldInverse.copy(e.matrixWorld).invert();const r=new t.Frustum;return r.setFromProjectionMatrix((new t.Matrix4).multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse)),r}const ua={SPECTRAL:[[0,new t.Color(.3686,.3098,.6353)],[.1,new t.Color(.1961,.5333,.7412)],[.2,new t.Color(.4,.7608,.6471)],[.3,new t.Color(.6706,.8667,.6431)],[.4,new t.Color(.902,.9608,.5961)],[.5,new t.Color(1,1,.749)],[.6,new t.Color(.9961,.8784,.5451)],[.7,new t.Color(.9922,.6824,.3804)],[.8,new t.Color(.9569,.4275,.2627)],[.9,new t.Color(.8353,.2431,.3098)],[1,new t.Color(.6196,.0039,.2588)]],PLASMA:[[0,new t.Color(.241,.015,.61)],[.1,new t.Color(.387,.001,.654)],[.2,new t.Color(.524,.025,.653)],[.3,new t.Color(.651,.125,.596)],[.4,new t.Color(.752,.227,.513)],[.5,new t.Color(.837,.329,.431)],[.6,new t.Color(.907,.435,.353)],[.7,new t.Color(.963,.554,.272)],[.8,new t.Color(.992,.681,.195)],[.9,new t.Color(.987,.822,.144)],[1,new t.Color(.94,.975,.131)]],YELLOW_GREEN:[[0,new t.Color(.1647,.2824,.3451)],[.1,new t.Color(.1338,.3555,.4227)],[.2,new t.Color(.061,.4319,.4864)],[.3,new t.Color(0,.5099,.5319)],[.4,new t.Color(0,.5881,.5569)],[.5,new t.Color(.137,.665,.5614)],[.6,new t.Color(.2906,.7395,.5477)],[.7,new t.Color(.4453,.8099,.5201)],[.8,new t.Color(.6102,.8748,.485)],[.9,new t.Color(.7883,.9323,.4514)],[1,new t.Color(.9804,.9804,.4314)]],VIRIDIS:[[0,new t.Color(.267,.005,.329)],[.1,new t.Color(.283,.141,.458)],[.2,new t.Color(.254,.265,.53)],[.3,new t.Color(.207,.372,.553)],[.4,new t.Color(.164,.471,.558)],[.5,new t.Color(.128,.567,.551)],[.6,new t.Color(.135,.659,.518)],[.7,new t.Color(.267,.749,.441)],[.8,new t.Color(.478,.821,.318)],[.9,new t.Color(.741,.873,.15)],[1,new t.Color(.993,.906,.144)]],INFERNO:[[0,new t.Color(.077,.042,.206)],[.1,new t.Color(.225,.036,.388)],[.2,new t.Color(.373,.074,.432)],[.3,new t.Color(.522,.128,.42)],[.4,new t.Color(.665,.182,.37)],[.5,new t.Color(.797,.255,.287)],[.6,new t.Color(.902,.364,.184)],[.7,new t.Color(.969,.516,.063)],[.8,new t.Color(.988,.683,.072)],[.9,new t.Color(.961,.859,.298)],[1,new t.Color(.988,.998,.645)]],GRAYSCALE:[[0,new t.Color(0,0,0)],[1,new t.Color(1,1,1)]],TURBO:[[0,new t.Color(.18995,.07176,.23217)],[.07,new t.Color(.25107,.25237,.63374)],[.13,new t.Color(.27628,.42118,.89123)],[.2,new t.Color(.25862,.57958,.99876)],[.27,new t.Color(.15844,.73551,.92305)],[.33,new t.Color(.09267,.86554,.7623)],[.4,new t.Color(.19659,.94901,.59466)],[.47,new t.Color(.42778,.99419,.38575)],[.53,new t.Color(.64362,.98999,.23356)],[.6,new t.Color(.80473,.92452,.20459)],[.67,new t.Color(.93301,.81236,.22667)],[.73,new t.Color(.99314,.67408,.20348)],[.8,new t.Color(.9836,.49291,.12849)],[.87,new t.Color(.92105,.31489,.05475)],[.93,new t.Color(.81608,.18462,.01809)],[1,new t.Color(.66449,.08436,.00424)]],RAINBOW:[[0,new t.Color(.278,0,.714)],[1/6,new t.Color(0,0,1)],[2/6,new t.Color(0,1,1)],[.5,new t.Color(0,1,0)],[4/6,new t.Color(1,1,0)],[5/6,new t.Color(1,.64,0)],[1,new t.Color(1,0,0)]],CONTOUR:[[0,new t.Color(0,0,0)],[.03,new t.Color(0,0,0)],[.04,new t.Color(1,1,1)],[1,new t.Color(1,1,1)]]};var da,fa;!function(t){t[t.Intensity=1]="Intensity",t[t.Classification=2]="Classification",t[t.Elevation=3]="Elevation",t[t.RGB=4]="RGB",t[t.White=5]="White"}(da||(da={})),function(t){t[t.FlatTexture=1]="FlatTexture",t[t.ShadedTexture=2]="ShadedTexture",t[t.ShadedNoTexture=3]="ShadedNoTexture"}(fa||(fa={}));const ma="undefined"!=typeof document?la(ua.RAINBOW):null,Aa="undefined"!=typeof document?la(ua.GRAYSCALE):null,pa={throttleRequests:!0,maxRequests:64,updateInterval:.1,maxConcurrency:1,maximumScreenSpaceError:16,maximumMemoryUsage:32,viewDistanceScale:1,skipLevelOfDetail:!1,updateTransforms:!0,shading:fa.FlatTexture,pointCloudColoring:da.White,worker:!0,wireframe:!1,debug:!1,basisTranscoderPath:null,dracoDecoderPath:null,material:null,computeNormals:!1,shaderCallback:null};function Ba(t){var e,r,n,s,i,o;(null===(r=null===(e=t)||void 0===e?void 0:e.uniforms)||void 0===r?void 0:r.map)?null===(i=null===(s=null===(n=t)||void 0===n?void 0:n.uniforms)||void 0===s?void 0:s.map.value)||void 0===i||i.dispose():t.map&&(null===(o=t.map)||void 0===o||o.dispose()),t.dispose()}function ga(t){t.traverse((t=>{if(t.isMesh)if(t.geometry.dispose(),t.material.isMaterial)Ba(t.material);else for(const e of t.material)Ba(e)}));for(let e=t.children.length-1;e>=0;e--){const r=t.children[e];t.remove(r)}}if(n(384),"undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");const ya={white:da.White,intensity:da.Intensity,classification:da.Classification,elevation:da.Elevation,rgb:da.RGB};AFRAME.registerComponent("loader-3dtiles",{schema:{url:{type:"string"},cameraEl:{type:"selector"},maximumSSE:{type:"int",default:16},maximumMem:{type:"int",default:32},distanceScale:{type:"number",default:1},pointcloudColoring:{type:"string",default:"white"},pointcloudElevationRange:{type:"array",default:["0","400"]},wireframe:{type:"boolean",default:!1},showStats:{type:"boolean",default:!1},cesiumIONToken:{type:"string"}},init:async function(){if(this.camera=this.data.cameraEl?.object3D.children[0]??document.querySelector("a-scene").camera,!this.camera)throw new Error("3D Tiles: Please add an active camera or specify the target camera via the cameraEl property");const{model:t,runtime:e}=await this._initTileset();this.runtime=e,this.runtime.setElevationRange(this.data.pointcloudElevationRange.map((t=>Number(t)))),this.el.setObject3D("tileset",t),this.originalCamera=this.camera,this.el.sceneEl.addEventListener("camera-set-active",(t=>{this.camera=t.detail.cameraEl.object3D.children[0]??this.originalCamera})),this.el.sceneEl.addEventListener("enter-vr",(t=>{this.originalCamera=this.camera;try{this.camera=this.el.sceneEl.renderer.xr.getCamera(this.camera),this.el.sceneEl.renderer.xr.getSession().requestAnimationFrame(((t,e)=>{const r=this.el.sceneEl.renderer.xr.getReferenceSpace(),n=e.getViewerPose(r);if(n){const t=n.views[0].projectionMatrix[5];this.camera.fov=2*Math.atan2(1,t)*180/Math.PI}}))}catch(t){console.warn("Could not get VR camera")}})),this.el.sceneEl.addEventListener("exit-vr",(t=>{this.camera=this.originalCamera})),this.data.showStats&&(this.stats=this._initStats()),THREE.Cache.enabled&&(console.warn("3D Tiles loader cannot work with THREE.Cache, disabling."),THREE.Cache.enabled=!1)},update:async function(t){if(t.url!==this.data.url){this.runtime&&this.runtime.dispose();const{model:t,runtime:e}=await this._initTileset();this.el.setObject3D("tileset",t),this.runtime=e}else this.runtime&&(this.runtime.setPointCloudColoring(this._resolvePointcloudColoring(this.data.pointCloudColoring)),this.runtime.setWireframe(this.data.wireframe),this.runtime.setViewDistanceScale(this.data.distanceScale),this.runtime.setElevationRange(this.data.pointcloudElevationRange.map((t=>Number(t)))));this.data.showStats&&!this.stats&&(this.stats=this._initStats()),!this.data.showStats&&this.stats&&(this.el.sceneEl.removeChild(this.stats),this.stats=null)},tick:function(e,r){if(this.runtime&&(this.runtime.update(r,this.el.sceneEl.renderer,this.camera),this.stats)){const e=new t.Vector3;this.camera.getWorldPosition(e);const r=this.runtime.getStats();this.stats.setAttribute("textarea","text",Object.values(r.stats).map((t=>`${t.name}: ${t.count}`)).join("\n"));const n=new t.Vector3;n.copy(e),n.z-=2,this.stats.setAttribute("position",n)}},remove:function(){this.runtime&&this.runtime.dispose()},_resolvePointcloudColoring(){return ya[this.data.pointcloudColoring]||(console.warn("Invalid value for point cloud coloring"),da.White)},_initTileset:async function(){const r=this._resolvePointcloudColoring(this.data.pointcloudColoring);return class{static load(r){return e(this,void 0,void 0,(function*(){const n=Object.assign(Object.assign({},pa),r.options),{url:s}=r,i=n.updateInterval,o={};if(n.cesiumIONToken){o["cesium-ion"]={accessToken:n.cesiumIONToken};const t=yield ca.preload(s,o);o.fetch={headers:t.headers}}const a=yield Yt(s,oa,Object.assign({},o)),c={},l={},h=[],u=new t.Group,d=new t.Group;n.debug||(d.visible=!1);const f={pointSize:{type:"f",value:1},gradient:{type:"t",value:ma},grayscale:{type:"t",value:Aa},rootCenter:{type:"vec3",value:new t.Vector3},rootNormal:{type:"vec3",value:new t.Vector3},coloring:{type:"i",value:n.pointCloudColoring},hideGround:{type:"b",value:!0},elevationRange:{type:"vec2",value:new t.Vector2(0,400)},maxIntensity:{type:"f",value:1},intensityContrast:{type:"f",value:1}};let m=null,A=null;const p=new t.GLTFLoader;if(n.basisTranscoderPath){const e=new t.KTX2Loader;e.detectSupport(r.renderer),e.setTranscoderPath(n.basisTranscoderPath+"/"),e.setWorkerLimit(1),p.setKTX2Loader(e)}if(n.dracoDecoderPath){const e=new t.DRACOLoader;e.setDecoderPath(n.dracoDecoderPath+"/"),e.setWorkerLimit(n.maxConcurrency),p.setDRACOLoader(e)}const B=new t.ShaderMaterial({uniforms:{},vertexShader:"\n  varying vec2 vUv;\n  void main() {\n      vUv = uv;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n  }\n",fragmentShader:"\n  uniform sampler2D map;\n  varying vec2 vUv;\n\n  void main() {\n    vec4 realColor = texture2D(map, vUv);\n    gl_FragColor = realColor;\n  }\n"}),g={maximumMemoryUsage:n.maximumMemoryUsage,maximumScreenSpaceError:n.maximumScreenSpaceError,viewDistanceScale:n.viewDistanceScale,skipLevelOfDetail:n.skipLevelOfDetail,updateTransforms:n.updateTransforms,throttleRequests:n.throttleRequests,maxRequests:n.maxRequests,contentLoader:r=>e(this,void 0,void 0,(function*(){let s=null;switch(r.type){case hn:s=function(e,r){const n={rtc_center:e.content.rtcCenter,points:e.content.attributes.positions,intensities:e.content.attributes.intensity,classifications:e.content.attributes.classification,rgb:null,rgba:null},{colors:s}=e.content.attributes;s&&3===s.size&&(n.rgb=s.value),s&&4===s.size&&(n.rgba=s.value);const i=new t.BufferGeometry;i.setAttribute("position",new t.Float32BufferAttribute(n.points,3));const o=new t.ShaderMaterial({uniforms:r,vertexShader:"\n  varying vec3 vColor;\n  uniform sampler2D gradient;\n  uniform sampler2D grayscale;\n  attribute float intensity;\n  attribute float classification;\n  uniform vec3 rootCenter;\n  uniform vec3 rootNormal;\n  uniform vec2 elevationRange;\n  uniform int coloring;\n  uniform bool hideGround;\n  uniform float maxIntensity;\n  uniform float intensityContrast;\n\n  #ifdef USE_COLOR\n  vec3 getRGB() {\n      vec3 rgb = color;\n      return rgb;\n  }\n  #endif\n\n  vec3 getElevation(){\n    vec4 world = modelMatrix * vec4( position, 1.0 );\n    float diff = abs(dot(rootNormal, (vec3(world) - rootCenter)));\n    float w = max(diff - elevationRange.x,0.0) / max(elevationRange.y - elevationRange.x,1.0);\n    vec3 cElevation = texture2D(gradient, vec2(w,1.0-w)).rgb;\n\n    return cElevation;\n  }\n\n  vec3 getIntensity(){\n    // TODO: real contrast enhancement. Check https://github.com/yuki-koyama/enhancer/blob/master/shaders/enhancer.fs\n    float intmod = pow(intensity, intensityContrast);\n    vec3 cIntensity = texture2D(grayscale, vec2(intmod / maxIntensity ,1.0-(intmod / maxIntensity))).rgb;\n    return cIntensity;\n  }\n\n  vec3 getClassification(){\n    float classNormalized = classification / 255.0;\n    vec3 cClassification = texture2D(gradient, vec2(classNormalized * 5.0,1.0-classNormalized * 5.0)).rgb;\n    return cClassification;\n  }\n\n  vec3 getColor(){\n      vec3 color;\n      if (hideGround && classification == 2.0) {\n         return vec3(0.0, 0.0, 0.0);               \n      }\n\n      if (coloring == 1) {\n        color = getIntensity();\n      }\n      else if (coloring == 2) {\n        color = getClassification();\n      } else if (coloring == 3) {\n        color = getElevation();\n      } \n      #ifdef USE_COLOR\n      else if (coloring == 4) {\n        color = getRGB();\n      }\n      #endif\n      else {\n        color = vec3(1.0, 1.0, 1.0);\n      }\n      return color;\n  }\n\n  void main() {\n      vColor = getColor();\n\n      gl_PointSize = 1.0;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n  }\n",fragmentShader:"\n  varying vec3 vColor;\n  void main() {\n    if (vColor == vec3(0.0, 0.0, 0.0)) {\n      discard;\n    } else {\n      gl_FragColor = vec4( vColor, 1.0 );\n    }\n  }\n",transparent:!0});n.rgba?(i.setAttribute("color",new t.Float32BufferAttribute(n.rgba,4)),o.vertexColors=!0):n.rgb&&(i.setAttribute("color",new t.Uint8BufferAttribute(n.rgb,3,!0)),o.vertexColors=!0),n.intensities&&i.setAttribute("intensity",new t.Uint8BufferAttribute(n.intensities,1,!0)),n.classifications&&i.setAttribute("classification",new t.Uint8BufferAttribute(n.classifications,1,!1));const a=new t.Points(i,o);if(n.rtc_center){const e=n.rtc_center;a.applyMatrix4((new t.Matrix4).makeTranslation(e[0],e[1],e[2]))}return a}(r,f);break;case ln:case"mesh":s=yield function(r,n,s,i,o){return e(this,void 0,void 0,(function*(){return new Promise(((e,a)=>{var c;const l=(new t.Matrix4).makeRotationAxis(new t.Vector3(1,0,0),Math.PI/2),h="Z"!==(null===(c=n.tileset.asset)||void 0===c?void 0:c.gltfUpAxis),u=(new t.Matrix4).fromArray(n.computedTransform).premultiply(o);h&&u.multiply(l),r.parse(n.content.gltfArrayBuffer,n.contentUrl?n.contentUrl.substr(0,n.contentUrl.lastIndexOf("/")+1):"",(r=>{const n=r.scenes[0];n.applyMatrix4(u),n.traverse((e=>{if(e instanceof t.Mesh){const t=e.material,r=t.map;i.material?(e.material=i.material.clone(),t.dispose()):i.shading==fa.FlatTexture&&(e.material=s.clone(),t.dispose()),i.shading!=fa.ShadedNoTexture?e.material.uniforms?e.material.uniforms.map={value:r}:e.material.map=r:(r&&r.dispose(),e.material.map=null),i.shaderCallback&&(e.onBeforeRender=i.shaderCallback),e.material.wireframe=i.wireframe,i.computeNormals&&e.geometry.computeVertexNormals()}})),e(n)}),(t=>{a(new Error(`error parsing gltf in tile ${n.id}: ${t}`))}))}))}))}(p,r,B,n,x)}if(s&&(s.visible=!1,c[r.id]=s,u.add(c[r.id]),n.debug)){const e=function(e){const{boundingVolume:r}=e;let n=0;e.content&&(n=Math.min(e.content.byteLength/5e5,1));const s=new t.Color(n,1,0),i=new t.BoxGeometry(1,1,1),o=new t.Matrix4;r.halfAxes?o.copy(function(e){const r=e;return(new t.Matrix4).fromArray([2*r[0],2*r[1],2*r[2],0,2*r[3],2*r[4],2*r[5],0,2*r[6],2*r[7],2*r[8],0,0,0,0,1])}(r.halfAxes)):r.radius&&i.scale(2*r.radius,2*r.radius,2*r.radius),i.applyMatrix4(o);const a=new t.EdgesGeometry(i),c=new t.LineSegments(a,new t.LineBasicMaterial({color:s}));return c.position.copy(new t.Vector3(...r.center)),c}(r);d.add(e),l[r.id]=e}})),onTileLoad:()=>e(this,void 0,void 0,(function*(){y&&(y._frameNumber++,S(y,c,A,m))})),onTileUnload:t=>{h.push(t)},onTileError:(t,e)=>{console.error("Tile error",t.id,e)}},y=new Jn(a,Object.assign(Object.assign({},g),{loadOptions:Object.assign(Object.assign({},o),{maxConcurrency:n.maxConcurrency,worker:n.worker,gltf:{loadImages:!1},"3d-tiles":{loadGLTF:!1}})}));let C=new t.Matrix4;const b=new t.Matrix4;if(y.root.transform&&b.multiply((new t.Matrix4).fromArray(y.root.transform)),1==y.root.children.length&&y.root.children[0].transform){const e=(new t.Matrix4).fromArray(y.root.children[0].transform);b.multiply(e)}b.equals((new t.Matrix4).identity())&&y.root.header.boundingVolume&&(y.root.header.boundingVolume.region?console.warn("Cannot apply a model matrix to bounding volumes of type region. Tileset stays in original geo-coordinates."):b.setPosition(new t.Vector3(...y.root.boundingVolume.center))),C.copy(b).invert();const w=C.clone();let E=new qe(C.toArray());y.modelMatrix=E;let T=!1;const v=new t.Vector3;f.rootCenter.value.copy(v),f.rootNormal.value.copy(new t.Vector3(0,0,1).normalize()),y.stats.get("Loader concurrency").count=n.maxConcurrency,y.stats.get("Maximum SSE").count=n.maximumScreenSpaceError,y.stats.get("Maximum mem usage").count=n.maximumMemoryUsage;let I=0;const _=(new t.Matrix4).makeTranslation(1/0,1/0,1/0);let M=null;const F=new t.Vector3(1/0,1/0,1/0);let D=null;const G=(new t.Matrix4).copy(u.matrixWorld),x=(new t.Matrix4).copy(G).invert();function S(e,s,i,o){if(T)return;if(!D||o.aspect!=M){const t=new tn({fov:o.fov/180*Math.PI,aspectRatio:o.aspect,near:o.near,far:o.far});D=t.sseDenominator,M=o.aspect,n.debug&&console.log("Updated sse denonimator:",D)}const a=ha(o).planes.map((t=>new jr(t.normal.toArray(),t.constant))),c=new Qr(a),f=new t.Vector2;i.getSize(f);const m={camera:{position:F.toArray()},height:f.y,frameNumber:e._frameNumber,sseDenominator:D,cullingVolume:c,viewport:{id:0}};e._cache.reset(),e._traverser.traverse(e.root,m,e.options);for(const t of e.tiles)t.selected?s[t.id]?s[t.id].visible=!0:console.error("TILE SELECTED BUT NOT LOADED!!",t.id):s[t.id]&&(s[t.id].visible=!1);for(;h.length>0;){const t=h.pop();s[t.id]&&0==t.contentState&&(u.remove(s[t.id]),ga(s[t.id]),delete s[t.id]),l[t.id]&&(ga(l[t.id]),d.remove(l[t.id]),delete l[t.id])}return r.onProgress&&r.onProgress(e.stats.get("Tiles Loaded").count,e.stats.get("Tiles Loaded").count+e.stats.get("Tiles Loading").count),m}return{model:u,runtime:{getTileset:()=>y,getStats:()=>y.stats,showTiles:t=>{d.visible=t},setWireframe:e=>{n.wireframe=e,u.traverse((r=>{r instanceof t.Mesh&&(r.material.wireframe=e)}))},setDebug:t=>{n.debug=t,d.visible=t},setShading:t=>{n.shading=t},getTileBoxes:()=>d,setViewDistanceScale:t=>{y.options.viewDistanceScale=t,y._frameNumber++,S(y,c,A,m)},setHideGround:t=>{f.hideGround.value=t},setPointCloudColoring:t=>{f.coloring.value=t},setElevationRange:t=>{f.elevationRange.value.set(t[0],t[1])},setMaxIntensity:t=>{f.maxIntensity.value=t},setIntensityContrast:t=>{f.intensityContrast.value=t},getLatLongHeightFromPosition:e=>{const r=y.ellipsoid.cartesianToCartographic((new t.Vector3).copy(e).applyMatrix4((new t.Matrix4).copy(C).invert()).toArray());return{lat:r[1],long:r[0],height:r[2]}},getPositionFromLatLongHeight:e=>{const r=y.ellipsoid.cartographicToCartesian([e.long,e.lat,e.height]);return new t.Vector3(...r).applyMatrix4(C)},getCameraFrustum:e=>{const r=ha(e).planes.map((t=>new jr(t.normal.toArray(),t.constant))).map((e=>function(e){const r=new t.Group,n=new t.PlaneGeometry(10,5),s=new t.Vector3(...e.projectPointOntoPlane([0,0,0])),i=new t.Vector3(e.normal.x,e.normal.y,e.normal.z),o=(new t.Vector3).copy(s).add(i);n.lookAt(o),n.translate(s.x,s.y,s.z);const a=new t.MeshBasicMaterial({color:65535,side:t.DoubleSide}),c=new t.Mesh(n,a),l=new t.ArrowHelper(i,s,5,16776960);return r.add(l),r.add(c),r}(e))),n=new t.Group;for(const t of r)n.add(t);return n},update:function(e,r,n){if(m=n,A=r,I+=e,y&&I>=i){if(!G.equals(u.matrixWorld)){G.copy(u.matrixWorld),C=w.clone(),C.premultiply(G);const e=(new t.Vector3).setFromMatrixPosition(G);f.rootCenter.value.copy(e),f.rootNormal.value.copy(new t.Vector3(0,0,1).applyMatrix4(G).normalize()),x.copy(G).invert(),E=new qe(C.toArray()),y.modelMatrix=E}(!n.matrixWorld.equals(_)||n.aspect!=M)&&(I=0,y._frameNumber++,n.getWorldPosition(F),_.copy(n.matrixWorld),S(y,c,r,n))}},dispose:function(){for(T=!0,y._destroy();u.children.length>0;){const t=u.children[0];ga(t),u.remove(t)}for(;d.children.length>0;){const t=d.children[0];d.remove(t),t.geometry.dispose(),t.material.dispose()}}}}}))}}.load({url:this.data.url,renderer:this.el.sceneEl.renderer,options:{dracoDecoderPath:"https://unpkg.com/three@0.133.0/examples/js/libs/draco",basisTranscoderPath:"https://unpkg.com/three@0.133.0/examples/js/libs/basis",cesiumIONToken:this.data.cesiumIONToken,maximumScreenSpaceError:this.data.maximumSSE,maximumMemoryUsage:this.data.maximumMem,viewDistanceScale:this.data.distanceScale,wireframe:this.data.wireframe,pointCloudColoring:r,updateTransforms:!0}})},_initStats:function(){const t=document.createElement("a-entity");return this.el.sceneEl.appendChild(t),t.setAttribute("position","-0.5 0 -1"),t.setAttribute("textarea",{cols:30,rows:15,text:"",color:"white",disabledBackgroundColor:"#0c1e2c",disabled:!0}),t}})})(),s})()}));